/* All rights reserved. */

function _S(a){try{return SYNO.MobileDSM.Session[a]||""}catch(b){return""}}function _T(c,a){try{return SYNO_Strings[c][a]||""}catch(b){return c+":"+a}}Ext.data.ServerProxy.prototype.timeout=120000;Ext.data.Connection.prototype.timeout=120000;Ext.Msg.exitAnimation=null;Ext.MessageBox.OK.text=_T("common","ok");Ext.MessageBox.CANCEL.text=_T("common","cancel");Ext.MessageBox.YES.text=_T("common","yes");Ext.MessageBox.NO.text=_T("common","no");if(Ext.is.iOS){Ext.form.Text.prototype.useClearIcon=true;Ext.form.Password.prototype.useClearIcon=true}Ext.form.Text.prototype.autoCapitalize=false;Ext.form.Password.prototype.autoCapitalize=false;Array.prototype.last=function(){return this[this.length-1]};Ext.regApplication("SYNO.MobileDSM",{remoteConfig:null,useHistory:false,launch:function(){SYNO.MobileDSM.History.init(window);Ext.fly("loading-spinner").show();this.remoteConfig={};SYNO.API.currentManager=new SYNO.API.Manager();SYNO.API.currentManager.queryAPI("all",this.initRemoteConfig,this)},initPanel:function(){var c={application:this,fullscreen:true};Ext.fly("loading-mask").remove();if(640>=Ext.Element.getViewportWidth()){this.isPhone=true;this.rootController=new SYNO.MobileDSM.views.PhoneViewPort(c)}else{this.isTablet=true;this.rootController=new SYNO.MobileDSM.views.TabletViewPort(c)}try{var b=Ext.decode(window.localStorage.login);if(b.rememberme){var a=SYNO.Utils.Cookies.get("id"),f=new Date();f.setDate(f.getDate()+30);SYNO.Utils.Cookies.set("id",a,f)}}catch(d){}},initRemoteConfig:function(a,c,b){if(!SYNO.Utils.CheckAPIResponse(a,c,b)){return}this.remoteConfig={};SYNO.API.currentManager.requestAPI("SYNO.DSM.Info","getinfo",1,{},this.onInitDSMInfo,this)},onInitDSMInfo:function(a,c,b){if(!SYNO.Utils.CheckAPIResponse(a,c,b)){return}this.remoteConfig.diskless=("USB Station 2"===c.model);SYNO.API.currentManager.requestAPI("SYNO.DSM.Service","list",1,{},this.onInitServiceList,this)},onInitServiceList:function(a,c,b){if(!SYNO.Utils.CheckAPIResponse(a,c,b)){return}this.remoteConfig.services={};Ext.each(c.services,function(d){this.remoteConfig.services[d.name]=d.enabled},this);SYNO.API.currentManager.requestAPI("SYNO.DSM.Package","list",1,{},this.onInitPackageList,this)},onInitPackageList:function(a,c,b){if(!SYNO.Utils.CheckAPIResponse(a,c,b)){return}this.remoteConfig.packages={};Ext.each(c.packages,function(d){this.remoteConfig.packages[d.name]=d.enabled},this);SYNO.API.currentManager.requestAPI("SYNO.DSM.FindMe","supported",1,{},this.onInitFindMeSupport,this)},onInitFindMeSupport:function(a,c,b){this.remoteConfig.supportFindMe=a;this.initPanel()}});SYNO.ShareStatus={NORMAL:0,ENCRYPTED:1,DECRYPTED:2};SYNO.ShareUtils={GetPrivilegeInList:function(b,e){var d,a,c=["na","rw","ro","clear"];for(d=0;d<c.length;++d){a=c[d];if(e[a]&&0<=e[a].indexOf(b)){return a}}return undefined},GetGroupPrivilegeInList:function(a,f){var e,c,b,g,d=["na","rw","ro","clear"];for(e=0;e<d.length;++e){b=d[e];for(c=0;c<a.length;++c){g=a[c];if(f[b]&&0<=f[b].indexOf(g)){return b}}}return undefined},GetResolvedPrivilege:function(b,a){if(!b){return a}if(!a||"clear"==a||"na"==b||("cu"==b&&"na"!=a)||("rw"==b&&("na"!=a&&"cu"!=a))){return b}return a},GetPrivilegeString:function(b,a){var c=a?_T("share","priv_empty"):_T("share","priv_na");switch(b){case"rw":c=_T("share","priv_rw");break;case"ro":c=_T("share","priv_ro");break;case"na":c=_T("share","priv_na");break;case"cu":c=_T("share","priv_custom");break}return c},GetPrivilegeFromPermObj:function(a){if(a.is_deny){return"na"}else{if(a.is_custom){return"cu"}else{if(a.is_writable){return"rw"}else{if(a.is_readonly){return"ro"}}}}return"clear"},FillinPermission:function(b,a){var c=function(f,e,d){Ext.each(e[d],function(g){var h={name:g,is_deny:false,is_readonly:false,is_writable:false};switch(d){case"rw":h.is_writable=true;break;case"ro":h.is_readonly=true;break;case"na":h.is_deny=true;break;default:break}f.push(h)})};c(b,a,"rw");c(b,a,"ro");c(b,a,"na");c(b,a,"clear")}};SYNO.MobileDSM.stores.Store=Ext.extend(Ext.data.Store,{onProxyLoad:function(a){if(a.hasException()){SYNO.Utils.CheckAPIResponse(false,a.error,{api:a.api});return}SYNO.MobileDSM.stores.Store.superclass.onProxyLoad.apply(this,arguments)}});Ext.reg("SYNO.MobileDSM.stores.Store",SYNO.MobileDSM.stores.Store);SYNO.NetworkUtils={GetInterfaceNames:function(c){var a={},b={};Ext.each(c,function(e){var d=e.type;a[d]=1+(a[d]||0)});Ext.each(c,function(h){var l,e=h.id,f=h.type,g=1<a[f],k=/([^0-9]+)([0-9]+)(\.([0-9]+))?(:([0-9]+))?/.exec(e),d=k[1],m=k[2],j=k[4];switch(f){case"lan":l=_T("sysinfo","lan");break;case"bond":l=_T("sysinfo","bond");break;case"pppoe":l=_T("sysinfo","pppoe");break;case"wireless":l=_T("sysinfo","wireless");break;default:l=d}if(g){l+=1+parseInt(m,10)}if(j){l+=" (VLAN "+j+")"}b[e]=l});return b}};SYNO.MobileDSM.History=new Ext.util.Observable({historyId:null,targetWindow:null,init:function(a){this.historyId=[];this.targetWindow=a||window;this.targetWindow.addEventListener("hashchange",this.onChange)},push:function(){var a=Ext.id();this.historyId.push(a);this.targetWindow.location.hash=a},pop:function(){this.historyId.pop();this.targetWindow.history.back()},getHash:function(){var a=this.targetWindow.location.hash;return a[0]=="#"?a.substr(1):a},onChange:function(){var a=SYNO.MobileDSM.History,b=a.historyId,c=a.getHash();if(0==b.length||c===b.last()){return}b.pop();a.fireEvent("change",c)}});Ext.namespace("SYNO.form");SYNO.form.Search=Ext.extend(Ext.form.Search,{searchTask:null,initComponent:function(){this.searchTask=new Ext.util.DelayedTask(this.onSearch,this);this.mon(this,"action",this.onSearch,this);this.mon(this,"clear",this.onValueChanged,this);this.cls=(this.cls||"")+" x-search-field";SYNO.form.Search.superclass.initComponent.apply(this,arguments)},onKeyUp:function(){SYNO.form.Search.superclass.onKeyUp.apply(this,arguments);this.onValueChanged()},onValueChanged:function(){if(!this.store||!this.store.proxy){return}this.searchTask.delay(500)},onSearch:function(){var a=this.store.proxy,b=a.filterParam,d=a.extraParams[b],c=this.getValue();if(c===d){return}if(a.quoteFilter){a.extraParams[b]=SYNO.Utils.QuoteString(c)}else{a.extraParams[b]=c}this.store.currentPage=1;this.store.load()}});Ext.reg("synosearchfield",SYNO.form.Search);SYNO.form.Toggle=Ext.extend(Ext.form.Toggle,{getThumbClass:function(){return Ext.form.Slider.Thumb}});Ext.reg("synotogglefield",SYNO.form.Toggle);Ext.namespace("SYNO.plugins");SYNO.plugins.ListPagingPlugin=Ext.extend(Ext.plugins.ListPagingPlugin,{autoPaging:true,onListUpdate:function(){var b=this.list.getStoreCount(),a=this.list.getStoreTotal();SYNO.plugins.ListPagingPlugin.superclass.onListUpdate.apply(this,arguments);this.el.setVisible(b<a)},onScrollEnd:function(){var b=this.list.getStoreCount(),a=this.list.getStoreTotal();if(b>=a){return}SYNO.plugins.ListPagingPlugin.superclass.onScrollEnd.apply(this,arguments)}});Ext.preg("synolistpaging",SYNO.plugins.ListPagingPlugin);SYNO.CanvasUtil={scaleCanvas:function(c){var e,d,a,b=c.getContext("2d");e=Ext.fly(c);d=e.getWidth();a=e.getHeight();scale=Math.ceil(window.devicePixelRatio||1);c.setAttribute("width",d*scale);c.setAttribute("height",a*scale);return scale},fillPie:function(c,g,f,b,a,e,d){var h=!((a+e)%(2*Math.PI));c.beginPath();if(!h){c.moveTo(g,f);c.arc(g,f,b,a,e,false)}else{c.arc(g,f,b,0,Math.PI*2,false)}c.closePath();c.fillStyle=d;c.fill()},strokePie:function(c,f,e,b,a,d,h){var g=!((a+d)%(2*Math.PI));c.lineWidth=1;c.beginPath();if(!g){c.moveTo(f,e);c.arc(f,e,b,a,d,false)}else{c.arc(f,e,b,0,Math.PI*2,false)}c.closePath();c.strokeStyle=h;c.stroke()},drawPieWithShadow:function(j,h,g,b,c,e,a){var k=2,f,d;if(c===e){return}SYNO.CanvasUtil.fillPie(j,h+k,g+k,b,c,e,"rgba(0, 0, 0, 0.1)",false);f=Ext.util.Format.format("rgba({0}, {1}, {2}, 0.6)",a[0],a[1],a[2]);SYNO.CanvasUtil.fillPie(j,h,g,b,c,e,f);d=Ext.util.Format.format("rgba({0}, {1}, {2}, 1.0)",a[0],a[1],a[2]);SYNO.CanvasUtil.strokePie(j,h,g,b,c,e,d)},drawPieChart:function(j,h,b,k,g){var c,s,n,r,e,m,q,a,f,p,o,l,d;c=Ext.fly(j);if(!c){return}d=c.dom;l=d.getContext("2d");s=SYNO.CanvasUtil.scaleCanvas(d);l.save();l.scale(s,s);l.lineWidth=1;n=c.getWidth();r=n/2;m=3;e=n/2-6;if(0==k){h=1}l.clearRect(0,0,d.width,d.height);a=Math.PI+(2*Math.PI*(h/(h+k)));f=a+(2*Math.PI*(k/(h+k)));q=(a+f)/2;p=r+Math.cos(q)*m;o=r+Math.sin(q)*m;SYNO.CanvasUtil.drawPieWithShadow(l,p,o,e,a,f,g);a=Math.PI;f=a+(2*Math.PI*(h/(h+k)));q=(a+f)/2;p=r+Math.cos(q)*m;o=r+Math.sin(q)*m;SYNO.CanvasUtil.drawPieWithShadow(l,p,o,e,a,f,b);l.restore()},strokeLine:function(b,d,f,c,a,e){b.lineJoin="round";b.lineWidth=2;b.strokeStyle=f;b.beginPath();b.moveTo(0,d[0]*a+e);for(i=0;i<d.length;++i){b.lineTo(i*c,d[i]*a+e)}b.stroke()},drawLineCharBackground:function(b,d,a){var c;b.beginPath();for(c=1;c<5;++c){b.moveTo(0,-a*c/4);b.lineTo(-d,-a*c/4)}b.closePath();b.lineWidth=1;b.strokeStyle="rgb(240, 245, 250)";b.stroke();b.beginPath();b.moveTo(0,0);b.lineTo(-d,0);b.moveTo(-d,0);b.lineTo(-d,-a);b.closePath();b.lineWidth=2;b.strokeStyle="rgb(84, 84, 84)";b.stroke()},drawLineCharLegend:function(b,c,a,e,d){b.font="12px sans-serif";b.fillStyle="rgb(84, 84, 84)";b.textAlign="right";b.textBaseline="middle";b.fillText(e,-c-5,-a);b.fillText((e/2).toFixed(),-c-5,-a/2);b.textBaseline="bottom";b.fillText(0,-c-5,0);b.textAlign="left";b.textBaseline="middle";b.fillText("("+d+")",-c+5,-a)},drawLineChart:function(b,f,j,o,h,n){var g,d,e,m,c,a,k,p,l;d=Ext.fly(b);if(!d){return}c=d.dom;a=d.getWidth();k=d.getHeight();m=c.getContext("2d");e=SYNO.CanvasUtil.scaleCanvas(c);if(h){a-=30;k-=6}m.save();m.clearRect(0,0,c.width,c.height);m.translate(c.width,c.height);m.scale(e,e);m.lineJoin="round";SYNO.CanvasUtil.drawLineCharBackground(m,a,k);if(h){SYNO.CanvasUtil.drawLineCharLegend(m,a,k,h,n)}g=1*(a/Math.max(a/100,5)).toFixed();Ext.each(j,function(r,q){r=r.slice(0,g+1);p=(a-2)/g;l=k/f;m.lineWidth=2;SYNO.CanvasUtil.strokeLine(m,r,"rgba(0, 0, 0, 0.1)",-p,-l,-1+4);SYNO.CanvasUtil.strokeLine(m,r,"rgba(0, 0, 0, 0.2)",-p,-l,-1+2);SYNO.CanvasUtil.strokeLine(m,r,o[q],-p,-l,-1)});m.restore();return g}};SYNO.Log=(function(){var e,d,g,a,c,f,b;e=function(){var h="";for(var j=0;j<arguments.length;++j){h+=arguments[j]+" "}return h};d=window;if(window.console){d=window.console}if(Ext.isIE){if(d.log){g=function(){return d.log.apply(d,arguments)}}else{g=Ext.emptyFn}a=c=f=b=g}else{g=d.log||Ext.emptyFn;a=d.debug||g;c=d.info||g;f=d.warn||g;b=d.error||g}return{debug:Ext.createDelegate(a,d),info:Ext.createDelegate(c,d),warn:Ext.createDelegate(f,d),error:Ext.createDelegate(b,d)}})();Ext.namespace("SYNO.API");SYNO.API.Manager=Ext.extend(Ext.util.Observable,{baseURL:"/webapi",constructor:function(){SYNO.API.Manager.superclass.constructor.apply(this,arguments);this.knownAPI={"SYNO.API.Info":{path:"query.cgi",minVersion:1,maxVersion:1}}},queryAPI:function(c,a,d){var b=[];if(!Ext.isArray(c)){c=[c]}Ext.each(c,function(e){if(!this.knownAPI.hasOwnProperty(e)){b.push(e)}},this);this.requestAPI("SYNO.API.Info","query",1,{query:b.join(",")},Ext.createDelegate(this.onQueryAPI,this,[a,d],true))},onQueryAPI:function(b,e,d,a,c){if(b){Ext.apply(this.knownAPI,e)}if(a){a.call(c,b,e)}},requestAPI:function(d,g,b,f,a,c){var e;e=this.knownAPI[d];if(!e){SYNO.Log.error("No Such API: "+d);return}if(b<e.minVersion||e.maxVersion<b){SYNO.Log.warn(String.format("WARN: API({0}) version ({1}) is higher then server ({2})",d,b,e.version))}return Ext.Ajax.request({url:this.baseURL+"/"+e.path,params:Ext.apply({},{api:d,method:g,version:b},f),scope:this,callback:this.onRequestAPI,userInfo:{cb:a,scope:c}})},onRequestAPI:function(b,a,d){var e=false,c=null;if(a){d=Ext.decode(d.responseText);if(d.success){e=true;c=d.data}else{e=false;c=d.error}}else{e=false;c=d}if(b.userInfo.cb){b.userInfo.cb.call(b.userInfo.scope,e,c,b.params)}}});SYNO.API.Proxy=Ext.extend(Ext.data.ServerProxy,{filterParam:"filter",startParam:"offset",limitParam:"limit",doRequest:function(a,d,b){var c=Ext.apply({},this.extraParams);this.getParams(c,a);SYNO.API.currentManager.requestAPI(this.api,this.method,this.version,c,Ext.createDelegate(this.onRequestAPI,this,[a,d,b],true))},onRequestAPI:function(a,e,d,b,f,c){if(!a){b.setException(e)}else{Ext.apply(b,{resultSet:this.getReader().read(e)});b.setCompleted();b.setSuccessful()}if(f){f.call(c||me,b)}}});Ext.data.ProxyMgr.registerType("synoapi",SYNO.API.Proxy);Ext.anims.slidefade=new Ext.Anim({direction:"left",cover:false,reveal:false,before:function(b){var a=b.getStyle("z-index")=="auto"?0:b.getStyle("z-index"),f=a+1,j=0,g=0,k=0,h=0,l=1,d=1,c=b.getHeight(),e=b.getWidth();if(this.direction=="left"||this.direction=="right"){if(this.out==true){j=-e}else{k=e}}else{if(this.direction=="up"||this.direction=="down"){if(this.out==true){g=-c}else{h=c}}}if(this.direction=="right"||this.direction=="down"){g*=-1;j*=-1;h*=-1;k*=-1}if(this.cover&&this.out){j=0;g=0;f=a}else{if(this.reveal&&!this.out){k=0;h=0;f=a}}if(this.out){d=0}else{f=a+1;l=0}this.from={"-webkit-transform":"translate3d("+k+"px, "+h+"px, 0)","z-index":f,opacity:l};this.to={"-webkit-transform":"translate3d("+j+"px, "+g+"px, 0)","z-index":f,opacity:d}}});Ext.namespace("SYNO.Utils");SYNO.Utils.APIErros={minCustomeError:400,common:{0:_T("error","connection_fail"),100:_T("error","unknown"),101:"Bad Request",102:"No Such API",103:"No Such Method",104:"Not Supported Version",105:_T("error","permission"),106:_T("error","session_timeout"),107:_T("error","session_interrupt")},"SYNO.DSM.User":{400:_T("error","invalid_username"),401:_T("error","user_exist"),402:_T("error","no_such_user"),403:_T("error","too_many_users"),404:"Bad Expire Date Format",405:_T("error","user_exist"),406:_T("error","admin_empty")},"SYNO.Core.Share":{402:_T("error","no_such_share"),3301:_T("error","share_exist"),3305:_T("error","invalid_sharename"),3310:_T("error","share_exist"),3319:_T("error","share_exist"),3309:_T("error","too_many_shares")},"SYNO.Core.Share.Crypto":{402:_T("error","no_such_share"),3305:_T("error","invalid_sharename"),3308:_T("error","password")},"SYNO.DSM.Group":{400:_T("error","invalid_groupname"),401:_T("error","group_exist"),402:_T("error","no_such_group"),403:_T("error","too_many_groups"),404:_T("error","group_exist")},"SYNO.DSM.System":{400:"System Busy"},"SYNO.DSM.FindMe":{400:"Not Support"}};SYNO.Utils.CheckSpecialError=function(a,d,b){var c;if("SYNO.DSM.Share"===b.api){if("delete"===b.method&&404===d.code){c=_T("error","delete_default_share")}else{if("edit"===b.method&&406===d.code){c=_T("error","share_mounted_rename")}}}return c};SYNO.Utils.CheckAPIResponse=function(a,g,d){var b,f;if(a){return true}if(0==g.status){return false}try{b=Ext.isDefined(g.status)?0:(g.code||100);if(b<SYNO.Utils.APIErros.minCustomeError){f=SYNO.Utils.APIErros.common[b]}else{f=SYNO.Utils.CheckSpecialError(a,g,d)||SYNO.Utils.APIErros[d.api][b]}}catch(c){}finally{if(!f){b=100;f=SYNO.Utils.APIErros.common[b]}}Ext.Msg.alert("",f,function(){if(b>=105&&b<400){window.location="/"}});return false};SYNO.Utils.C2F=function(a){return(a*9/5+32)};SYNO.Utils.SimpleTimeString=function(a){var b=(new Date()).format("Y/m/d"),c=a.format("Y/m/d");if(b===c){c=a.format("H:i:s")}return c};SYNO.Utils.TimeDurationString=function(a){var b="";if(a>86400){b+=Math.floor(a/86400);b+=_T("sysinfo","day");a%=86400}if(a>3600){b+=Math.floor(a/3600);b+=_T("sysinfo","hour");a%=3600}if(a>60){b+=Math.floor(a/60);b+=_T("sysinfo","minute");a%=60}b+=a;b+=_T("sysinfo","second");return b};SYNO.Utils.SizeUnit={BYTE:0,KB:1,MB:2,GB:3,TB:4};SYNO.Utils.SizeRound=function(c,b){var a=[" Bytes"," KB"," MB"," GB"," TB"];while(SYNO.Utils.SizeUnit.TB>b&&1024<=c){c/=1024;b++}return{value:1*c.toFixed(SYNO.Utils.SizeUnit.BYTE==b?0:2),unit:b,unitText:a[b]}};SYNO.Utils.SizeRoundText=function(c,a){var b=SYNO.Utils.SizeRound(c,a);return b.value+b.unitText};SYNO.Utils.SizeBytes=function(b,a){while(a--){b*=1024}return b};SYNO.Utils.SetBodyMask=function(a){var b=Ext.ApplicationManager.currentApplication.rootController.el,c=b.maskCnt||0;if(!b.maskTask){b.maskTask=new Ext.util.DelayedTask(function(){Ext.Element.data(b,"mask").setStyle("opacity",1)})}c+=(a?1:-1);if(c<0){c=0}b.maskCnt=c;if(a&&1===c){b.mask(Ext.LoadingSpinner,"x-mask-loading",false);Ext.Element.data(b,"mask").setStyle("opacity",0);b.maskTask.delay(400)}else{if(!a&&0===c){b.maskTask.cancel();b.unmask()}}};SYNO.Utils.ToggleContent=function(e){var a,d,b=SYNO.MobileDSM.HelpView,c=Ext.fly(e);if(!c||!b){return}a=b.scroller;d=a.getOffset();d.x*=-1;d.y*=-1;c.toggleCls("x-hidden-display");b.doComponentLayout();a.setOffset(d)};SYNO.Utils.Cookies={set:function(c,e){var a=arguments;var h=arguments.length;var b=(h>2)?a[2]:null;var g=(h>3)?a[3]:"/";var d=(h>4)?a[4]:null;var f=(h>5)?a[5]:false;document.cookie=c+"="+escape(e)+((b===null)?"":("; expires="+b.toGMTString()))+((g===null)?"":("; path="+g))+((d===null)?"":("; domain="+d))+((f===true)?"; secure":"")},get:function(d){var b=d+"=";var f=b.length;var a=document.cookie.length;var e=0;var c=0;while(e<a){c=e+f;if(document.cookie.substring(e,c)==b){return SYNO.Utils.Cookies.getCookieVal(c)}e=document.cookie.indexOf(" ",e)+1;if(e===0){break}}return null},clear:function(a){if(SYNO.Utils.Cookies.get(a)){document.cookie=a+"=; expires=Thu, 01-Jan-70 00:00:01 GMT"}},getCookieVal:function(b){var a=document.cookie.indexOf(";",b);if(a==-1){a=document.cookie.length}return unescape(document.cookie.substring(b,a))}};SYNO.Utils.CheckIsDemoMode=function(){if(!_S("demo_mode")){return false}Ext.Msg.alert("",_T("error","demo_mode"));return true};SYNO.Utils.QuoteString=function(a){return Ext.util.JSON.encode(""+a)};SYNO.Utils.FixScroll=function(a){a.on("afterlayout",function(){a.scroller.on("scrollstart",function(){a.doComponentLayout()},this,{single:true})},this,{single:true})};SYNO.MobileDSM.views.List=Ext.extend(Ext.List,{pressedCls:"x-item-selected",pressedDelay:0,selectedItemCls:"",initComponent:function(){SYNO.MobileDSM.views.List.superclass.initComponent.apply(this,arguments);if(this.store.getProxy() instanceof Ext.data.ServerProxy){this.plugins=["synolistpaging"].concat(this.plugins||[])}this.mon(this,"refresh",this.onRefresh,this)},getStoreCount:function(){if(!this.store.isFiltered()){return this.store.data.length||0}return this.store.snapshot.length||0},getStoreTotal:function(){var b=this.getStoreCount(),a=this.store.proxy.reader;if(a.rawData){b=a.getTotal(a.rawData)||b}return b},onRefresh:function(){var b=[],d=0,c=this.getTargetEl(),a=this.el.getHeight();if(0==this.all.getCount()){d=c.createChild({cls:"x-list-item",cn:[{cls:"x-list-item-body",html:_T("common","list_empty")}]}).getHeight();a-=d}else{d=this.all.first().getHeight();a-=d*this.all.getCount()}if(this.fillRestItems){while(d/2<a){b.push({cls:"x-list-item"});a-=d}}if(b.length){Ext.DomHelper.append(c,b)}},onDataChanged:function(){if(this.scroller&&1==this.store.currentPage){this.scroller.setOffset({x:0,y:0},true)}SYNO.MobileDSM.views.List.superclass.onDataChanged.apply(this,arguments)}});Ext.reg("SYNO.MobileDSM.views.List",SYNO.MobileDSM.views.List);SYNO.MobileDSM.views.AutoBlockList=Ext.extend(Ext.Panel,{listDirty:false,initComponent:function(){var a=Ext.ApplicationManager.currentApplication.isTablet;this.store=new SYNO.MobileDSM.stores.AutoBlockList();Ext.apply(this,{title:_T("autoblock","block_list"),ui:a?"round":undefined,layout:"fit",dockedItems:[{dock:"top",xtype:"toolbar",ui:a?"transparent":"gray",items:[{xtype:"synosearchfield",flex:1,placeHolder:_T("common","search"),store:this.store}]}],items:[{layout:"fit",xtype:"SYNO.MobileDSM.views.List",itemTpl:'<div class="x-list-item-body"><div class="x-list-item-text">{address}</div></div><div class="x-list-disclosure-text">{[SYNO.Utils.SimpleTimeString(values.timestamp)]}</div><div class="x-button x-button-decline x-list-disclosure-button x-hidden-opacity">'+_T("autoblock","unblock")+"</div>",fillRestItems:true,pressedCls:"",store:this.store,listeners:{scope:this,itemtap:this.onItemTapped,itemswipe:this.onItemSwiped}}]});SYNO.MobileDSM.views.AutoBlockList.superclass.initComponent.apply(this,arguments)},onItemTapped:function(b,a,d,f){var c=f.getTarget("div.x-list-disclosure-button.active");if(!c){this.removeAllBtns();return}this.toBeDeleted=b.getStore().getAt(a).get("address");Ext.Msg.confirm("",_T("autoblock","unblock_confirm"),this.onDeleteConfirm,this)},onDeleteConfirm:function(a){this.removeAllBtns();if("yes"!==a){return}SYNO.Utils.SetBodyMask(true);SYNO.API.currentManager.requestAPI("SYNO.DSM.AutoBlock","delete",1,{addresses:this.toBeDeleted},this.onDeleteDone,this)},onDeleteDone:function(a,d,c){var b=this.items.get(0).getStore();SYNO.Utils.SetBodyMask(false);if(!SYNO.Utils.CheckAPIResponse(a,d,c)){return}b.currentPage=1;b.load()},onItemSwiped:function(b,a,e){var d,c=Ext.select("div.x-list-disclosure-button",e);if(!c||0>=c.getCount()){this.removeAllBtns();return}d=c.item(0).hasCls("active");this.removeAllBtns();c.each(function(f){if(!d){f.replaceCls("x-hidden-opacity","active")}},this)},removeAllBtns:function(){var a=this.items.get(0),b=Ext.select("div.x-list-disclosure-button",a.el.dom);if(!b||0>=b.getCount()){return}b.each(function(c){c.replaceCls("active","x-hidden-opacity")},this)}});Ext.reg("SYNO.MobileDSM.views.AutoBlockList",SYNO.MobileDSM.views.AutoBlockList);SYNO.MobileDSM.views.ShareGroupEdit=Ext.extend(Ext.Panel,{initComponent:function(){var a=Ext.ApplicationManager.currentApplication.isTablet;this.modifiedGroup={na:[],rw:[],ro:[],clear:[]};this.backBtn=false;this.leftBtn={text:_T("common","cancel"),scope:this,handler:this.onCancelTapped};this.rightBtn={ui:"action",text:_T("common","done"),scope:this,handler:this.onDoneTapped};this.store=new SYNO.MobileDSM.stores.ShareGroupList({proxy:{extraParams:{name:SYNO.Utils.QuoteString(this.shareInfo.name),user_group_type:"local_group"}}});this.list=Ext.create({xtype:"SYNO.MobileDSM.views.List",itemTpl:{html:'<div class="x-list-item-body"><div class="x-list-item-text">{name}</div></div><div class="x-list-disclosure-text">{[this.getPrivilege(values)]}</div><div class="x-list-disclosure-detail"></div>',initialConfig:{scope:this,getPrivilege:function(c){var b=this.scope.getGroupSharePrivilege(c.name,this.scope.shareInfo.name,c,true);return SYNO.ShareUtils.GetPrivilegeString(b,true)}}},fillRestItems:true,store:this.store,listeners:{scope:this,itemtap:this.onItemTapped}});Ext.apply(this,{title:this.shareInfo.name,ui:a?"round":undefined,layout:"fit",listeners:{scope:this,activate:this.onViewAppear},dockedItems:[{dock:"top",xtype:"toolbar",ui:a?"transparent":"gray",items:[{xtype:"synosearchfield",flex:1,placeHolder:_T("common","search"),store:this.store}]}],items:[this.list]});SYNO.MobileDSM.views.ShareGroupEdit.superclass.initComponent.apply(this,arguments)},onViewAppear:function(){this.list.refresh()},onItemTapped:function(b,a){var c=b.getStore().getAt(a).data;this.viewport.pushContent(Ext.create({xtype:"SYNO.MobileDSM.views.GroupSharePrivEdit",title:c.name,sharename:this.shareInfo.name,groupname:c.name,permInfo:c,delegate:this}))},getGroupSharePrivilege:function(a,c,e,b){var d;if(b){d=SYNO.ShareUtils.GetPrivilegeInList(a,this.modifiedGroup)}if(!d){d=SYNO.ShareUtils.GetPrivilegeFromPermObj(e)}return d},updateGroupSharePrivilege:function(a,d,e,c){var b=this.getGroupSharePrivilege(a,d,e,false);this.modifiedGroup.rw.remove(a);this.modifiedGroup.ro.remove(a);this.modifiedGroup.na.remove(a);this.modifiedGroup.clear.remove(a);if(b===c||(!b&&"clear"===c)){return}this.modifiedGroup[c].push(a)},onCancelTapped:function(){this.viewport.popContent()},onDoneTapped:function(){var a=[];if(SYNO.Utils.CheckIsDemoMode()){return}SYNO.ShareUtils.FillinPermission(a,this.modifiedGroup);if(0==a.length){this.viewport.popContent();return}SYNO.Utils.SetBodyMask(true);SYNO.API.currentManager.requestAPI("SYNO.Core.Share.Permission","set",1,{name:SYNO.Utils.QuoteString(this.shareInfo.name),user_group_type:"local_group",permissions:Ext.util.JSON.encode(a)},this.onSaveDone,this)},onSaveDone:function(a,c,b){if(!SYNO.Utils.CheckAPIResponse(a,c,b)){SYNO.Utils.SetBodyMask(false);return}SYNO.Utils.SetBodyMask(false);this.viewport.popContent()}});Ext.reg("SYNO.MobileDSM.views.ShareGroupEdit",SYNO.MobileDSM.views.ShareGroupEdit);SYNO.MobileDSM.views.SysInfoStorage=Ext.extend(Ext.form.FormPanel,{ifaceNum:null,stores:null,pieQueue:null,initComponent:function(){this.stores=[];this.ifaceNum={};this.pieQueue=[];Ext.apply(this,{title:_T("sysinfo","storage"),cls:"system-info-storage",iconCls:"icon-storage",scroll:true,listeners:{scope:this,afterlayout:this.onAfterLayout},items:[{xtype:"segmentedbutton",allowDepress:false,listeners:{scope:this.view,toggle:this.view.onSegmentBtnToggle},items:[{flex:1,panelId:0,text:_T("sysinfo","general")},{flex:1,panelId:1,text:_T("sysinfo","network")},{flex:1,panelId:2,text:_T("sysinfo","storage"),onTapCancel:Ext.emptyFn,pressed:true}]}]});SYNO.MobileDSM.views.SysInfoStorage.superclass.initComponent.apply(this,arguments)},onAfterLayout:function(){Ext.each(this.pieQueue,function(a){SYNO.CanvasUtil.drawPieChart(a.id,a.used,[255,204,0],a.free,[51,102,204])},this);this.pieQueue=[]},addVolumeList:function(b){var a;a=new SYNO.MobileDSM.stores.KeyValue();this.stores.push(a);a.loadData(b);this.add({xtype:"fieldset",items:[{xtype:"SYNO.MobileDSM.views.List",scroll:false,pressedCls:"",store:a,itemTpl:{html:"{[this.renderCell(values)]}",initialConfig:{scope:this,renderCell:function(c){if("summary"===c.type){var d=Ext.id();this.scope.pieQueue.push({id:d,used:c.pieData[0],free:c.pieData[1]});return Ext.util.Format.format('<canvas id="{0}" width="80" height="80" style="width: 80px; height: 80px;"></canvas><div class="summary-cell"><div class="title">{1}</div><div class="status">{2}</div><div class="total">{3}</div></div>',d,c.name,c.status,c.size)}return Ext.util.Format.format('<div class="icon-{0}"></div><div class="cell-icon-text">{1}</div><div class="cell-value">{2}</div>',c.type,_T("sysinfo","size_"+c.type),c.size)}}}}]})},getVolumeName:function(c){var b="",a;if(Ext.ApplicationManager.currentApplication.remoteConfig.diskless){a=c.match(/(\d)(-(\d))?/);b="USB Disk";if(a[1]){b+=" "+a[1]}if(a[3]){b+=" Partition "+a[3]}}else{a=c.split("_");switch(a[0]){case"volumeX":b=_T("sysinfo","eunit");break;case"volume":b=_T("sysinfo","volume");break;default:b=_T("sysinfo","volume");break}b+=a[1]}return b},getStatus:function(a){var b,c=_T("sysinfo","status_"+a);if("normal"===a||"standby"===a){b="green"}else{if("crashed"===a||"degraded"===a||"offline"===a){b="red"}else{b="blue"}}return Ext.util.Format.format('<div style="color: {0}">{1}</div>',b,c)},addISCSIList:function(b){var a;a=new SYNO.MobileDSM.stores.KeyValue();this.stores.push(a);a.loadData(b);this.add({xtype:"fieldset",items:[{xtype:"SYNO.MobileDSM.views.List",scroll:false,pressedCls:"",store:a,itemTpl:{html:"{[this.renderCell(values)]}",initialConfig:{scope:this,renderCell:function(c){if("target"===c.type){return Ext.util.Format.format('<div class="iscsi-target" style="width: 80px; height: 80px;"></div><div class="summary-cell"><div class="title">{0}</div><div class="status">{1}</div></div>',c.name,c.status)}if("empty-lun"===c.type){return Ext.util.Format.format("{0}",_T("sysinfo","no_mapped_lun"))}return Ext.util.Format.format('<div class="iscsi-lun"><div class="name">{0}</div><div class="status">{1}</div></div><div class="cell-value">{2}</div>',c.name,c.status,c.size)}}}}]})},getISCSIMappedLuns:function(a){var c=[],b=[];Ext.each(this.iSCSIs.mappings,function(d){if(a===d.target_id){b.push(d.lun_id)}},this);Ext.each(this.iSCSIs.luns,function(d){if(-1!==b.indexOf(d.id)){c.push(d)}},this);return c},loadData:function(){SYNO.Utils.SetBodyMask(true);SYNO.API.currentManager.requestAPI("SYNO.DSM.Volume","list",1,{},this.onLoadVolumeData,this)},onLoadVolumeData:function(a,c,b){if(!SYNO.Utils.CheckAPIResponse(a,c,b)){SYNO.Utils.SetBodyMask(false);return}this.volumes=c.volumes;SYNO.API.currentManager.requestAPI("SYNO.DSM.iSCSI","list",1,{},this.onLoadISCSIData,this)},onLoadISCSIData:function(a,c,b){SYNO.Utils.SetBodyMask(false);if(!SYNO.Utils.CheckAPIResponse(a,c,b)){return}this.iSCSIs=c;this.onLoadData()},onLoadData:function(){var a=[];this.items.each(function(c,b){if(b<1){return}a.push(c)},this);Ext.each(a,function(b){this.remove(b)},this);Ext.each(this.stores,function(b){b.destroyStore()});this.stores=[];if(!this.volumes.length&&!this.iSCSIs.targets.length){this.add({xtype:"fieldset",items:[{xtype:"SYNO.MobileDSM.views.List",scroll:false,itemTpl:"{field1}",store:[[_T("sysinfo","no_volume")]]}]});return}Ext.each(this.volumes,function(c){var d=c.total,b=d?c.used:0,e=d?(d-b):0;this.addVolumeList([{type:"summary",name:this.getVolumeName(c.id),status:this.getStatus(c.status),size:SYNO.Utils.SizeRoundText(d,SYNO.Utils.SizeUnit.MB),pieData:[b,e]},{type:"used",size:SYNO.Utils.SizeRoundText(b,SYNO.Utils.SizeUnit.MB)},{type:"free",size:SYNO.Utils.SizeRoundText(e,SYNO.Utils.SizeUnit.MB)}])},this);Ext.each(this.iSCSIs.targets,function(d){var c=[],b=this.getISCSIMappedLuns(d.id);c.push({type:"target",name:d.name,iqn:d.iqn,status:this.getStatus(d.status)});if(!b.length){c.push({type:"empty-lun"})}else{Ext.each(b,function(e){c.push({type:"lun",name:e.name,status:this.getStatus(e.status),size:SYNO.Utils.SizeRoundText(e.size,SYNO.Utils.SizeUnit.MB)})},this)}this.addISCSIList(c)},this);this.doComponentLayout()}});Ext.reg("SYNO.MobileDSM.views.SysInfoStorage",SYNO.MobileDSM.views.SysInfoStorage);SYNO.MobileDSM.views.UserShareEdit=Ext.extend(Ext.Panel,{initComponent:function(){var a=Ext.ApplicationManager.currentApplication.isTablet;this.modifiedShare={rw:[],ro:[],na:[],clear:[]};this.store=new SYNO.MobileDSM.stores.UserShareList({proxy:{extraParams:{name:SYNO.Utils.QuoteString(this.userInfo.name),user_group_type:"local_user"}}});this.backBtn=false;this.leftBtn={text:_T("common","cancel"),scope:this,handler:this.onCancelTapped};this.rightBtn={ui:"action",text:_T("common","done"),scope:this,handler:this.onDoneTapped};this.list=Ext.create({xtype:"SYNO.MobileDSM.views.List",fillRestItems:true,itemTpl:{html:'<div class="x-list-item-body"><div class="x-list-item-text">{name}</div></div><div class="x-list-disclosure-text">{[this.getPrivilege(values)]}</div><div class="x-list-disclosure-detail"></div>',initialConfig:{scope:this,getPrivilege:function(d){var c,e,b;c=this.scope.getUserSharePrivilege(this.scope.userInfo.name,d.name,d,true);e=this.scope.getUserGroupSharePrivilege(d);b=SYNO.ShareUtils.GetResolvedPrivilege(e,c,false);return SYNO.ShareUtils.GetPrivilegeString(b,false)}}},store:this.store,listeners:{scope:this,itemtap:this.onItemTapped}});Ext.apply(this,{title:this.userInfo.name,ui:a?"round":undefined,layout:"fit",listeners:{scope:this,activate:this.onViewAppear},dockedItems:[{dock:"top",xtype:"toolbar",ui:a?"transparent":"gray",items:[{xtype:"synosearchfield",flex:1,placeHolder:_T("common","search"),store:this.store}]}],items:[this.list]});SYNO.MobileDSM.views.UserShareEdit.superclass.initComponent.apply(this,arguments)},onViewAppear:function(){this.list.refresh()},onItemTapped:function(b,a){var c=b.getStore().getAt(a).data;this.viewport.pushContent(Ext.create({xtype:"SYNO.MobileDSM.views.UserSharePrivEdit",title:c.name,sharename:c.name,username:this.userInfo.name,permInfo:c,delegate:this}))},getUserSharePrivilege:function(e,b,d,a){var c;if(a){c=SYNO.ShareUtils.GetPrivilegeInList(b,this.modifiedShare)}if(!c){c=SYNO.ShareUtils.GetPrivilegeFromPermObj(d)}return c},getUserGroupSharePrivilege:function(a){if("-"==a.inherit){return"clear"}return a.inherit},updateUserSharePrivilege:function(e,c,d,b){var a=this.getUserSharePrivilege(e,c,d,false);this.modifiedShare.rw.remove(c);this.modifiedShare.ro.remove(c);this.modifiedShare.na.remove(c);this.modifiedShare.clear.remove(c);if(a===b||(!a&&"clear"===b)){return}this.modifiedShare[b].push(c)},onCancelTapped:function(){this.viewport.popContent()},onDoneTapped:function(){var a=[];if(SYNO.Utils.CheckIsDemoMode()){return}SYNO.ShareUtils.FillinPermission(a,this.modifiedShare);if(0==a.length){this.viewport.popContent();return}SYNO.Utils.SetBodyMask(true);SYNO.API.currentManager.requestAPI("SYNO.Core.Share.Permission","set_by_user_group",1,{name:SYNO.Utils.QuoteString(this.userInfo.name),user_group_type:"local_user",permissions:Ext.util.JSON.encode(a)},this.onSaveDone,this)},onSaveDone:function(a,c,b){if(!SYNO.Utils.CheckAPIResponse(a,c,b)){SYNO.Utils.SetBodyMask(false);return}SYNO.Utils.SetBodyMask(false);this.viewport.popContent()}});Ext.reg("SYNO.MobileDSM.views.UserShareEdit",SYNO.MobileDSM.views.UserShareEdit);SYNO.MobileDSM.views.SystemInfo=Ext.extend(Ext.Panel,{initComponent:function(){this.rightBtn={iconMask:true,iconCls:"refresh",scope:this,handler:this.loadData};Ext.apply(this,{title:_T("menu","sysinfo"),cls:"system-info",scroll:false,layout:"card",activeItem:0,cardSwitchAnimation:false,listeners:{scope:this,afterlayout:{fn:this.onAfterLayout,single:true}},items:[{xtype:"SYNO.MobileDSM.views.SysInfoGeneral",view:this},{xtype:"SYNO.MobileDSM.views.SysInfoNetwork",view:this},{xtype:"SYNO.MobileDSM.views.SysInfoStorage",view:this}]});SYNO.MobileDSM.views.SystemInfo.superclass.initComponent.apply(this,arguments);this.mon(Ext.Viewport,"resize",this.onViewportResize,this)},onAfterLayout:function(){this.loadData()},onViewportResize:function(){var a=this.getActiveItem();if(!a){return}a.items.getAt(0).doLayout()},onSegmentBtnToggle:function(b,c,d){var a,g,f,e=this.items.indexOf(this.getActiveItem());if(!d){return}this.setActiveItem(c.panelId);g=this.getActiveItem();g.doComponentLayout();g.scroller.scrollTo({x:0,y:0},false);f=g.items.getAt(0);f.doLayout();for(a=0;a<3;++a){f.setPressed(a,(a==c.panelId),true)}},loadData:function(){this.items.each(function(a){if(Ext.isFunction(a.loadData)){a.loadData()}})}});Ext.reg("SYNO.MobileDSM.views.SystemInfo",SYNO.MobileDSM.views.SystemInfo);SYNO.MobileDSM.views.GroupUserEdit=Ext.extend(Ext.Panel,{initComponent:function(){var a=Ext.ApplicationManager.currentApplication.isTablet;this.store=new SYNO.MobileDSM.stores.UserList({proxy:{extraParams:{additional:"group"}}});this.list=Ext.create({xtype:"SYNO.MobileDSM.views.List",itemTpl:{html:'<div class="x-list-item-body"><div class="x-list-item-text">{name}</div></div><div class="x-list-disclosure-{[this.getInGroup(values)]}"></div>',initialConfig:{scope:this,getInGroup:function(c){var b=this.scope.getUserInGroup(c,true);return b?"checked":"unchecked"}}},fillRestItems:true,store:this.store,listeners:{scope:this,itemtap:this.onItemTapped}});Ext.apply(this,{title:this.groupInfo.name,ui:a?"round":undefined,layout:"fit",listeners:{scope:this,activate:this.onViewAppear},dockedItems:[{dock:"top",xtype:"toolbar",ui:a?"transparent":"gray",items:[{xtype:"synosearchfield",flex:1,placeHolder:_T("common","search"),store:this.store}]}],items:[this.list]});SYNO.MobileDSM.views.GroupUserEdit.superclass.initComponent.apply(this,arguments)},onViewAppear:function(){this.list.refresh()},onItemTapped:function(c,a){var b=c.getStore().getAt(a).data,e=b.name,d=!this.getUserInGroup(b,true);this.groupview.modifiedUser.join.remove(e);this.groupview.modifiedUser.leave.remove(e);if(d!==this.getUserInGroup(b,false)){if(d){this.groupview.modifiedUser.join.push(e)}else{this.groupview.modifiedUser.leave.push(e)}}c.refresh()},getUserInGroup:function(a,c){var d=a.name,b=this.groupInfo.name;if(c){if(0<=this.groupview.modifiedUser.join.indexOf(d)){return true}if(0<=this.groupview.modifiedUser.leave.indexOf(d)){return false}}return(0<=a.additional.group.indexOf(b))}});Ext.reg("SYNO.MobileDSM.views.GroupUserEdit",SYNO.MobileDSM.views.GroupUserEdit);SYNO.MobileDSM.views.ResourceMonitor=Ext.extend(Ext.form.FormPanel,{ifaceNames:null,history:null,lineChartMaxData:100,lastUpdateTime:0,initComponent:function(){this.ifaceNames={};this.history={cpu:[],memory:[],netflows:{}};Ext.apply(this,{title:_T("menu","resource_monitor"),cls:"resource-monitor",scroll:true,listeners:{scope:this,afterlayout:{fn:this.onAfterLayout,single:true}},items:[{xtype:"fieldset",cls:"resource-monitor-cpu",title:_T("rsrcmonitor","cpu_usage"),items:[{xtype:"SYNO.MobileDSM.views.List",scroll:false,pressedCls:"",store:[["summary","cpu"],["busy","cpu"]],itemTpl:{html:"{[this.renderCell(values)]}",initialConfig:{scope:this,renderCell:function(a){return this.scope.renderCell(a)}}}}]},{xtype:"fieldset",title:_T("rsrcmonitor","memory_usage"),items:[{xtype:"SYNO.MobileDSM.views.List",scroll:false,pressedCls:"",store:[["summary","memory"],["used","memory"],["free","memory"]],itemTpl:{html:"{[this.renderCell(values)]}",initialConfig:{scope:this,renderCell:function(a){return this.scope.renderCell(a)}}}}]}]});SYNO.Utils.FixScroll(this);SYNO.MobileDSM.views.ResourceMonitor.superclass.initComponent.apply(this,arguments)},onAfterLayout:function(){this.loadData()},renderCell:function(a){var c=a.field1,d=this.id+"-"+a.field2,b=a.field2+"_"+c;if(a.field3){d+="-"+a.field3}if("summary"===c){if("cpu"===a.field2){return Ext.util.Format.format('<canvas id={0} height="70" style="-webkit-box-flex: 1; height: 70px;"></canvas>',d+"-line")}else{if("memory"===a.field2){return Ext.util.Format.format('<canvas id="{0}" width="80" height="80" style="width: 80px; height: 80px;"></canvas><canvas id={1} height="70" style="margin-left: 12px; -webkit-box-flex: 1; height: 70px;"></canvas>',d+"-pie",d+"-line")}else{if("netflow"===a.field2){return Ext.util.Format.format('<canvas id={0} height="70" style="-webkit-box-flex: 1; height: 70px;"></canvas>',d+"-line")}}}}return Ext.util.Format.format('<div class="icon-{0}"></div><div class="cell-icon-text">{1}</div><div class="cell-value" id="{2}"></div>',c,_T("rsrcmonitor",b),d+"-"+c)},loadData:function(){SYNO.Utils.SetBodyMask(true);SYNO.API.currentManager.requestAPI("SYNO.DSM.Network","list",1,{},this.onLoadNetworkData,this)},onLoadNetworkData:function(a,c,b){if(!SYNO.Utils.CheckAPIResponse(a,c,b)){SYNO.Utils.SetBodyMask(false);return}this.ifaceNames=SYNO.NetworkUtils.GetInterfaceNames(c.interfaces);Ext.each(c.interfaces,function(d){this.history.netflows[d.id]={receive:[],transmit:[]};this.add({xtype:"fieldset",title:this.ifaceNames[d.id],items:[{xtype:"SYNO.MobileDSM.views.List",scroll:false,pressedCls:"",store:[["summary","netflow",d.id],["receive","netflow",d.id],["transmit","netflow",d.id]],itemTpl:{html:"{[this.renderCell(values)]}",initialConfig:{scope:this,renderCell:function(e){return this.scope.renderCell(e)}}}}]})},this);this.doComponentLayout();this.doUpdate(this.onLoadData,this)},onLoadData:function(a,c,b){SYNO.Utils.SetBodyMask(false);this.onUpdateDone(a,c,b)},doUpdate:function(a,b){SYNO.API.currentManager.requestAPI("SYNO.DSM.SystemLoading","getinfo",1,{},a,b)},onUpdateDone:function(a,e,d){var b,c=+new Date();if(this.isDestroyed){return}if(!SYNO.Utils.CheckAPIResponse(a,e,d)){return}this.updatePieChart(e.cpu,e.memory,e.netflows);b=1000-(c-this.lastUpdateTime);this.lastUpdateTime=c;Ext.defer(this.doUpdate,Math.max(0,b),this,[arguments.callee,this])},updatePieChart:function(c,f,d){var a,e,b;a=c.user+c.system+c.nice;e=1-a;this.history.cpu.splice(0,0,a);this.history.cpu=this.history.cpu.slice(0,99);SYNO.CanvasUtil.drawLineChart(this.id+"-cpu-line",1,[this.history.cpu],["rgb(0, 168, 240)"]);Ext.get(this.id+"-cpu-busy").update(Ext.util.Numbers.toFixed(100*a,2)+" %");b=f.total;e=f.free+f.buffer+f.cached+f.swap_cached;a=b-e;this.history.memory.splice(0,0,a);this.history.memory=this.history.memory.slice(0,99);SYNO.CanvasUtil.drawPieChart(this.id+"-memory-pie",a,[255,204,0],e,[51,102,204]);SYNO.CanvasUtil.drawLineChart(this.id+"-memory-line",b,[this.history.memory],["rgb(0, 168, 240)"]);Ext.get(this.id+"-memory-used").update(SYNO.Utils.SizeRoundText(a,SYNO.Utils.SizeUnit.KB));Ext.get(this.id+"-memory-free").update(SYNO.Utils.SizeRoundText(e,SYNO.Utils.SizeUnit.KB));Ext.each(d,function(q){var h,k,p,l,n,o,g=q.name,j=this.id+"-netflow-"+g,m=q.receive,r=q.transmit;if(!this.history.netflows[g]){return}h=this.history.netflows[g];h.receive=h.receive.slice(0,this.lineChartMaxData);h.transmit=h.transmit.slice(0,this.lineChartMaxData);h.receive.splice(0,0,m);h.transmit.splice(0,0,r);k=Math.max.apply(Math,h.receive);p=Math.max.apply(Math,h.transmit);l=Math.max(k,p);n=SYNO.Utils.SizeRound(l,SYNO.Utils.SizeUnit.BYTE);o=Math.pow(10,(0.5+Math.log(n.value)/Math.log(10)).toFixed()-1);n.value=o*(0.5+n.value/o).toFixed();l=SYNO.Utils.SizeBytes(n.value,n.unit,SYNO.Utils.SizeUnit.BYTE);this.lineChartMaxData=SYNO.CanvasUtil.drawLineChart(j+"-line",l,[h.receive,h.transmit],["red","green"],n.value,n.unitText+"/s");Ext.get(j+"-receive").update(SYNO.Utils.SizeRoundText(m,SYNO.Utils.SizeUnit.BYTE)+"/s");Ext.get(j+"-transmit").update(SYNO.Utils.SizeRoundText(r,SYNO.Utils.SizeUnit.BYTE)+"/s")},this)}});Ext.reg("SYNO.MobileDSM.views.ResourceMonitor",SYNO.MobileDSM.views.ResourceMonitor);SYNO.MobileDSM.views.Help=Ext.extend(Ext.Panel,{constructor:function(){SYNO.MobileDSM.views.Help.superclass.constructor.call(this,{title:_T("menu","help"),scroll:true,styleHtmlContent:true,styleHtmlCls:"syno_help",layout:"fit",listeners:{scope:this,afterlayout:{fn:this.onAfterLayout,single:true}}});SYNO.Utils.FixScroll(this);SYNO.MobileDSM.HelpView=this},onAfterLayout:function(){var a=_S("lang")||"enu";SYNO.Utils.SetBodyMask(true);Ext.Ajax.request({url:"mapp/help/"+a+"/help.html",scope:this,callback:function(c,b,d){if(b&&d){this.update(d.responseText)}SYNO.Utils.SetBodyMask(false)}})}});Ext.reg("SYNO.MobileDSM.views.Help",SYNO.MobileDSM.views.Help);SYNO.MobileDSM.views.AutoBlock=Ext.extend(Ext.form.FormPanel,{initComponent:function(){this.rightBtn={ui:"action",text:_T("common","done"),disabled:true,scope:this,handler:this.updateAutoBlock};Ext.apply(this,{title:_T("menu","autoblock"),scroll:true,submitOnAction:false,items:[{xtype:"fieldset",defaults:{listeners:{scope:this,change:this.onValueChanged}},items:[{xtype:"togglefield",name:"enabled",label:_T("common","enabled")}]},{hidden:true,xtype:"fieldset",title:_T("common","settings"),defaults:{xtype:"numberfield",labelWidth:"",listeners:{scope:this,blur:this.verifyDataValues,change:this.onValueChanged,keyup:this.onValueChanged}},items:[{name:"attempts",label:_T("autoblock","attempts")},{name:"attemptmin",label:_T("autoblock","attempt_min")},{name:"expiredday",label:_T("autoblock","expired_days")}]},{xtype:"fieldset",items:[{xtype:"SYNO.MobileDSM.views.List",scroll:false,itemTpl:'<div class="x-list-item-body">{field1}</div><div class="x-list-disclosure-chevron"></div>',store:[[_T("autoblock","block_list")]],listeners:{scope:this,itemtap:this.onItemTapped}}]}],listeners:{scope:this,activate:this.onViewAppear,afterlayout:{fn:this.onAfterLayout,single:true}}});SYNO.MobileDSM.views.AutoBlock.superclass.initComponent.apply(this,arguments);this.emailNotifyField=Ext.getCmp(this.emailNotifyField)},onAfterLayout:function(){this.loadData()},onViewAppear:function(){this.onValueChanged()},loadData:function(){SYNO.Utils.SetBodyMask(true);SYNO.API.currentManager.requestAPI("SYNO.DSM.AutoBlock","getconfig",1,{},this.onLoadData,this)},onLoadData:function(a,f,d){var c,b,e={};SYNO.Utils.SetBodyMask(false);if(!SYNO.Utils.CheckAPIResponse(a,f,d)){return}this.data=f;Ext.apply(e,f);e.enabled=e.attempts&&e.attemptmin;if(!e.enabled){e.attempts=5;e.attemptmin=5}this.load(Ext.ModelMgr.create(e,"SYNO.MobileDSM.models.AutoBlock"))},onValueChanged:function(c){var b,a,d;if(!this.data||!this.rightBtnEl){return}b=this.checkDataModified();this.rightBtnEl.setDisabled(!b);if(!c||"enabled"!==c.name){return}d=this.items.get(1);a=!!c.getValue();if(a){d.el.setStyle("opacity",0.01)}d[a?"show":"hide"]({type:"slidefade",direction:"down"})},onItemTapped:function(){this.viewport.pushContent(Ext.create({xtype:"SYNO.MobileDSM.views.AutoBlockList"}))},verifyDataValues:function(){var b=this.getValues(),a=this.items.get(1);if(!(0<b.attempts)){a.items.get(0).setValue(5)}else{if(!(9999>=b.attempts)){a.items.get(0).setValue(9999)}}if(!(0<b.attemptmin)){a.items.get(1).setValue(5)}else{if(!(9999999>=b.attemptmin)){a.items.get(1).setValue(9999999)}}if(!(0<b.expiredday)){a.items.get(2).setValue(0)}else{if(!(9999>=b.expiredday)){a.items.get(2).setValue(9999)}}},checkDataModified:function(){var b,a=this.getValues();if(Ext.isDefined(this.data.enabled)){b=this.data.enabled}else{b=(this.data.attempts&&this.data.attemptmin)}if(!a.enabled||!b){return !!a.enabled!==!!b}return a.attempts!=this.data.attempts||a.attemptmin!=this.data.attemptmin||a.expiredday!=this.data.expiredday},updateAutoBlock:function(){var a,b={};this.verifyDataValues();if(false===this.checkDataModified()){this.rightBtnEl.setDisabled(true);return}a=this.getValues();b.attempts=0;b.attemptmin=0;if(a.enabled){b.attempts=a.attempts;b.attemptmin=a.attemptmin;b.expiredday=a.expiredday}SYNO.Utils.SetBodyMask(true);SYNO.API.currentManager.requestAPI("SYNO.DSM.AutoBlock","setconfig",1,b,this.onUpdateAutoBlockDone,this)},onUpdateAutoBlockDone:function(a,c,b){SYNO.Utils.SetBodyMask(false);if(!SYNO.Utils.CheckAPIResponse(a,c,b)){this.rightBtnEl.setDisabled(false);return}this.rightBtnEl.setDisabled(true);this.data=this.getValues()}});Ext.reg("SYNO.MobileDSM.views.AutoBlock",SYNO.MobileDSM.views.AutoBlock);SYNO.MobileDSM.views.LogViewerEvent=Ext.extend(Ext.Panel,{initComponent:function(){var a=Ext.ApplicationManager.currentApplication.isTablet;this.rightBtn={iconMask:true,iconCls:"refresh",scope:this,handler:this.onRefreshTapped};this.store=new SYNO.MobileDSM.stores.LogViewerEvent({proxy:{extraParams:{logtype:this.logType}}});Ext.apply(this,{cls:"log-viewer",ui:a?"round":undefined,layout:"fit",items:[{xtype:"SYNO.MobileDSM.views.List",itemTpl:'<div class="x-log-icon {level}"></div><div class="x-list-item-body"><div class="x-list-item-text">{[Ext.htmlEncode(values.message)]}</div><div class="x-list-item-detail">{[SYNO.Utils.SimpleTimeString(values.timestamp)]} - {[Ext.htmlEncode(values.user)]}</div></div>',fillRestItems:true,store:this.store,listeners:{scope:this,itemtap:this.onItemTapped}}]});SYNO.MobileDSM.views.LogViewerEvent.superclass.initComponent.apply(this,arguments)},onRefreshTapped:function(){this.store.currentPage=1;this.store.load()},onItemTapped:function(d,b,e){var f=this.store.getAt(b),a=Ext.ApplicationManager.currentApplication.isTablet;var c=new Ext.Panel({cls:"log-viewer-detail-panel",floating:true,centered:true,modal:true,scroll:"vertical",width:a?320:240,height:a?240:200,html:Ext.htmlEncode(f.get("message")),dockedItems:[{dock:"top",ui:"dark",xtype:"toolbar",title:f.get("timestamp").format("Y/m/d H:i:s")}],listeners:{scope:this,hide:this.onDetailPanelHide}});c.show()},onDetailPanelHide:function(a){a.destroy()}});Ext.reg("SYNO.MobileDSM.views.LogViewerEvent",SYNO.MobileDSM.views.LogViewerEvent);SYNO.MobileDSM.views.Connections=Ext.extend(Ext.Panel,{initComponent:function(){var a=Ext.ApplicationManager.currentApplication.isTablet;this.rightBtn={iconMask:true,iconCls:"refresh",scope:this,handler:this.onRefreshTapped};this.store=new SYNO.MobileDSM.stores.Connections({proxy:{extraParams:{logtype:this.logType}}});Ext.apply(this,{cls:"log-viewer",ui:a?"round":undefined,layout:"fit",items:[{xtype:"SYNO.MobileDSM.views.List",grouped:true,itemTpl:'<div class="x-list-item-body"><div class="x-list-item-text">{[Ext.htmlEncode(values.user)]} - {[Ext.htmlEncode(values.activity)]}</div><div class="x-list-item-detail">{[SYNO.Utils.SimpleTimeString(values.timestamp)]} - {[Ext.htmlEncode(values.address)]}</div></div>',fillRestItems:true,store:this.store,listeners:{scope:this,itemtap:this.onItemTapped}}]});SYNO.MobileDSM.views.Connections.superclass.initComponent.apply(this,arguments)},onRefreshTapped:function(){this.store.currentPage=1;this.store.load()},onItemTapped:function(d,b,f){var e,g=this.store.getAt(b),a=Ext.ApplicationManager.currentApplication.isTablet;var c=new Ext.Panel({cls:"log-viewer-detail-panel",floating:true,centered:true,modal:true,scroll:"vertical",width:a?320:240,height:a?240:200,html:Ext.htmlEncode(g.get("address")),dockedItems:[{dock:"top",ui:"dark",xtype:"toolbar",title:g.get("timestamp").format("Y/m/d H:i:s")}],listeners:{scope:this,hide:this.onDetailPanelHide}});c.show()},onDetailPanelHide:function(a){a.destroy()}});Ext.reg("SYNO.MobileDSM.views.Connections",SYNO.MobileDSM.views.Connections);SYNO.MobileDSM.views.GroupShareEdit=Ext.extend(Ext.Panel,{initComponent:function(){var a=Ext.ApplicationManager.currentApplication.isTablet;this.modifiedShare={rw:[],ro:[],na:[],clear:[]};this.store=new SYNO.MobileDSM.stores.GroupShareList({proxy:{extraParams:{name:SYNO.Utils.QuoteString(this.groupInfo.name),user_group_type:"local_group"}}});this.backBtn=false;this.leftBtn={text:_T("common","cancel"),scope:this,handler:this.onCancelTapped};this.rightBtn={ui:"action",text:_T("common","done"),scope:this,handler:this.onDoneTapped};this.list=Ext.create({xtype:"SYNO.MobileDSM.views.List",fillRestItems:true,itemTpl:{html:'<div class="x-list-item-body"><div class="x-list-item-text">{name}</div></div><div class="x-list-disclosure-text">{[this.getPrivilege(values)]}</div><div class="x-list-disclosure-detail"></div>',initialConfig:{scope:this,getPrivilege:function(c){var b=this.scope.getGroupSharePrivilege(this.scope.groupInfo.name,c.name,c,true);return SYNO.ShareUtils.GetPrivilegeString(b,true)}}},store:this.store,listeners:{scope:this,itemtap:this.onItemTapped}});Ext.apply(this,{title:this.groupInfo.name,ui:a?"round":undefined,layout:"fit",listeners:{scope:this,activate:this.onViewAppear},dockedItems:[{dock:"top",xtype:"toolbar",ui:a?"transparent":"gray",items:[{xtype:"synosearchfield",flex:1,placeHolder:_T("common","search"),store:this.store}]}],items:[this.list]});SYNO.MobileDSM.views.GroupShareEdit.superclass.initComponent.apply(this,arguments)},onViewAppear:function(){this.list.refresh()},onItemTapped:function(b,a){var c=b.getStore().getAt(a).data;this.viewport.pushContent(Ext.create({xtype:"SYNO.MobileDSM.views.GroupSharePrivEdit",title:c.name,sharename:c.name,groupname:this.groupInfo.name,permInfo:c,delegate:this}))},getGroupSharePrivilege:function(a,c,e,b){var d;if(b){d=SYNO.ShareUtils.GetPrivilegeInList(c,this.modifiedShare)}if(!d){return SYNO.ShareUtils.GetPrivilegeFromPermObj(e)}return d},updateGroupSharePrivilege:function(a,d,e,c){var b=this.getGroupSharePrivilege(a,d,e,false);this.modifiedShare.rw.remove(d);this.modifiedShare.ro.remove(d);this.modifiedShare.na.remove(d);this.modifiedShare.clear.remove(d);if(b===c||(!b&&"clear"===c)){return}this.modifiedShare[c].push(d)},onCancelTapped:function(){this.viewport.popContent();return},onDoneTapped:function(){var a=[];if(SYNO.Utils.CheckIsDemoMode()){return}SYNO.ShareUtils.FillinPermission(a,this.modifiedShare);if(0==a.length){this.viewport.popContent();return}SYNO.Utils.SetBodyMask(true);SYNO.API.currentManager.requestAPI("SYNO.Core.Share.Permission","set_by_user_group",1,{name:SYNO.Utils.QuoteString(this.groupInfo.name),user_group_type:"local_group",permissions:Ext.util.JSON.encode(a)},this.onSaveDone,this)},onSaveDone:function(a,c,b){if(!SYNO.Utils.CheckAPIResponse(a,c,b)){SYNO.Utils.SetBodyMask(false);return}SYNO.Utils.SetBodyMask(false);this.viewport.popContent()}});Ext.reg("SYNO.MobileDSM.views.GroupShareEdit",SYNO.MobileDSM.views.GroupShareEdit);SYNO.MobileDSM.views.PackageList=Ext.extend(Ext.form.FormPanel,{packages:null,modifiedEnabled:null,modifiedDisabled:null,blSSEnableWarning:false,initComponent:function(){this.rightBtn={ui:"action",text:_T("common","done"),disabled:true,scope:this,handler:this.savePackageData};this.packages={};this.modifiedEnabled=[];this.modifiedDisabled=[];this.blSSEnableWarning=false;Ext.apply(this,{title:_T("menu","package"),cls:"package-switch",scroll:true,listeners:{scope:this,afterlayout:{fn:this.onAfterLayout,single:true}}});SYNO.MobileDSM.views.PackageList.superclass.initComponent.apply(this,arguments)},onAfterLayout:function(){this.loadData()},loadData:function(){SYNO.Utils.SetBodyMask(true);SYNO.API.currentManager.requestAPI("SYNO.DSM.Package","list",1,{},this.onLoadData,this)},onLoadData:function(a,d,c){var b=[];SYNO.Utils.SetBodyMask(false);if(!SYNO.Utils.CheckAPIResponse(a,d,c)){return}this.packages={};Ext.each(d.packages,function(e){this.packages[e.name]=e.enabled?1:0;b.push({name:e.name,label:'<span class="pkg-title">'+Ext.htmlEncode(e.title)+'</span><br/><span class="pkg-version">'+Ext.htmlEncode(e.version)+"</span>"})},this);if(b.length){this.add({xtype:"fieldset",defaults:{xtype:"synotogglefield",listeners:{scope:this,change:this.onValueChanged}},items:b})}else{this.add({xtype:"fieldset",items:[{xtype:"SYNO.MobileDSM.views.List",scroll:false,itemTpl:"{field1}",store:[[_T("package","no_package")]]}]})}this.doComponentLayout();this.setValues(this.packages)},onValueChanged:function(){if(!this.rightBtnEl){return}var a=this.updateModifiedPackages();this.rightBtnEl.setDisabled(!a)},updateModifiedPackages:function(){var b,a=false,c=this.getValues();this.modifiedEnabled=[];this.modifiedDisabled=[];for(b in c){if(!this.packages.hasOwnProperty(b)||this.packages[b]===c[b]){continue}a=true;if(c[b]){this.modifiedEnabled.push(b)}else{this.modifiedDisabled.push(b)}}return a},savePackageData:function(){if(SYNO.Utils.CheckIsDemoMode()){return}if(!this.updateModifiedPackages()){return}if(-1!==this.modifiedEnabled.indexOf("SurveillanceStation")){var a=Ext.ApplicationManager.currentApplication.remoteConfig.services;if(a.hasOwnProperty("NTP")&&!a.NTP){this.blSSEnableWarning=true}}SYNO.Utils.SetBodyMask(true);this.rightBtnEl.setDisabled(true);this.doSavePackageData()},doSavePackageData:function(){var a,b;if(!this.modifiedDisabled.length&&!this.modifiedEnabled.length){this.onSaveDone();return}if(this.modifiedDisabled.length){b=this.modifiedDisabled.pop()}else{if(this.modifiedEnabled.length){a=this.modifiedEnabled.pop()}}SYNO.API.currentManager.requestAPI("SYNO.DSM.Package","setpackage",1,{enabled:a,disabled:b},this.onSavePackageDone,this)},onSavePackageDone:function(a,c,b){if(!SYNO.Utils.CheckAPIResponse(a,c,b)){this.rightBtnEl.setDisabled(false);SYNO.Utils.SetBodyMask(false);return}this.doSavePackageData()},onSaveDone:function(){SYNO.Utils.SetBodyMask(false);this.rightBtnEl.setDisabled(true);this.packages=this.getValues();Ext.ApplicationManager.currentApplication.remoteConfig.packages=this.packages;if(this.blSSEnableWarning){Ext.Msg.alert("",_T("error","ss_enable_warning"));this.blSSEnableWarning=false}}});Ext.reg("SYNO.MobileDSM.views.PackageList",SYNO.MobileDSM.views.PackageList);SYNO.MobileDSM.views.UserList=Ext.extend(Ext.Panel,{listDirty:false,initComponent:function(){var a=Ext.ApplicationManager.currentApplication.isTablet;this.store=new SYNO.MobileDSM.stores.UserList();this.rightBtn={iconMask:true,iconCls:"add",scope:this,handler:this.onAddTapped};Ext.apply(this,{title:_T("menu","user"),ui:a?"round":undefined,layout:"fit",listeners:{scope:this,activate:this.onViewAppear},dockedItems:[{dock:"top",xtype:"toolbar",ui:a?"transparent":"gray",items:[{xtype:"synosearchfield",flex:1,placeHolder:_T("common","search"),store:this.store}]}],items:[{layout:"fit",xtype:"SYNO.MobileDSM.views.List",itemTpl:'<div class="x-list-item-body"><div class="x-list-item-text">{name}</div></div><div class="x-list-disclosure-chevron"></div>',fillRestItems:true,store:this.store,listeners:{scope:this,itemtap:this.onItemTapped}}]});SYNO.MobileDSM.views.UserList.superclass.initComponent.apply(this,arguments)},onViewAppear:function(){if(this.listDirty){this.store.currentPage=1;this.store.load();this.listDirty=false}},onItemTapped:function(b,a){this.viewport.pushContent(Ext.create({xtype:"SYNO.MobileDSM.views.UserEdit",user:this.store.getAt(a).get("name"),listview:this}),{direction:"up"})},onAddTapped:function(){this.viewport.pushContent(Ext.create({xtype:"SYNO.MobileDSM.views.UserEdit",listview:this}),{direction:"up"})}});Ext.reg("SYNO.MobileDSM.views.UserList",SYNO.MobileDSM.views.UserList);SYNO.MobileDSM.views.SysInfoNetwork=Ext.extend(Ext.form.FormPanel,{stores:null,initComponent:function(){this.stores=[];Ext.apply(this,{title:_T("sysinfo","network"),iconCls:"icon-network",scroll:true,items:[{xtype:"segmentedbutton",allowDepress:false,listeners:{scope:this.view,toggle:this.view.onSegmentBtnToggle},items:[{flex:1,panelId:0,text:_T("sysinfo","general")},{flex:1,panelId:1,text:_T("sysinfo","network"),onTapCancel:Ext.emptyFn,pressed:true},{flex:1,panelId:2,text:_T("sysinfo","storage")}]}]});SYNO.MobileDSM.views.SysInfoNetwork.superclass.initComponent.apply(this,arguments)},addInfoList:function(c,b){var a;a=new SYNO.MobileDSM.stores.KeyValue();this.stores.push(a);a.loadData(b);this.add({xtype:"fieldset",title:c,items:[{xtype:"SYNO.MobileDSM.views.List",scroll:false,cls:"x-list-keyvalue",pressedCls:"",itemTpl:'<div class="x-list-key">{key}</div><div class="x-list-value">{value}</div>',store:a}]})},loadData:function(){SYNO.Utils.SetBodyMask(true);SYNO.API.currentManager.requestAPI("SYNO.DSM.Network","list",1,{},this.onLoadData,this)},onLoadData:function(a,e,c){var b=[],d={};SYNO.Utils.SetBodyMask(false);if(!SYNO.Utils.CheckAPIResponse(a,e,c)){return}this.items.each(function(g,f){if(f<1){return}b.push(g)},this);Ext.each(b,function(f){this.remove(f)},this);Ext.each(this.stores,function(f){f.destroyStore()});this.stores=[];this.addInfoList(_T("sysinfo","basic"),[{key:_T("sysinfo","hostname"),value:e.hostname},{key:_T("sysinfo","dns"),value:e.dns[0]},{key:_T("sysinfo","gateway"),value:e.gateway},{key:_T("sysinfo","workgroup"),value:e.workgroup}]);d=SYNO.NetworkUtils.GetInterfaceNames(e.interfaces);Ext.each(e.interfaces,function(g){var f=[];if(g.mac){f.push({key:_T("sysinfo","macaddr"),value:g.mac})}f.push({key:_T("sysinfo","ipaddr"),value:g.ip[0].address},{key:_T("sysinfo","netmask"),value:g.ip[0].netmask});Ext.each(g.ipv6,function(h){var j=h.address;j+="/"+h.prefix_length;j+=" Scope:"+h.scope;f.push({key:_T("sysinfo","ipv6addr"),value:j})},this);this.addInfoList(d[g.id],f)},this);this.doComponentLayout()}});Ext.reg("SYNO.MobileDSM.views.SysInfoNetwork",SYNO.MobileDSM.views.SysInfoNetwork);SYNO.MobileDSM.views.ViewPort=Ext.extend(Ext.Panel,{cardSwitchAnimation:"slide",naviPanel:null,naviTb:null,contentPanel:null,contentTb:null,animating:false,initComponent:function(){this.backBtnCfg={ui:"back",text:_T("common","back"),scope:this,handler:this.popContent};this.initPanelComponent();SYNO.MobileDSM.views.ViewPort.superclass.initComponent.apply(this,arguments);this.mon(this,"afterlayout",this.onAfterLayout,this,{single:true});Ext.Viewport.on("resize",this.onViewportResize,this);SYNO.MobileDSM.History.on("change",this.onHistoryChange,this)},initPanelComponent:function(){console.warm("Please subclass and implement initComponentPanel.")},onAfterLayout:function(){this.togglePanelTb(this.naviPanel,this.naviTb);if(this.naviTb!==this.contentTb){this.togglePanelTb(this.contentPanel,this.contentTb)}},onViewportResize:function(){this.adjustTbTitle(this.naviTb);if(this.naviTb!==this.contentTb){this.adjustTbTitle(this.contentTb)}},setContent:function(b){var a=this.contentPanel;b.viewport=this;a.removeAll();a.add(b);a.setActiveItem(b,false);this.togglePanelTb(this.contentPanel,this.contentTb)},pushContent:function(b,c){if(this.animating){return}var a=this.contentPanel;if(false!==c){b.animation=Ext.apply({type:a.cardSwitchAnimation},c)}else{b.animation=false}b.on("activate",function(d){this.animating=false},this,{single:true});this.animating=true;b.viewport=this;a.add(b);a.setActiveItem(b,b.animation);this.togglePanelTb(this.contentPanel,this.contentTb);SYNO.MobileDSM.History.push()},popContent:function(b){if(this.animating){return}var a=this.contentPanel,e=a.getActiveItem(),d=a.items.indexOf(e),c=a.items.getAt(d-1),f;if(!c){return}if(false!==e.animation){f=Ext.apply({},e.animation,{type:a.cardSwitchAnimation,reverse:true})}else{f=false}c.on("activate",function(g){this.animating=false;this.purgeContent();window.scrollTo(0,1)},this,{single:true});this.animating=true;a.setActiveItem(c,f);this.togglePanelTb(this.contentPanel,this.contentTb);if(true!==b){SYNO.MobileDSM.History.pop()}},purgeContent:function(){var b,a=this.contentPanel,d=a.getActiveItem(),c=a.items.indexOf(d);while((b=a.items.getAt(c+1))){delete a.viewport;delete a.leftBtnEl;delete a.rightBtnEl;a.remove(b)}},onHistoryChange:function(a){if(this.animating){SYNO.MobileDSM.History.push();return}this.popContent(true)},togglePanelTb:function(d,c){var b=d.getActiveItem(),a=d.items.indexOf(b);c.removeAll();c.setTitle(b.title||"");if(a>0&&false!==b.backBtn){c.add(Ext.apply(this.backBtnCfg,b.backBtn))}if(b.leftBtn){b.leftBtnEl=Ext.create(b.leftBtn,"button");c.add(b.leftBtnEl)}if(b.rightBtn){b.rightBtnEl=Ext.create(b.rightBtn,"button");c.add([{xtype:"spacer"},b.rightBtnEl])}c.doLayout();this.adjustTbTitle(c)},adjustTbTitle:function(a){var f,b,e,c=a.el.getBox().left,d={right:0,left:a.getWidth()};e="right";a.items.each(function(g){if("spacer"===g.xtype){e="left"}else{d[e]=g.el.getBox()[e]-c}});a.titleEl.setWidth("auto");b=a.titleEl.getBox();b.left=(a.getWidth()-b.width)/2;if(b.left<d.right+5){b.left=d.right+5;b.width=d.left-d.right-5}a.titleEl.setWidth(b.width+1);a.titleEl.setLeft(b.left)}});SYNO.MobileDSM.views.TabletViewPort=Ext.extend(SYNO.MobileDSM.views.ViewPort,{isTablet:true,initPanelComponent:function(){this.naviTb=new Ext.Toolbar({dock:"top",ui:"dark"});this.naviPanel=new Ext.Panel({dock:"left",width:320,layout:"card",activeItem:0,dockedItems:[this.naviTb],items:[new SYNO.MobileDSM.views.MainMenu({viewport:this})]});this.contentTb=new Ext.Toolbar({dock:"top",ui:"dark"});this.contentPanel=this;Ext.getBody().addCls("x-viewport-tablet");Ext.apply(this,{layout:"card",activeItem:0,dockedItems:[this.naviPanel,this.contentTb],items:[{xtype:"panel",cls:"x-panel-empty"}]})}});Ext.reg("SYNO.MobileDSM.views.TabletViewPort",SYNO.MobileDSM.views.TabletViewPort);SYNO.MobileDSM.views.PhoneViewPort=Ext.extend(SYNO.MobileDSM.views.ViewPort,{isPhone:true,initPanelComponent:function(){this.naviTb=new Ext.Toolbar({dock:"top",ui:"dark"});this.naviPanel=this;this.contentTb=this.naviTb;this.contentPanel=this.naviPanel;Ext.getBody().addCls("x-viewport-phone");Ext.apply(this,{layout:"card",dockedItems:[this.naviTb],items:[new SYNO.MobileDSM.views.MainMenu({viewport:this})]})},setContent:function(a){this.pushContent(a)}});Ext.reg("SYNO.MobileDSM.views.PhoneViewPort",SYNO.MobileDSM.views.PhoneViewPort);SYNO.MobileDSM.views.ShareList=Ext.extend(Ext.Panel,{listDirty:false,initComponent:function(){var a=Ext.ApplicationManager.currentApplication.isTablet;this.store=new SYNO.MobileDSM.stores.ShareList({proxy:{extraParams:{additional:Ext.util.JSON.encode(["encryption"])}}});if(!Ext.ApplicationManager.currentApplication.remoteConfig.diskless){this.rightBtn={iconMask:true,iconCls:"add",scope:this,handler:this.onAddTapped}}Ext.apply(this,{title:_T("menu","share"),ui:a?"round":undefined,layout:"fit",listeners:{scope:this,activate:this.onViewAppear,afterlayout:{fn:this.onAfterLayout,single:true}},dockedItems:[{dock:"top",xtype:"toolbar",ui:a?"transparent":"gray",items:[{xtype:"synosearchfield",flex:1,placeHolder:_T("common","search"),store:this.store}]}],items:[{xtype:"SYNO.MobileDSM.views.List",itemTpl:{html:'<div class="x-list-item-body"><div class="x-list-item-text">{name}</div></div><div class="x-list-disclosure-{[this.getEncrypted(values)]}"></div><div class="x-list-disclosure-chevron"></div>',initialConfig:{scope:this,getEncrypted:function(b){if(b.encryption===SYNO.ShareStatus.ENCRYPTED){return"locked"}if(b.encryption===SYNO.ShareStatus.DECRYPTED){return"unlocked"}return""}}},fillRestItems:true,store:this.store,listeners:{scope:this,itemtap:this.onItemTapped}}]});SYNO.MobileDSM.views.ShareList.superclass.initComponent.apply(this,arguments)},onViewAppear:function(){if(this.listDirty){this.store.currentPage=1;this.store.load();this.listDirty=false}},onAfterLayout:function(){SYNO.Utils.SetBodyMask(true);SYNO.API.currentManager.requestAPI("SYNO.DSM.Service","list",1,{},this.onLoadServiceList,this)},onLoadServiceList:function(a,d,c){var b={};if(!SYNO.Utils.CheckAPIResponse(a,d,c)){SYNO.Utils.SetBodyMask(false);return}Ext.each(d.services,function(e){b[e.name]=e.enabled},this);Ext.ApplicationManager.currentApplication.remoteConfig.services=b;SYNO.API.currentManager.requestAPI("SYNO.DSM.Package","list",1,{},this.onLoadPackageList,this)},onLoadPackageList:function(a,d,c){var b={};if(!SYNO.Utils.CheckAPIResponse(a,d,c)){SYNO.Utils.SetBodyMask(false);return}Ext.each(d.packages,function(e){b[e.name]=e.enabled},this);Ext.ApplicationManager.currentApplication.remoteConfig.packages=b;this.onLoadDone()},onLoadDone:function(){SYNO.Utils.SetBodyMask(false)},onItemTapped:function(b,a){this.viewport.pushContent(Ext.create({xtype:"SYNO.MobileDSM.views.ShareEdit",share:this.store.getAt(a).get("name"),shareInfo:this.store.getAt(a).data,listview:this}),{direction:"up"})},onAddTapped:function(){this.viewport.pushContent(Ext.create({xtype:"SYNO.MobileDSM.views.ShareEdit",listview:this}),{direction:"up"})}});Ext.reg("SYNO.MobileDSM.views.ShareList",SYNO.MobileDSM.views.ShareList);SYNO.MobileDSM.views.UserEdit=Ext.extend(Ext.form.FormPanel,{modifiedApp:null,modifiedGroup:null,emailNotifyField:null,emptyPwd:"",initComponent:function(){var a=[],c=[],b;this.backBtn=false;this.leftBtn={text:_T("common","cancel"),scope:this,handler:this.onCancelTapped};this.rightBtn={ui:"action",text:_T("common","done"),scope:this,handler:this.onDoneTapped};this.modifiedApp={enabled:[],disabled:[]};this.modifiedGroup={join:[],leave:[]};if(!this.user||!this.isSpecialUser(this.user)){c.push({xtype:"textfield",name:"name",label:_T("common","name"),labelWidth:"",placeHolder:_T("common","field_required")})}if(this.user){this.emptyPwd=Ext.id()}c.push({xtype:"passwordfield",name:"password",value:this.emptyPwd,label:_T("common","password"),labelWidth:""});if(!this.user||!this.isSpecialUser(this.user)){c.push({xtype:"emailfield",name:"email",label:_T("user","email"),labelWidth:"",listeners:{scope:this,keyup:this.onEmailKeyUp}})}if(!this.user){c.push({id:(this.emailNotifyField=Ext.id()),xtype:"synotogglefield",name:"email_notify",label:_T("user","send_notify_email"),disabled:true})}if(this.user&&_S("username").toLowerCase()!==this.user.toLowerCase()){c.push({xtype:"synotogglefield",name:"disabled",label:_T("user","disable")});if(!this.isSpecialUser(this.user)){c.push({xtype:"togglefield",name:"administrator",label:_T("user","administrator")})}}a.push({xtype:"fieldset",items:c});if(this.user){a.push({xtype:"fieldset",items:[{xtype:"SYNO.MobileDSM.views.List",scroll:false,itemTpl:'<div class="x-list-item-body">{field1}</div><div class="x-list-disclosure-chevron"></div>',store:[[_T("menu","group"),"group"]],listeners:{scope:this,itemtap:this.onItemTapped}}]});b=[[_T("user","share"),"share"]];if(!this.isSpecialUser(this.user)){b.push([_T("user","application"),"app"])}a.push({xtype:"fieldset",title:_T("common","privilege"),items:[{xtype:"SYNO.MobileDSM.views.List",scroll:false,itemTpl:'<div class="x-list-item-body">{field1}</div><div class="x-list-disclosure-chevron"></div>',store:b,listeners:{scope:this,itemtap:this.onItemTapped}}]})}if(this.user&&_S("username").toLowerCase()!==this.user.toLowerCase()&&!this.isSpecialUser(this.user)){a.push({xtype:"button",ui:"decline",text:_T("common","delete")+" "+this.user,scope:this,handler:this.onDeleteTapped})}Ext.apply(this,{title:this.user||_T("common","add"),scroll:true,submitOnAction:false,items:a,listeners:{scope:this,afterlayout:{fn:this.onAfterLayout,single:true}}});SYNO.MobileDSM.views.UserEdit.superclass.initComponent.apply(this,arguments);this.emailNotifyField=Ext.getCmp(this.emailNotifyField)},onAfterLayout:function(){this.loadData()},onEmailKeyUp:function(a){if(!this.emailNotifyField){return}this.emailNotifyField.setDisabled(!a.getValue())},isSpecialUser:function(a){var b=a.toLowerCase();return("admin"===b||"guest"===b)},loadData:function(){if(!this.user){return}SYNO.Utils.SetBodyMask(true);SYNO.API.currentManager.requestAPI("SYNO.DSM.User","getinfo",1,{users:this.user,additional:"detail,group,application"},this.onLoadData,this)},onLoadData:function(a,f,d){var c,b,e={};SYNO.Utils.SetBodyMask(false);if(!SYNO.Utils.CheckAPIResponse(a,f,d)){return}b=f.users[0];this.userInfo=b;if(!this.user||!this.isSpecialUser(this.user)){e.name=b.name}e.password=this.emptyPwd;e.email=b.additional.detail.email;if(this.user&&_S("username").toLowerCase()!==this.user.toLowerCase()){e.disabled=b.additional.detail.disabled;e.administrator=(-1<b.additional.group.indexOf("administrators"))}this.load(Ext.ModelMgr.create(e,"SYNO.MobileDSM.models.User"))},onItemTapped:function(b,a){var c=b.getStore().getAt(a);if("share"===c.get("field2")){this.viewport.pushContent(Ext.create({xtype:"SYNO.MobileDSM.views.UserShareEdit",userInfo:this.userInfo,userview:this}))}else{if("app"===c.get("field2")){this.viewport.pushContent(Ext.create({xtype:"SYNO.MobileDSM.views.UserAppEdit",userInfo:this.userInfo,userview:this}))}else{if("group"===c.get("field2")){this.viewport.pushContent(Ext.create({xtype:"SYNO.MobileDSM.views.UserGroupEdit",userInfo:this.userInfo,userview:this}))}}}},setControllerEnabled:function(a){var b=a?"enable":"disable";this.items.getAt(0).items.each(function(c){c[b]()})},onDoneTapped:function(){if(SYNO.Utils.CheckIsDemoMode()){return}var b=/^[0-9A-Za-z!#$%&'*+\-\/=?^_`{|}~]+(\.[0-9A-Za-z!#$%&'*+\-\/=?^_`{|}~]+)*@([A-Za-z0-9]([A-Za-z0-9\-]*[A-Za-z0-9])?\.)+[A-Za-z]{2,5}$/,a=this.getValues();if(a.email&&!b.test(a.email)){Ext.Msg.alert("",_T("error","bad_email"));return}if(!a.password||this.emptyPwd===a.password){this.doSaveUser();return}this.setControllerEnabled(false);Ext.defer(function(){Ext.Msg.prompt("",_T("common","password_confirm"),this.onPasswordConfirm,this,false,"",{type:"password"})},200,this)},onPasswordConfirm:function(a,c){this.setControllerEnabled(true);var b=this.getValues();if("ok"!==a){return}if(c!==b.password){Ext.defer(function(){Ext.Msg.alert("",_T("error","password_confirm"))},1);return}this.doSaveUser()},doSaveUser:function(){SYNO.Utils.SetBodyMask(true);if(this.user){this.saveUserData()}else{this.createUserData()}},onCancelTapped:function(){this.viewport.popContent()},onDeleteTapped:function(){if(SYNO.Utils.CheckIsDemoMode()){return}Ext.Msg.confirm("",_T("user","delete_confirm"),this.onDeleteConfirm,this)},onDeleteConfirm:function(a){if("yes"!==a){return}SYNO.Utils.SetBodyMask(true);SYNO.API.currentManager.requestAPI("SYNO.DSM.User","delete",1,{users:this.user},this.onDeleteUserDone,this)},onDeleteUserDone:function(a,c,b){if(!SYNO.Utils.CheckAPIResponse(a,c,b)){SYNO.Utils.SetBodyMask(false);return}if(this.listview){this.listview.listDirty=true}this.onSaveDone()},createUserData:function(){var a=this.getValues(),b={};b.name=a.name;b.email=a.email;b.sendCreateMail=a.email_notify?"true":"false";if(this.emptyPwd!==a.password){b.password=a.password}SYNO.API.currentManager.requestAPI("SYNO.DSM.User","create",1,b,this.onCreateUserDataDone,this)},onCreateUserDataDone:function(a,c,b){if(!SYNO.Utils.CheckAPIResponse(a,c,b)){SYNO.Utils.SetBodyMask(false);return}if(this.listview){this.listview.listDirty=true}this.onSaveDone()},saveUserData:function(){var b=false,d={},a=this.record,c=Ext.ModelMgr.create({},"SYNO.MobileDSM.models.User");this.updateRecord(c,false);if(c.get("name")!==a.get("name")){d.name=c.get("name");b=true}if(this.emptyPwd!==c.get("password")){d.password=c.get("password");b=true}if(c.get("email")!==a.get("email")){d.email=c.get("email");b=true}if(c.get("disabled")!==a.get("disabled")){d.expire=c.get("disabled")?"now":-1;b=true}if(!b){this.saveLeaveGroup();return}SYNO.API.currentManager.requestAPI("SYNO.DSM.User","edit",1,Ext.apply(d,{user:this.user}),this.onSaveUserDataDone,this)},onSaveUserDataDone:function(a,d,c){var b=this.getValues().name;if(!SYNO.Utils.CheckAPIResponse(a,d,c)){SYNO.Utils.SetBodyMask(false);return}if(this.listview&&this.user!==b){this.user=b;this.listview.listDirty=true}this.saveLeaveGroup()},saveLeaveGroup:function(){var a=this.record,c=Ext.ModelMgr.create({},"SYNO.MobileDSM.models.User"),b=this.modifiedGroup.leave;this.updateRecord(c,false);if(!c.get("administrator")&&a.get("administrator")){b.push("administrators")}if(!b.length){this.saveJoinGroup();return}SYNO.API.currentManager.requestAPI("SYNO.DSM.Group","removeusers",1,{users:this.user,groups:b.join(",")},this.onSaveLeaveGroupDone,this)},onSaveLeaveGroupDone:function(a,c,b){if(!SYNO.Utils.CheckAPIResponse(a,c,b)){SYNO.Utils.SetBodyMask(false);return}this.saveJoinGroup()},saveJoinGroup:function(){var a=this.record,c=Ext.ModelMgr.create({},"SYNO.MobileDSM.models.User"),b=this.modifiedGroup.join;this.updateRecord(c,false);if(c.get("administrator")&&!a.get("administrator")){b.push("administrators")}if(!b.length){this.saveAppData();return}SYNO.API.currentManager.requestAPI("SYNO.DSM.Group","addusers",1,{users:this.user,groups:b.join(",")},this.onSaveJoinGroupDone,this)},onSaveJoinGroupDone:function(a,c,b){if(!SYNO.Utils.CheckAPIResponse(a,c,b)){SYNO.Utils.SetBodyMask(false);return}this.saveAppData()},saveAppData:function(){var b=this.modifiedApp,a=null;if(b.enabled.length){a="enabled"}else{if(b.disabled.length){a="disabled"}}if(!a){this.onSaveDone();return}SYNO.API.currentManager.requestAPI("SYNO.DSM.Application","setuserprivilege",1,{enabled:("enabled"===a),users:this.user,applications:b[a].join(",")},this.onSaveAppDataDone,this)},onSaveAppDataDone:function(a,c,b){if(!SYNO.Utils.CheckAPIResponse(a,c,b)){SYNO.Utils.SetBodyMask(false);return}this.modifiedApp[b.enabled?"enabled":"disabled"]=[];this.saveAppData()},onSaveDone:function(){SYNO.Utils.SetBodyMask(false);this.viewport.popContent()}});Ext.reg("SYNO.MobileDSM.views.UserEdit",SYNO.MobileDSM.views.UserEdit);SYNO.MobileDSM.views.LogViewerMenu=Ext.extend(Ext.form.FormPanel,{initComponent:function(){this.monitorItems=[{xtype:"SYNO.MobileDSM.views.Connections",title:_T("log_viewer","current_connection")}];this.eventItems=[{xtype:"SYNO.MobileDSM.views.LogViewerEvent",logType:"system",title:_T("log_viewer","system")},{xtype:"SYNO.MobileDSM.views.LogViewerEvent",logType:"connection",title:_T("log_viewer","connection")},{xtype:"SYNO.MobileDSM.views.LogViewerEvent",logType:"copy",title:_T("log_viewer","copy")},{xtype:"SYNO.MobileDSM.views.LogViewerEvent",logType:"backup",title:_T("log_viewer","backup")},{xtype:"SYNO.MobileDSM.views.LogViewerEvent",logType:"network_backup",title:_T("log_viewer","network_backup")}];this.xferItems=[{xtype:"SYNO.MobileDSM.views.LogViewerXfer",logType:"xfer_ftp",title:_T("log_viewer","ftp")},{xtype:"SYNO.MobileDSM.views.LogViewerXfer",logType:"xfer_webdav",title:_T("log_viewer","webdav")},{xtype:"SYNO.MobileDSM.views.LogViewerXfer",logType:"xfer_fm",title:_T("log_viewer","file_browser")},{xtype:"SYNO.MobileDSM.views.LogViewerXfer",logType:"xfer_samba",title:_T("log_viewer","samba")}];Ext.apply(this,{title:_T("menu","log_viewer"),scroll:true,listeners:{scope:this,activate:{fn:this.onViewFirstAppeared,single:true}}});SYNO.MobileDSM.views.LogViewerMenu.superclass.initComponent.apply(this,arguments)},onViewFirstAppeared:function(){this.loadData()},loadData:function(){SYNO.Utils.SetBodyMask(true);SYNO.API.currentManager.requestAPI("SYNO.DSM.LogViewer","supported",1,{},this.onLoadData,this)},onLoadData:function(a,e,d){var c,b;SYNO.Utils.SetBodyMask(false);if(!SYNO.Utils.CheckAPIResponse(a,e,d)){return}c=[];Ext.each(this.eventItems,function(f){if(-1===e.indexOf(f.logType)){c.push(f)}});Ext.each(c,function(f){this.eventItems.remove(f)},this);c=[];Ext.each(this.xferItems,function(f){if(-1===e.indexOf(f.logType)){c.push(f)}});Ext.each(c,function(f){this.xferItems.remove(f)},this);b=new SYNO.MobileDSM.stores.LogViewerMenu();b.loadData(this.monitorItems);this.add({xtype:"fieldset",title:_T("log_viewer","monitor"),items:[{xtype:"SYNO.MobileDSM.views.List",scroll:false,itemTpl:'<div class="x-list-item-body">{title}</div><div class="x-list-disclosure-chevron"></div>',store:b,listeners:{scope:this,itemtap:this.onItemTapped}}]});if(this.eventItems.length){b=new SYNO.MobileDSM.stores.LogViewerMenu();b.loadData(this.eventItems);this.add({xtype:"fieldset",title:_T("log_viewer","event_log"),items:[{xtype:"SYNO.MobileDSM.views.List",scroll:false,itemTpl:'<div class="x-list-item-body">{title}</div><div class="x-list-disclosure-chevron"></div>',store:b,listeners:{scope:this,itemtap:this.onItemTapped}}]})}if(this.xferItems.length){b=new SYNO.MobileDSM.stores.LogViewerMenu();b.loadData(this.xferItems);this.add({xtype:"fieldset",title:_T("log_viewer","transfer_log"),items:[{xtype:"SYNO.MobileDSM.views.List",scroll:false,itemTpl:'<div class="x-list-item-body">{title}</div><div class="x-list-disclosure-chevron"></div>',store:b,listeners:{scope:this,itemtap:this.onItemTapped}}]})}this.doComponentLayout()},onItemTapped:function(b,a){var c=b.getStore().getAt(a),d=c.get("xtype");if(d){this.viewport.pushContent(Ext.create({xtype:d,title:c.get("title"),logType:c.get("logType")}))}}});Ext.reg("SYNO.MobileDSM.views.LogViewerMenu",SYNO.MobileDSM.views.LogViewerMenu);SYNO.MobileDSM.views.GroupSharePrivEdit=Ext.extend(Ext.form.FormPanel,{initComponent:function(){this.backBtn={scope:this,handler:this.onBackTapped};this.origGroupPriv=this.delegate.getGroupSharePrivilege(this.groupname,this.sharename,this.permInfo,false);this.groupPriv=this.delegate.getGroupSharePrivilege(this.groupname,this.sharename,this.permInfo,true);Ext.apply(this,{scroll:true,submitOnAction:false,items:[{xtype:"fieldset",defaults:{xtype:"checkboxfield",listeners:{scope:this,check:this.onPrivChecked,uncheck:this.onPrivUnChecked}},items:[{name:"priv",label:_T("share","priv_na"),value:"na",checked:"na"===this.groupPriv},{name:"priv",label:_T("share","priv_rw"),value:"rw",checked:"rw"===this.groupPriv},{name:"priv",label:_T("share","priv_ro"),value:"ro",checked:"ro"===this.groupPriv}]}]});SYNO.MobileDSM.views.GroupSharePrivEdit.superclass.initComponent.apply(this,arguments)},onBackTapped:function(){this.delegate.updateGroupSharePrivilege(this.groupname,this.sharename,this.permInfo,this.groupPriv);this.viewport.popContent()},onPrivChecked:function(a){this.groupPriv=a.value;this.setValues({priv:a.value})},onPrivUnChecked:function(a){if(a.value!==this.groupPriv){return}if("cu"!==this.origGroupPriv){this.groupPriv="clear"}else{this.groupPriv="cu"}}});Ext.reg("SYNO.MobileDSM.views.GroupSharePrivEdit",SYNO.MobileDSM.views.GroupSharePrivEdit);SYNO.MobileDSM.views.MainMenu=Ext.extend(SYNO.MobileDSM.views.List,{initComponent:function(){this.leftBtn={text:_T("common","logout"),scope:this,handler:this.onLogout};this.rightBtn={iconMask:true,iconCls:"action",scope:this,handler:this.onMoreAction};this.createMoreActionSheet();this.store=new SYNO.MobileDSM.stores.MainMenu();Ext.apply(this,{title:_S("hostname"),cls:"mainmenu",grouped:true,itemTpl:'<div class="x-menu-icon {iconCls}"></div><div class="x-list-item-body"><div class="x-list-item-text">{title}</div></div><tpl if="disclosureCls"><div class="x-list-disclosure-{disclosureCls}"></div></tpl>',store:this.store,listeners:{scope:this,activate:this.onViewAppear,itemtap:this.onItemTapped}});SYNO.MobileDSM.views.MainMenu.superclass.initComponent.apply(this,arguments)},onViewAppear:function(){this.refreshStore()},getAppItem:function(a,d,c){var b;if(Ext.is.Android&&Ext.is.Chrome){b="intent://#Intent;scheme="+a+";package="+this.getAndroidAppPackage(a)+";end"}else{b=a+"://"}return{groupId:1,title:d,iconCls:c,disclosureCls:"launch",xtype:a,url:b}},refreshStore:function(){var d,a=Ext.ApplicationManager.currentApplication.isTablet,b=Ext.ApplicationManager.currentApplication.remoteConfig.services,c=Ext.ApplicationManager.currentApplication.remoteConfig.packages;d=[{groupId:0,title:_T("menu","user"),iconCls:"user",disclosureCls:a?undefined:"chevron",xtype:"SYNO.MobileDSM.views.UserList"},{groupId:0,title:_T("menu","group"),iconCls:"group",disclosureCls:a?undefined:"chevron",xtype:"SYNO.MobileDSM.views.GroupList"},{groupId:0,title:_T("menu","share"),iconCls:"shared_folder",disclosureCls:a?undefined:"chevron",xtype:"SYNO.MobileDSM.views.ShareList"},{groupId:0,title:_T("menu","service"),iconCls:"service",disclosureCls:a?undefined:"chevron",xtype:"SYNO.MobileDSM.views.ServiceList"},{groupId:0,title:_T("menu","autoblock"),iconCls:"autoblock",disclosureCls:a?undefined:"chevron",xtype:"SYNO.MobileDSM.views.AutoBlock"},{groupId:0,title:_T("menu","package"),iconCls:"package",disclosureCls:a?undefined:"chevron",xtype:"SYNO.MobileDSM.views.PackageList"},{groupId:0,title:_T("menu","sysinfo"),iconCls:"system_info",disclosureCls:a?undefined:"chevron",xtype:"SYNO.MobileDSM.views.SystemInfo"},{groupId:0,title:_T("menu","log_viewer"),iconCls:"log_viewer",disclosureCls:a?undefined:"chevron",xtype:"SYNO.MobileDSM.views.LogViewerMenu"},{groupId:0,title:_T("menu","resource_monitor"),iconCls:"resource_monitor",disclosureCls:a?undefined:"chevron",xtype:"SYNO.MobileDSM.views.ResourceMonitor"},{groupId:0,title:_T("menu","help"),iconCls:"help",disclosureCls:a?undefined:"chevron",xtype:"SYNO.MobileDSM.views.Help"}];if(!Ext.is.CustomizediOS&&!Ext.is.Standalone&&(Ext.is.iOS||Ext.is.Android)){if(c.AudioStation){d.push(this.getAppItem("synoaudio","DS audio","ds_audio"))}if(c.PhotoStation){d.push(this.getAppItem("synophoto","DS photo+","ds_photo"))}if(c.DownloadStation){d.push(this.getAppItem("synodownload","DS download","ds_download"))}if(c.VideoStation){d.push(this.getAppItem("synovideo","DS video","ds_video"))}if(c.SurveillanceStation){d.push(this.getAppItem("synocam","DS cam","ds_cam"))}d.push(this.getAppItem("synofile","DS file","ds_file"));if(c.NoteStation){d.push(this.getAppItem("synonote","DS note","ds_note"))}if(c.CloudStation){d.push(this.getAppItem("synocloud","DS cloud","ds_cloud"))}}this.store.loadData(d)},createMoreActionSheet:function(){var a=[{hidden:!Ext.ApplicationManager.currentApplication.remoteConfig.supportFindMe,text:_T("menu","findme"),scope:this,handler:this.onTapFindMe},{text:_T("menu","reboot"),scope:this,handler:this.onTapReboot},{hidden:Ext.ApplicationManager.currentApplication.remoteConfig.diskless,text:_T("menu","shutdown"),scope:this,handler:this.onTapShutdown},{text:_T("common","desktop_edition"),scope:this,handler:this.onTapDesktop}];if(this.viewport.isTablet){this.moreActionSheet=new Ext.Panel({cls:"x-panel-popover",floating:true,width:280,defaults:{xtype:"button"},items:a})}else{a.push({cls:"x-button-cancel",ui:"action",text:_T("common","cancel"),scope:this,handler:this.onCancelMoreAction});this.moreActionSheet=new Ext.ActionSheet({items:a})}},onItemTapped:function(b,a){var d=this.getStore().getAt(a),c=d.get("url"),e=d.get("xtype");if(c){this.openAppUrl(c,e)}else{if(e){this.viewport.setContent(Ext.create({xtype:e}))}}},openAppUrl:function(a,d){var c,b;if(Ext.is.Android&&Ext.is.Chrome){window.location=a;return}b=Ext.get("iframe_app");if(!b){b=Ext.getBody().createChild({id:"iframe_app",tag:"iframe",cls:"x-hidden-display"})}if(Ext.is.iOS){if(Ext.is.ChromeiOS){window.location=a;b.dom.src=this.getAppDownloadUrl(d)}else{window.location=this.getAppDownloadUrl(d)}return}c=+new Date();Ext.defer(function(){var e=+new Date();if(2000>(e-c)){Ext.defer(function(){var f=this.getAppDownloadUrl(d);if(f){b.dom.src=f}},500,this)}},1500,this);b.dom.src=a},getAndroidAppPackage:function(a){data={synoaudio:"com.synology.DSaudio",synophoto:"com.synology.dsphoto",synocam:"com.synology.DScam",synofile:"com.synology.DSfile",synovideo:"com.synology.dsvideo",synodownload:"com.synology.DSdownload",synonote:"com.synology.dsnote",synocloud:"com.synology.dscloud"};return data[a]},getAppDownloadUrl:function(a){var b;if(Ext.is.iOS){b={synoaudio:"http://itunes.apple.com/app/ds-audio/id321495303?mt=8",synophoto:"http://itunes.apple.com/app/ds-photo/id321493106?mt=8",synocam:"http://itunes.apple.com/app/ds-cam/id349087111?mt=8",synofile:"http://itunes.apple.com/app/ds-file/id416751772?mt=8",synovideo:"http://itunes.apple.com/app/ds-video/id540949418?mt=8",synodownload:"http://itunes.apple.com/app/ds-download/id540948028?mt=8",synonote:"http://itunes.apple.com/app/ds-note/id918177542?mt=8",synocloud:"http://itunes.apple.com/app/ds-cloud/id590216612?mt=8"}}else{if(Ext.is.Android){b={synoaudio:"market://details?id="+this.getAndroidAppPackage("synoaudio"),synophoto:"market://details?id="+this.getAndroidAppPackage("synophoto"),synocam:"market://details?id="+this.getAndroidAppPackage("synocam"),synofile:"market://details?id="+this.getAndroidAppPackage("synofile"),synovideo:"market://details?id="+this.getAndroidAppPackage("synovideo"),synodownload:"market://details?id="+this.getAndroidAppPackage("synodownload"),synonote:"market://details?id="+this.getAndroidAppPackage("synonote"),synocloud:"market://details?id="+this.getAndroidAppPackage("synocloud")}}}return b[a]},onLogout:function(){Ext.Msg.confirm("",_T("common","logout_confirm"),this.onLogoutConfirm,this)},onLogoutConfirm:function(a){if("yes"!==a){return}window.location="logout.cgi"},onTapFindMe:function(){this.moreActionSheet.hide();if(SYNO.Utils.CheckIsDemoMode()){return}this.doFindMe();this.findMeTask=setInterval(this.doFindMe,10000);Ext.Msg.alert("",_T("menu","findme_stop"),this.onTapFindMeStop,this)},onTapFindMeStop:function(){clearInterval(this.findMeTask);this.doFindMe(true)},onTapReboot:function(){this.moreActionSheet.hide();if(SYNO.Utils.CheckIsDemoMode()){return}Ext.Msg.confirm("",_T("menu","reboot_confirm"),this.onTapRebootConfirm,this)},onTapRebootConfirm:function(a){if("yes"!==a){return}SYNO.Utils.SetBodyMask(true);SYNO.API.currentManager.requestAPI("SYNO.DSM.System","reboot",1,{},function(b,d,c){SYNO.Utils.SetBodyMask(false);if(!SYNO.Utils.CheckAPIResponse(b,d,c)){return}Ext.Msg.show({buttons:[],msg:_T("menu","rebooting")})},this)},onTapShutdown:function(){this.moreActionSheet.hide();if(SYNO.Utils.CheckIsDemoMode()){return}Ext.Msg.confirm("",_T("menu","shutdown_confirm"),this.onTapShutdownConfirm,this)},onTapShutdownConfirm:function(a){if("yes"!==a){return}SYNO.Utils.SetBodyMask(true);SYNO.API.currentManager.requestAPI("SYNO.DSM.System","shutdown",1,{},function(b,d,c){SYNO.Utils.SetBodyMask(false);if(!SYNO.Utils.CheckAPIResponse(b,d,c)){return}Ext.Msg.show({buttons:[],msg:_T("menu","shutting_down")})},this)},onTapDesktop:function(){window.location="?forceDesktop=1"},onCancelMoreAction:function(){this.moreActionSheet.hide()},onMoreAction:function(){if(this.viewport.isTablet){this.moreActionSheet.showBy(this.rightBtnEl,false)}else{this.moreActionSheet.show()}},doFindMe:function(a){SYNO.API.currentManager.requestAPI("SYNO.DSM.FindMe",a?"stop":"start",1,{})}});SYNO.MobileDSM.views.UserAppEdit=Ext.extend(Ext.form.FormPanel,{initComponent:function(){this.appInfo=this.userInfo.additional.application;Ext.apply(this,{title:this.userInfo.name,scroll:true,listeners:{scope:this,beforedeactivate:this.onBeforeDeactivate,afterlayout:{fn:this.onAfterLayout,single:true}}});SYNO.MobileDSM.views.UserAppEdit.superclass.initComponent.apply(this,arguments)},onAfterLayout:function(){this.loadData()},onBeforeDeactivate:function(){this.updateAppPrivilege()},loadData:function(){SYNO.Utils.SetBodyMask(true);SYNO.API.currentManager.requestAPI("SYNO.DSM.Application","list",1,{},this.onLoadData,this)},onLoadData:function(a,e,d){var b=[],c={};SYNO.Utils.SetBodyMask(false);if(!SYNO.Utils.CheckAPIResponse(a,e,d)){return}Ext.each(e.applications,function(f){b.push({name:f.id,label:f.name});c[f.id]=this.getAppEnabled(f.id,true)},this);b.sort(function(g,f){var j=g.label,h=f.label;if(j===h){return 0}else{if(j<h){return -1}else{return 1}}});this.add({xtype:"fieldset",defaults:{xtype:"checkboxfield"},items:b});this.setValues(c);this.doLayout()},getAppEnabled:function(b,a){var d=this.userview,c=d.modifiedApp;if(a){if(0<=c.enabled.indexOf(b)){return true}if(0<=c.disabled.indexOf(b)){return false}}if(0<=this.appInfo.indexOf(b)){return true}return false},updateAppPrivilege:function(){var a,b=this.getValues();for(a in b){this.userview.modifiedApp.enabled.remove(a);this.userview.modifiedApp.disabled.remove(a);if((null===b[a])===!this.getAppEnabled(a,false)){continue}if(null!==b[a]){this.userview.modifiedApp.enabled.push(a)}else{this.userview.modifiedApp.disabled.push(a)}}}});Ext.reg("SYNO.MobileDSM.views.UserAppEdit",SYNO.MobileDSM.views.UserAppEdit);SYNO.MobileDSM.views.ShareUserEdit=Ext.extend(Ext.Panel,{initComponent:function(){var a=Ext.ApplicationManager.currentApplication.isTablet;this.modifiedUser={na:[],rw:[],ro:[],clear:[]};this.backBtn=false;this.leftBtn={text:_T("common","cancel"),scope:this,handler:this.onCancelTapped};this.rightBtn={ui:"action",text:_T("common","done"),scope:this,handler:this.onDoneTapped};this.store=new SYNO.MobileDSM.stores.ShareUserList({proxy:{extraParams:{name:SYNO.Utils.QuoteString(this.shareInfo.name),user_group_type:"local_user",with_inherit:true}}});this.list=Ext.create({xtype:"SYNO.MobileDSM.views.List",itemTpl:{html:'<div class="x-list-item-body"><div class="x-list-item-text">{name}</div></div><div class="x-list-disclosure-text">{[this.getPrivilege(values)]}</div><div class="x-list-disclosure-detail"></div>',initialConfig:{scope:this,getPrivilege:function(d){var c,e,b;c=this.scope.getUserSharePrivilege(d.name,this.scope.shareInfo.name,d,true);e=this.scope.getUserGroupSharePrivilege(d);b=SYNO.ShareUtils.GetResolvedPrivilege(e,c,false);return SYNO.ShareUtils.GetPrivilegeString(b,false)}}},fillRestItems:true,store:this.store,listeners:{scope:this,itemtap:this.onItemTapped}});Ext.apply(this,{title:this.shareInfo.name,ui:a?"round":undefined,layout:"fit",listeners:{scope:this,activate:this.onViewAppear},dockedItems:[{dock:"top",xtype:"toolbar",ui:a?"transparent":"gray",items:[{xtype:"synosearchfield",flex:1,placeHolder:_T("common","search"),store:this.store}]}],items:[this.list]});SYNO.MobileDSM.views.ShareUserEdit.superclass.initComponent.apply(this,arguments)},onViewAppear:function(){this.list.refresh()},onItemTapped:function(b,a){var c=b.getStore().getAt(a).data;this.viewport.pushContent(Ext.create({xtype:"SYNO.MobileDSM.views.UserSharePrivEdit",title:c.name,sharename:this.shareInfo.name,username:c.name,permInfo:c,delegate:this}))},getUserSharePrivilege:function(e,b,d,a){var c;if(a){c=SYNO.ShareUtils.GetPrivilegeInList(e,this.modifiedUser)}if(!c){c=SYNO.ShareUtils.GetPrivilegeFromPermObj(d)}return c},getUserGroupSharePrivilege:function(a){if("-"==a.inherit){return"clear"}return a.inherit},updateUserSharePrivilege:function(e,c,d,b){var a=this.getUserSharePrivilege(e,c,d,false);this.modifiedUser.rw.remove(e);this.modifiedUser.ro.remove(e);this.modifiedUser.na.remove(e);this.modifiedUser.clear.remove(e);if(a===b||(!a&&"clear"===b)){return}this.modifiedUser[b].push(e)},onCancelTapped:function(){this.viewport.popContent()},onDoneTapped:function(){var a=[];if(SYNO.Utils.CheckIsDemoMode()){return}SYNO.ShareUtils.FillinPermission(a,this.modifiedUser);if(0==a.length){this.viewport.popContent();return}SYNO.Utils.SetBodyMask(true);SYNO.API.currentManager.requestAPI("SYNO.Core.Share.Permission","set",1,{name:SYNO.Utils.QuoteString(this.shareInfo.name),user_group_type:"local_user",permissions:Ext.util.JSON.encode(a)},this.onSaveDone,this)},onSaveDone:function(a,c,b){if(!SYNO.Utils.CheckAPIResponse(a,c,b)){SYNO.Utils.SetBodyMask(false);return}SYNO.Utils.SetBodyMask(false);this.viewport.popContent()}});Ext.reg("SYNO.MobileDSM.views.ShareUserEdit",SYNO.MobileDSM.views.ShareUserEdit);SYNO.MobileDSM.views.ShareEdit=Ext.extend(Ext.form.FormPanel,{initComponent:function(){var a=[],b=[];this.backBtn=false;this.leftBtn={text:_T("common","cancel"),scope:this,handler:this.onCancelTapped};this.rightBtn={ui:"action",text:_T("common","done"),scope:this,handler:this.onDoneTapped};a.push({xtype:"fieldset",items:[{disabled:this.share&&!this.checkShareCanRename(this.share,this.shareInfo),xtype:"textfield",name:"name",label:_T("common","name"),labelWidth:"",placeHolder:_T("common","field_required")}]});if(this.share&&this.checkShareCanEditPrivilege(this.share,this.shareInfo)){a.push({xtype:"fieldset",title:_T("common","privilege"),items:[{xtype:"SYNO.MobileDSM.views.List",scroll:false,itemTpl:'<div class="x-list-item-body">{field1}</div><div class="x-list-disclosure-chevron"></div>',store:[[_T("share","user")],[_T("share","group")]],listeners:{scope:this,itemtap:this.onItemTapped}}]})}this.encryptBtn=new Ext.Button({hidden:true,xtype:"button",text:_T("share","encrypt_unmount"),scope:this,handler:this.onEncryptedTapped});a.push(this.encryptBtn);if(this.share&&this.checkShareCanDelete(this.share)){a.push({xtype:"button",ui:"decline",text:_T("common","delete")+" "+this.share,scope:this,handler:this.onDeleteTapped})}Ext.apply(this,{title:this.share||_T("common","add"),scroll:true,submitOnAction:false,items:a,listeners:{scope:this,afterlayout:{fn:this.onAfterLayout,single:true}}});SYNO.MobileDSM.views.ShareEdit.superclass.initComponent.apply(this,arguments)},onAfterLayout:function(){if(!this.share){return}if(this.shareInfo.encryption===SYNO.ShareStatus.DECRYPTED||this.shareInfo.encryption===SYNO.ShareStatus.ENCRYPTED){if(this.shareInfo.encryption===SYNO.ShareStatus.ENCRYPTED){this.encryptBtn.setText(_T("share","encrypt_mount"))}this.encryptBtn.setVisible(true)}this.load(Ext.ModelMgr.create({name:this.share},"SYNO.MobileDSM.models.Share"))},checkShareInUse:function(c){var b=false,e,a,d,f;if(!c){return false}c=c.toLowerCase();e={web:["WebStation"],photo:["MediaServer","PhotoStation"],music:["MediaServer","AudioStation","iTunesServer"],video:["MediaServer"],surveillance:["SurveillanceStation"],netbackup:["NetBackup"],homes:["UserHome"]};d=Ext.ApplicationManager.currentApplication.remoteConfig.services;f=Ext.ApplicationManager.currentApplication.remoteConfig.packages;a=e[c];if(Ext.isArray(a)){Ext.each(a,function(g){if(d[g]||f[g]){b=true;return false}})}return b},checkShareCanEditPrivilege:function(a,c){var b=["usbbackup","satabackup","surveillance"];if(c.encryption===SYNO.ShareStatus.ENCRYPTED){return false}a=a.toLowerCase();return(0>b.indexOf(a))},checkShareCanRename:function(a,c){var b=["global","home","printers","usbbackup","satabackup","usbshare","satashare","homes","surveillance"];a=a.toLowerCase();if(c.encryption===SYNO.ShareStatus.DECRYPTED){return false}return(0>b.indexOf(a))&&!this.checkShareInUse(a)},checkShareCanDelete:function(a){var b=["global","home","printers","usbbackup","satabackup","usbshare","satashare"];a=a.toLowerCase();return(0>b.indexOf(a))&&!this.checkShareInUse(a)},onEncryptedTapped:function(){if(this.shareInfo.encryption===SYNO.ShareStatus.ENCRYPTED){Ext.Msg.prompt("",_T("share","encrypt_key_prompt"),this.onMountConfirm,this,false,"",{type:"password"});return}Ext.Msg.confirm("",_T("share","unmount_confirm"),this.onUmountConfirm,this)},onMountConfirm:function(a,b){if("ok"!=a){return}if(8>b.length){Ext.defer(function(){Ext.Msg.alert("",_T("error","password"))},1);return}SYNO.Utils.SetBodyMask(true);SYNO.API.currentManager.requestAPI("SYNO.Core.Share.Crypto","decrypt",1,{name:SYNO.Utils.QuoteString(this.share),password:SYNO.Utils.QuoteString(b)},this.onMountDone,this)},onMountDone:function(a,c,b){if(!SYNO.Utils.CheckAPIResponse(a,c,b)){SYNO.Utils.SetBodyMask(false);return}if(this.listview){this.listview.listDirty=true}this.onSaveDone()},onUmountConfirm:function(a){if("yes"!==a){return}SYNO.Utils.SetBodyMask(true);SYNO.API.currentManager.requestAPI("SYNO.Core.Share.Crypto","encrypt",1,{name:SYNO.Utils.QuoteString(this.share)},this.onUmountDone,this)},onUmountDone:function(a,c,b){if(!SYNO.Utils.CheckAPIResponse(a,c,b)){SYNO.Utils.SetBodyMask(false);return}if(this.listview){this.listview.listDirty=true}this.onSaveDone()},onItemTapped:function(b,a){if(0===a){this.viewport.pushContent(Ext.create({xtype:"SYNO.MobileDSM.views.ShareUserEdit",shareInfo:this.shareInfo,shareview:this}))}else{if(1===a){this.viewport.pushContent(Ext.create({xtype:"SYNO.MobileDSM.views.ShareGroupEdit",shareInfo:this.shareInfo,shareview:this}))}}},onDoneTapped:function(){if(SYNO.Utils.CheckIsDemoMode()){return}SYNO.Utils.SetBodyMask(true);if(this.share){this.saveShareData()}else{this.createShareData()}},onCancelTapped:function(){this.viewport.popContent()},onDeleteTapped:function(){if(SYNO.Utils.CheckIsDemoMode()){return}Ext.Msg.confirm("",_T("share","delete_confirm"),this.onDeleteConfirm,this)},onDeleteConfirm:function(a){if("yes"!==a){return}SYNO.Utils.SetBodyMask(true);SYNO.API.currentManager.requestAPI("SYNO.Core.Share","delete",1,{name:SYNO.Utils.QuoteString(this.share)},this.onDeleteShareDone,this)},onDeleteShareDone:function(a,c,b){if(!SYNO.Utils.CheckAPIResponse(a,c,b)){SYNO.Utils.SetBodyMask(false);return}if(this.listview){this.listview.listDirty=true}this.onSaveDone()},createShareData:function(){SYNO.API.currentManager.requestAPI("SYNO.Core.Storage.Volume","list",1,{limit:10,offset:0,location:"internal"},this.onCreateShareGetVolumesDone,this)},onCreateShareGetVolumesDone:function(a,e,d){var c=this.getValues(),b;if(!SYNO.Utils.CheckAPIResponse(a,e,d)){SYNO.Utils.SetBodyMask(false);return}if(e.volumes[0]){b=e.volumes[0].volume_path}else{Ext.Msg.alert("",_T("error","no_volume"));SYNO.Utils.SetBodyMask(false);return}SYNO.API.currentManager.requestAPI("SYNO.Core.Share","create",1,{name:SYNO.Utils.QuoteString(c.name),shareinfo:Ext.util.JSON.encode({name:c.name,desc:"",vol_path:b})},this.onCreateShareDataDone,this)},onCreateShareDataDone:function(a,c,b){if(!SYNO.Utils.CheckAPIResponse(a,c,b)){SYNO.Utils.SetBodyMask(false);return}if(this.listview){this.listview.listDirty=true}this.onSaveDone()},saveShareData:function(){var a=this.getValues();if(a.name===this.share||!this.checkShareCanRename(this.share,this.shareInfo)){this.onSaveDone();return}SYNO.API.currentManager.requestAPI("SYNO.Core.Share","set",1,{name:SYNO.Utils.QuoteString(this.share),shareinfo:Ext.util.JSON.encode({name:a.name,vol_path:this.shareInfo.vol_path})},this.onSaveShareDataDone,this)},onSaveShareDataDone:function(a,d,c){var b=this.getValues().name;if(!SYNO.Utils.CheckAPIResponse(a,d,c)){SYNO.Utils.SetBodyMask(false);return}if(this.listview&&this.share!==b){this.share=b;this.listview.listDirty=true}this.onSaveDone()},onSaveDone:function(){SYNO.Utils.SetBodyMask(false);this.viewport.popContent()}});Ext.reg("SYNO.MobileDSM.views.ShareEdit",SYNO.MobileDSM.views.ShareEdit);SYNO.MobileDSM.views.LogViewerXfer=Ext.extend(Ext.Panel,{initComponent:function(){var a=Ext.ApplicationManager.currentApplication.isTablet;this.rightBtn={iconMask:true,iconCls:"refresh",scope:this,handler:this.onRefreshTapped};this.store=new SYNO.MobileDSM.stores.LogViewerXfer({proxy:{extraParams:{logtype:this.logType}}});Ext.apply(this,{cls:"log-viewer",ui:a?"round":undefined,layout:"fit",items:[{xtype:"SYNO.MobileDSM.views.List",itemTpl:{html:'<div class="x-list-item-body"><div class="x-list-item-text">{[this.getOperationString(values.operation)]} - {[Ext.htmlEncode(values.message)]}</div><div class="x-list-item-detail">{[SYNO.Utils.SimpleTimeString(values.timestamp)]} - {[Ext.htmlEncode(values.user)]} - {[Ext.htmlEncode(values.address)]}</div></div>',initialConfig:{scope:this,getOperationString:function(b){return this.scope.getOperationString(b)}}},fillRestItems:true,store:this.store,listeners:{scope:this,itemtap:this.onItemTapped}}]});SYNO.MobileDSM.views.LogViewerXfer.superclass.initComponent.apply(this,arguments)},getOperationString:function(a){a=a.replace(/\s+/,"");return _T("log_viewer","xfer_op_"+a)||a},onRefreshTapped:function(){this.store.currentPage=1;this.store.load()},onItemTapped:function(d,b,g){var f,h=this.store.getAt(b),e=h.get("size"),a=Ext.ApplicationManager.currentApplication.isTablet;f=this.getOperationString(h.get("operation"))+" - "+Ext.htmlEncode(h.get("message"));if(e){e=SYNO.Utils.SizeRoundText(h.get("size"),SYNO.Utils.SizeUnit.BYTE);f+=Ext.util.Format.format("<br/>{0}: {1}",_T("log_viewer","filesize"),e)}var c=new Ext.Panel({cls:"log-viewer-detail-panel",floating:true,centered:true,modal:true,scroll:"vertical",width:a?320:240,height:a?240:200,html:f,dockedItems:[{dock:"top",ui:"dark",xtype:"toolbar",title:h.get("timestamp").format("Y/m/d H:i:s")}],listeners:{scope:this,hide:this.onDetailPanelHide}});c.show()},onDetailPanelHide:function(a){a.destroy()}});Ext.reg("SYNO.MobileDSM.views.LogViewerXfer",SYNO.MobileDSM.views.LogViewerXfer);SYNO.MobileDSM.views.UserGroupEdit=Ext.extend(Ext.Panel,{initComponent:function(){var a=Ext.ApplicationManager.currentApplication.isTablet;this.store=new SYNO.MobileDSM.stores.GroupList({filters:[{fn:function(b){return"administrators"!==b.data.name}}]});this.list=Ext.create({xtype:"SYNO.MobileDSM.views.List",itemTpl:{html:'<div class="x-list-item-body"><div class="x-list-item-text">{name}</div></div><div class="x-list-disclosure-{[this.getInGroup(values)]}"></div>',initialConfig:{scope:this,getInGroup:function(c){var b=this.scope.getUserInGroup(c,true);return b?"checked":"unchecked"}}},fillRestItems:true,store:this.store,listeners:{scope:this,itemtap:this.onItemTapped}});Ext.apply(this,{title:this.userInfo.name,ui:a?"round":undefined,layout:"fit",listeners:{scope:this,activate:this.onViewAppear},dockedItems:[{dock:"top",xtype:"toolbar",ui:a?"transparent":"gray",items:[{xtype:"synosearchfield",flex:1,placeHolder:_T("common","search"),store:this.store}]}],items:[this.list]});SYNO.MobileDSM.views.UserGroupEdit.superclass.initComponent.apply(this,arguments)},onViewAppear:function(){this.list.refresh()},onItemTapped:function(b,a){var d=b.getStore().getAt(a).data,c=d.name,e=!this.getUserInGroup(d,true);if(this.isSpecialGroup(c)){return}this.userview.modifiedGroup.join.remove(c);this.userview.modifiedGroup.leave.remove(c);if(e!==this.getUserInGroup(d,false)){if(e){this.userview.modifiedGroup.join.push(c)}else{this.userview.modifiedGroup.leave.push(c)}}b.refresh()},isSpecialGroup:function(b){var a=b.toLowerCase();return("administrators"===a||"users"===a)},getUserInGroup:function(c,b){var d=this.userInfo.name,a=c.name;if(b){if(0<=this.userview.modifiedGroup.join.indexOf(a)){return true}if(0<=this.userview.modifiedGroup.leave.indexOf(a)){return false}}return(0<=this.userInfo.additional.group.indexOf(a))}});Ext.reg("SYNO.MobileDSM.views.UserGroupEdit",SYNO.MobileDSM.views.UserGroupEdit);SYNO.MobileDSM.views.UserSharePrivEdit=Ext.extend(Ext.form.FormPanel,{initComponent:function(){this.backBtn={scope:this,handler:this.onBackTapped};this.origUserPriv=this.delegate.getUserSharePrivilege(this.username,this.sharename,this.permInfo,false);this.userPriv=this.delegate.getUserSharePrivilege(this.username,this.sharename,this.permInfo,true);this.groupPriv=this.delegate.getUserGroupSharePrivilege(this.permInfo);this.store=Ext.StoreMgr.lookup([[_T("share","priv_preview"),""],[_T("share","priv_group"),""]]);this.updatePreviewStore();Ext.apply(this,{scroll:true,submitOnAction:false,items:[{xtype:"fieldset",items:[{xtype:"SYNO.MobileDSM.views.List",scroll:false,itemTpl:{html:'<div class="x-list-item-body"><div class="x-list-item-text">{field1}</div></div><div class="x-list-disclosure-text">{field2}</div>'},store:this.store}]},{xtype:"fieldset",defaults:{xtype:"checkboxfield",listeners:{scope:this,check:this.onPrivChecked,uncheck:this.onPrivUnChecked}},items:[{name:"priv",label:_T("share","priv_na"),value:"na",checked:"na"===this.userPriv},{name:"priv",label:_T("share","priv_rw"),value:"rw",checked:"rw"===this.userPriv},{name:"priv",label:_T("share","priv_ro"),value:"ro",checked:"ro"===this.userPriv}]}]});SYNO.MobileDSM.views.UserSharePrivEdit.superclass.initComponent.apply(this,arguments)},onBackTapped:function(){this.delegate.updateUserSharePrivilege(this.username,this.sharename,this.permInfo,this.userPriv);this.viewport.popContent()},onPrivChecked:function(a){this.userPriv=a.value;this.updatePreviewStore();this.setValues({priv:a.value})},onPrivUnChecked:function(a){if(a.value!==this.userPriv){return}if("cu"!==this.origUserPriv){this.userPriv="clear"}else{this.userPriv="cu"}this.updatePreviewStore()},updatePreviewStore:function(){var a=SYNO.ShareUtils.GetResolvedPrivilege(this.groupPriv,this.userPriv);this.store.getAt(0).set("field2",SYNO.ShareUtils.GetPrivilegeString(a,false));this.store.getAt(1).set("field2",SYNO.ShareUtils.GetPrivilegeString(this.groupPriv,true))}});Ext.reg("SYNO.MobileDSM.views.UserSharePrivEdit",SYNO.MobileDSM.views.UserSharePrivEdit);SYNO.MobileDSM.views.GroupList=Ext.extend(Ext.Panel,{listDirty:false,initComponent:function(){var a=Ext.ApplicationManager.currentApplication.isTablet;this.store=new SYNO.MobileDSM.stores.GroupList();this.rightBtn={iconMask:true,iconCls:"add",scope:this,handler:this.onAddTapped};Ext.apply(this,{title:_T("menu","group"),ui:a?"round":undefined,layout:"fit",listeners:{scope:this,activate:this.onViewAppear},dockedItems:[{dock:"top",xtype:"toolbar",ui:a?"transparent":"gray",items:[{xtype:"synosearchfield",flex:1,placeHolder:_T("common","search"),store:this.store}]}],items:[{layout:"fit",xtype:"SYNO.MobileDSM.views.List",itemTpl:'<div class="x-list-item-body"><div class="x-list-item-text">{name}</div></div><div class="x-list-disclosure-chevron"></div>',fillRestItems:true,store:this.store,listeners:{scope:this,itemtap:this.onItemTapped}}]});SYNO.MobileDSM.views.GroupList.superclass.initComponent.apply(this,arguments)},onViewAppear:function(){if(this.listDirty){this.store.currentPage=1;this.store.load();this.listDirty=false}},onItemTapped:function(b,a){this.viewport.pushContent(Ext.create({xtype:"SYNO.MobileDSM.views.GroupEdit",group:this.store.getAt(a).get("name"),listview:this}),{direction:"up"})},onAddTapped:function(){this.viewport.pushContent(Ext.create({xtype:"SYNO.MobileDSM.views.GroupEdit",listview:this}),{direction:"up"})}});Ext.reg("SYNO.MobileDSM.views.GroupList",SYNO.MobileDSM.views.GroupList);SYNO.MobileDSM.views.SysInfoGeneral=Ext.extend(Ext.form.FormPanel,{listOrder:["serial","model","ram","version_string","time","uptime","temperature_warn"],initComponent:function(){this.store=new SYNO.MobileDSM.stores.KeyValue();Ext.apply(this,{title:_T("sysinfo","general"),iconCls:"icon-general",scroll:true,items:[{xtype:"segmentedbutton",allowDepress:false,listeners:{scope:this.view,toggle:this.view.onSegmentBtnToggle},items:[{flex:1,panelId:0,text:_T("sysinfo","general"),onTapCancel:Ext.emptyFn,pressed:true},{flex:1,panelId:1,text:_T("sysinfo","network")},{flex:1,panelId:2,text:_T("sysinfo","storage")}]},{xtype:"fieldset",title:_T("sysinfo","basic"),items:[{xtype:"SYNO.MobileDSM.views.List",cls:"x-list-keyvalue",pressedCls:"",scroll:false,itemTpl:'<div class="x-list-key">{key}</div><div class="x-list-value">{value}</div>',store:this.store}]}]});SYNO.MobileDSM.views.SysInfoGeneral.superclass.initComponent.apply(this,arguments)},GetKeyName:function(a){if("temperature_warn"===a){return _T("sysinfo","temperature")}return _T("sysinfo",a)},RenderKeyValue:function(a,c){var b;switch(a){case"uptime":b=SYNO.Utils.TimeDurationString(c.uptime);break;case"temperature_warn":b=c[a]?_T("sysinfo","abnormal"):_T("sysinfo","normal");if(Ext.isDefined(c.temperature)){b+="("+c.temperature.toFixed(0)+"&deg;C / ";b+=SYNO.Utils.C2F(c.temperature).toFixed(0)+"&deg;F)"}break;case"ram":b=c[a];b+=_T("common","size_mb");break;default:b=c[a]}return b},loadData:function(){SYNO.Utils.SetBodyMask(true);SYNO.API.currentManager.requestAPI("SYNO.DSM.Info","getinfo",1,{},this.onLoadData,this)},onLoadData:function(a,d,c){var b=[];SYNO.Utils.SetBodyMask(false);if(!SYNO.Utils.CheckAPIResponse(a,d,c)){return}Ext.each(this.listOrder,function(e){if(!Ext.isDefined(d[e])){return}b.push({key:this.GetKeyName(e),value:this.RenderKeyValue(e,d)})},this);this.store.loadData(b);this.doComponentLayout()}});Ext.reg("SYNO.MobileDSM.views.SysInfoGeneral",SYNO.MobileDSM.views.SysInfoGeneral);SYNO.MobileDSM.views.GroupEdit=Ext.extend(Ext.form.FormPanel,{modifiedShare:null,modifiedUser:null,initComponent:function(){var a=[];this.backBtn=false;this.leftBtn={text:_T("common","cancel"),scope:this,handler:this.onCancelTapped};this.rightBtn={ui:"action",text:_T("common","done"),scope:this,handler:this.onDoneTapped};this.modifiedShare={rw:[],ro:[],na:[],clear:[]};this.modifiedUser={join:[],leave:[]};if(!this.group||!this.isSpecialGroup(this.group)){a.push({xtype:"fieldset",items:[{xtype:"textfield",name:"name",label:_T("common","name"),labelWidth:"",placeHolder:_T("common","field_required")}]})}if(this.group&&"users"!==this.group.toLowerCase()){a.push({xtype:"fieldset",items:[{xtype:"SYNO.MobileDSM.views.List",scroll:false,itemTpl:'<div class="x-list-item-body">{field1}</div><div class="x-list-disclosure-chevron"></div>',store:[[_T("group","members"),"members"]],listeners:{scope:this,itemtap:this.onItemTapped}}]})}if(this.group){a.push({xtype:"fieldset",title:_T("common","privilege"),items:[{xtype:"SYNO.MobileDSM.views.List",scroll:false,itemTpl:'<div class="x-list-item-body">{field1}</div><div class="x-list-disclosure-chevron"></div>',store:[[_T("group","share"),"share"]],listeners:{scope:this,itemtap:this.onItemTapped}}]})}if(this.group&&!this.isSpecialGroup(this.group)){a.push({xtype:"button",ui:"decline",text:_T("common","delete")+" "+this.group,scope:this,handler:this.onDeleteTapped})}Ext.apply(this,{title:this.group||_T("common","add"),scroll:true,submitOnAction:false,items:a,listeners:{scope:this,afterlayout:{fn:this.onAfterLayout,single:true}}});SYNO.MobileDSM.views.GroupEdit.superclass.initComponent.apply(this,arguments)},onAfterLayout:function(){this.loadData()},isSpecialGroup:function(b){var a=b.toLowerCase();return("administrators"===a||"users"===a)},loadData:function(){if(!this.group){return}SYNO.Utils.SetBodyMask(true);SYNO.API.currentManager.requestAPI("SYNO.DSM.Group","getinfo",1,{groups:this.group},this.onLoadData,this)},onLoadData:function(a,e,c){var b,d={};SYNO.Utils.SetBodyMask(false);if(!SYNO.Utils.CheckAPIResponse(a,e,c)){return}b=e.groups[0];this.groupInfo=b;if(!this.group||!this.isSpecialGroup(this.group)){d.name=b.name}this.load(Ext.ModelMgr.create(d,"SYNO.MobileDSM.models.Group"))},onItemTapped:function(b,a){var c=b.getStore().getAt(a);if("share"===c.get("field2")){this.viewport.pushContent(Ext.create({xtype:"SYNO.MobileDSM.views.GroupShareEdit",groupInfo:this.groupInfo,groupview:this}))}else{if("members"===c.get("field2")){this.viewport.pushContent(Ext.create({xtype:"SYNO.MobileDSM.views.GroupUserEdit",groupInfo:this.groupInfo,groupview:this}))}}},onDoneTapped:function(){if(SYNO.Utils.CheckIsDemoMode()){return}this.doSaveGroup()},doSaveGroup:function(){SYNO.Utils.SetBodyMask(true);if(this.group){this.saveGroupData()}else{this.createGroupData()}},onCancelTapped:function(){this.viewport.popContent()},onDeleteTapped:function(){if(SYNO.Utils.CheckIsDemoMode()){return}Ext.Msg.confirm("",_T("group","delete_confirm"),this.onDeleteConfirm,this)},onDeleteConfirm:function(a){if("yes"!==a){return}SYNO.Utils.SetBodyMask(true);SYNO.API.currentManager.requestAPI("SYNO.DSM.Group","delete",1,{groups:this.group},this.onDeleteGroupDone,this)},onDeleteGroupDone:function(a,c,b){if(!SYNO.Utils.CheckAPIResponse(a,c,b)){SYNO.Utils.SetBodyMask(false);return}if(this.listview){this.listview.listDirty=true}this.onSaveDone()},createGroupData:function(){var a=this.getValues(),b={};b.name=a.name;SYNO.API.currentManager.requestAPI("SYNO.DSM.Group","create",1,b,this.onCreateGroupDataDone,this)},onCreateGroupDataDone:function(a,c,b){if(!SYNO.Utils.CheckAPIResponse(a,c,b)){SYNO.Utils.SetBodyMask(false);return}if(this.listview){this.listview.listDirty=true}this.onSaveDone()},saveGroupData:function(){var a=false,d={},c=this.record,b=Ext.ModelMgr.create({},"SYNO.MobileDSM.models.Group");this.updateRecord(b,false);if(b.get("name")!==c.get("name")){d.name=b.get("name");a=true}if(!a){this.saveLeaveGroupMembers();return}SYNO.API.currentManager.requestAPI("SYNO.DSM.Group","edit",1,Ext.apply(d,{group:this.group}),this.onSaveGroupDataDone,this)},onSaveGroupDataDone:function(a,d,c){var b=this.getValues().name;if(!SYNO.Utils.CheckAPIResponse(a,d,c)){SYNO.Utils.SetBodyMask(false);return}if(this.listview&&this.group!==b){this.group=b;this.listview.listDirty=true}this.saveLeaveGroupMembers()},saveLeaveGroupMembers:function(){var a=this.modifiedUser;if(!a.leave.length){this.saveJoinGroupMembers();return}SYNO.API.currentManager.requestAPI("SYNO.DSM.Group","removeusers",1,{users:a.leave.join(","),groups:this.group},this.onSaveLeaveGroupMembersDone,this)},onSaveLeaveGroupMembersDone:function(a,c,b){if(!SYNO.Utils.CheckAPIResponse(a,c,b)){SYNO.Utils.SetBodyMask(false);return}this.saveJoinGroupMembers()},saveJoinGroupMembers:function(){var a=this.modifiedUser;if(!a.join.length){this.onSaveDone();return}SYNO.API.currentManager.requestAPI("SYNO.DSM.Group","addusers",1,{users:a.join.join(","),groups:this.group},this.onSaveJoinGroupMembersDone,this)},onSaveJoinGroupMembersDone:function(a,c,b){if(!SYNO.Utils.CheckAPIResponse(a,c,b)){SYNO.Utils.SetBodyMask(false);return}this.onSaveDone()},onSaveDone:function(){SYNO.Utils.SetBodyMask(false);this.viewport.popContent()}});Ext.reg("SYNO.MobileDSM.views.GroupEdit",SYNO.MobileDSM.views.GroupEdit);SYNO.MobileDSM.views.ServiceList=Ext.extend(Ext.form.FormPanel,{services:null,modifiedEnabled:null,modifiedDisabled:null,initComponent:function(){this.rightBtn={ui:"action",text:_T("common","done"),disabled:true,scope:this,handler:this.updateService};this.services={};this.modifiedEnabled=[];this.modifiedDisabled=[];this.LanItems=[{name:"Samba",label:_T("service","samba")},{name:"AFP",label:_T("service","afp")},{name:"NFS",label:_T("service","nfs")},{name:"BonjourPrinter",label:_T("service","bonjour_printer")},{name:"DLNAMediaServer",label:_T("service","mediaserver")},{name:"iTunesServer",label:_T("service","itunes")}];this.InternetItems=[{name:"AutoBlock",label:_T("service","autoblock")},{name:"FTP",label:_T("service","ftp")},{name:"FTPES",label:_T("service","ftpes")},{name:"SFTP",label:_T("service","sftp")},{name:"WebStation",label:_T("service","web")},{name:"WebDAV",label:_T("service","webdav")},{name:"SecureWebDAV",label:_T("service","webdav_https")},{name:"NTP",label:_T("service","ntp")},{name:"FileStation",label:_T("service","filestation")},{name:"SecureFileStation",label:_T("service","filestation_https")},{name:"SurveillanceStation",label:_T("service","surveillance")},{name:"AudioStation",label:_T("service","audiostation")},{name:"PhotoStation",label:_T("service","photostation")},{name:"DownloadStation",label:_T("service","download")},{name:"eMule",label:_T("service","emule")}];Ext.apply(this,{title:_T("menu","service"),cls:"service-switch",scroll:true,listeners:{scope:this,afterlayout:{fn:this.onAfterLayout,single:true}}});SYNO.Utils.FixScroll(this);SYNO.MobileDSM.views.ServiceList.superclass.initComponent.apply(this,arguments)},onAfterLayout:function(){this.loadData()},loadData:function(){SYNO.Utils.SetBodyMask(true);SYNO.API.currentManager.requestAPI("SYNO.DSM.Volume","list",1,{},this.onLoadVolume,this)},onLoadVolume:function(a,c,b){if(!SYNO.Utils.CheckAPIResponse(a,c,b)){SYNO.Utils.SetBodyMask(false);return}this.hasVolume=c.volumes.length>0;SYNO.API.currentManager.requestAPI("SYNO.DSM.Service","list",1,{},this.onLoadService,this)},onLoadService:function(a,d,c){var b=[];SYNO.Utils.SetBodyMask(false);if(!SYNO.Utils.CheckAPIResponse(a,d,c)){return}this.services={};Ext.each(d.services,function(e){this.services[e.name]=e.enabled?1:0},this);b=[];Ext.each(this.LanItems,function(e){if(!Ext.isDefined(this.services[e.name])||(!this.hasVolume&&this.isServiceNeedVolume(e.name))){b.push(e)}},this);Ext.each(b,function(e){this.LanItems.remove(e)},this);b=[];Ext.each(this.InternetItems,function(e){if(!Ext.isDefined(this.services[e.name])||(!this.hasVolume&&this.isServiceNeedVolume(e.name))){b.push(e)}},this);Ext.each(b,function(e){this.InternetItems.remove(e)},this);if(this.LanItems.length){this.add({xtype:"fieldset",title:_T("service","title_lan"),defaults:{xtype:"synotogglefield",listeners:{scope:this,change:this.onValueChanged}},items:this.LanItems})}if(this.InternetItems.length){this.add({xtype:"fieldset",title:_T("service","title_internet"),defaults:{xtype:"synotogglefield",listeners:{scope:this,change:this.onValueChanged}},items:this.InternetItems})}this.doComponentLayout();this.setValues(this.services)},isServiceNeedVolume:function(a){var b=false;switch(a){case"WebStation":case"DLNAMediaServer":case"iTunesServer":case"PhotoStation":case"SurveillanceStation":case"DownloadStation":case"eMule":b=true;break}return b},onValueChanged:function(){if(!this.rightBtnEl){return}var a=this.updateModifiedServices();this.rightBtnEl.setDisabled(!a)},updateModifiedServices:function(){var a,b=false,c=this.getValues();this.modifiedEnabled=[];this.modifiedDisabled=[];for(a in c){if(!this.services.hasOwnProperty(a)||this.services[a]===c[a]){continue}b=true;if(c[a]){this.modifiedEnabled.push(a)}else{this.modifiedDisabled.push(a)}}return b},updateService:function(){if(SYNO.Utils.CheckIsDemoMode()){return}if(!this.updateModifiedServices()){return}if(-1!==this.modifiedDisabled.indexOf("NTP")){var a=Ext.ApplicationManager.currentApplication.remoteConfig.packages;if(a.hasOwnProperty("SurveillanceStation")&&a.SurveillanceStation){this.setValues(Ext.ApplicationManager.currentApplication.remoteConfig.services);Ext.Msg.alert("",_T("error","ntp_service_disable_warning"));return}}SYNO.Utils.SetBodyMask(true);this.rightBtnEl.setDisabled(true);SYNO.API.currentManager.requestAPI("SYNO.DSM.Service","setservice",1,{enabled:this.modifiedEnabled.join(","),disabled:this.modifiedDisabled.join(",")},this.onUpdateServiceDone,this)},onUpdateServiceDone:function(a,c,b){if(!SYNO.Utils.CheckAPIResponse(a,c,b)){this.rightBtnEl.setDisabled(false);SYNO.Utils.SetBodyMask(false);return}Ext.defer(function(){SYNO.Utils.SetBodyMask(false);this.rightBtnEl.setDisabled(true);this.services=this.getValues();Ext.ApplicationManager.currentApplication.remoteConfig.services=this.services},5000*(c.waitFactor||1),this)}});Ext.reg("SYNO.MobileDSM.views.ServiceList",SYNO.MobileDSM.views.ServiceList);Ext.regModel("SYNO.MobileDSM.models.AutoBlockList",{fields:[{name:"address",type:"string"},{name:"timestamp",type:"date",dateFormat:"timestamp"}]});Ext.regModel("SYNO.MobileDSM.models.AutoBlock",{fields:[{name:"attempts",type:"int"},{name:"attemptmin",type:"int"},{name:"expiredday",type:"int"},{name:"notify",type:"boolean"}]});Ext.regModel("SYNO.MobileDSM.models.Connections",{fields:[{name:"type",type:"string"},{name:"timestamp",type:"date",dateFormat:"timestamp"},{name:"user",type:"string"},{name:"activity",type:"string"},{name:"address",type:"string"}]});Ext.regModel("SYNO.MobileDSM.models.LogViewerMenu",{fields:[{name:"title",type:"string"},{name:"logType",type:"string"},{name:"xtype",type:"string"}]});Ext.regModel("SYNO.MobileDSM.models.LogViewerEvent",{fields:[{name:"level",type:"string"},{name:"timestamp",type:"date",dateFormat:"timestamp"},{name:"user",type:"string"},{name:"message",type:"string"}]});Ext.regModel("SYNO.MobileDSM.models.LogViewerXfer",{fields:[{name:"timestamp",type:"date",dateFormat:"timestamp"},{name:"user",type:"string"},{name:"message",type:"string"},{name:"operation",type:"string"},{name:"size",type:"int"},{name:"address",type:"string"},{name:"is_dir",type:"boolean"}]});Ext.regModel("SYNO.MobileDSM.models.KeyValue",{fields:[{name:"key",type:"string"},{name:"value",type:"string"}]});Ext.regModel("SYNO.MobileDSM.models.UserList",{fields:[{name:"name",type:"string"},{name:"description",type:"string"},{name:"additional",type:"auto"}]});Ext.regModel("SYNO.MobileDSM.models.User",{fields:[{name:"name",type:"string"},{name:"password",type:"string"},{name:"email",type:"string"},{name:"disabled",type:"boolean"},{name:"administrator",type:"boolean"}],validations:[{type:"presence",field:"name"}]});Ext.regModel("SYNO.MobileDSM.models.UserShare",{fields:[{name:"name",type:"string"},{name:"privilege",type:"string"}]});Ext.regModel("SYNO.MobileDSM.models.UserShareList",{fields:[{name:"name",type:"string"},{name:"is_deny",type:"bool"},{name:"is_custom",type:"bool"},{name:"is_readonly",type:"bool"},{name:"is_writable",type:"bool"},{name:"inherit",type:"string"}]});Ext.regModel("SYNO.MobileDSM.models.MainMenu",{fields:[{name:"title",type:"string"},{name:"iconCls",type:"string"},{name:"disclosureCls",type:"string"},{name:"groupId",type:"int"},{name:"xtype",type:"string"},{name:"url",type:"string"}]});Ext.regModel("SYNO.MobileDSM.models.ShareList",{fields:[{name:"name",type:"string"},{name:"vol_path",type:"string"},{name:"encryption",type:"int"}]});Ext.regModel("SYNO.MobileDSM.models.Share",{fields:[{name:"name",type:"string"},{name:"status",type:"int"},{name:"additional",type:"auto"}]});Ext.regModel("SYNO.MobileDSM.models.ShareUserList",{fields:[{name:"name",type:"string"},{name:"is_deny",type:"bool"},{name:"is_custom",type:"bool"},{name:"is_readonly",type:"bool"},{name:"is_writable",type:"bool"},{name:"inherit",type:"string"}]});Ext.regModel("SYNO.MobileDSM.models.ShareGroupList",{fields:[{name:"name",type:"string"},{name:"is_deny",type:"bool"},{name:"is_custom",type:"bool"},{name:"is_readonly",type:"bool"},{name:"is_writable",type:"bool"}]});Ext.regModel("SYNO.MobileDSM.models.GroupList",{fields:[{name:"name",type:"string"},{name:"description",type:"string"},{name:"additional",type:"auto"}]});Ext.regModel("SYNO.MobileDSM.models.Group",{fields:[{name:"name",type:"string"}]});Ext.regModel("SYNO.MobileDSM.models.GroupShareList",{fields:[{name:"name",type:"string"},{name:"is_deny",type:"bool"},{name:"is_custom",type:"bool"},{name:"is_readonly",type:"bool"},{name:"is_writable",type:"bool"}]});SYNO.MobileDSM.stores.AutoBlockList=Ext.extend(SYNO.MobileDSM.stores.Store,{constructor:function(b){var c,a;b=b||{};c=b.proxy||{};a=c.reader||{};delete c.reader;delete b.proxy;c=Ext.apply({type:"synoapi",api:"SYNO.DSM.AutoBlock",method:"list",version:1,reader:Ext.apply({type:"json",root:"addresses",totalProperty:"total"},a)},c);SYNO.MobileDSM.stores.AutoBlockList.superclass.constructor.call(this,Ext.apply({autoLoad:true,clearOnPageLoad:false,model:"SYNO.MobileDSM.models.AutoBlockList",proxy:c},b))}});SYNO.MobileDSM.stores.Connections=Ext.extend(SYNO.MobileDSM.stores.Store,{constructor:function(b){var c,a;b=b||{};c=b.proxy||{};a=c.reader||{};delete c.reader;delete b.proxy;c=Ext.apply({type:"synoapi",api:"SYNO.DSM.Connection",method:"list",version:1,reader:Ext.apply({type:"json",root:"connections",totalProperty:"total"},a)},c);SYNO.MobileDSM.stores.Connections.superclass.constructor.call(this,Ext.apply({autoLoad:true,clearOnPageLoad:false,model:"SYNO.MobileDSM.models.Connections",proxy:c,sorters:[{direction:"DESC",sorterFn:function(h,d){var g=["ftp","afp","samba","dsm"],f=g.indexOf(h.get("type")),e=g.indexOf(d.get("type"));return f>e}}]},b))},getGroupString:function(b){var a=b.get("type");return _T("log_viewer","conn_"+a)}});SYNO.MobileDSM.stores.LogViewerMenu=Ext.extend(Ext.data.Store,{constructor:function(){SYNO.MobileDSM.stores.LogViewerMenu.superclass.constructor.call(this,{model:"SYNO.MobileDSM.models.LogViewerMenu",proxy:{type:"memory",reader:{type:"json"}}})}});SYNO.MobileDSM.stores.LogViewerEvent=Ext.extend(SYNO.MobileDSM.stores.Store,{constructor:function(b){var c,a;b=b||{};c=b.proxy||{};a=c.reader||{};delete c.reader;delete b.proxy;c=Ext.apply({type:"synoapi",api:"SYNO.DSM.LogViewer",method:"list",version:1,reader:Ext.apply({type:"json",root:"logs",totalProperty:"total"},a)},c);SYNO.MobileDSM.stores.LogViewerEvent.superclass.constructor.call(this,Ext.apply({autoLoad:true,clearOnPageLoad:false,model:"SYNO.MobileDSM.models.LogViewerEvent",proxy:c},b))}});SYNO.MobileDSM.stores.LogViewerXfer=Ext.extend(SYNO.MobileDSM.stores.Store,{constructor:function(b){var c,a;b=b||{};c=b.proxy||{};a=c.reader||{};delete c.reader;delete b.proxy;c=Ext.apply({type:"synoapi",api:"SYNO.DSM.LogViewer",method:"list",version:1,reader:Ext.apply({type:"json",root:"logs",totalProperty:"total"},a)},c);SYNO.MobileDSM.stores.LogViewerXfer.superclass.constructor.call(this,Ext.apply({autoLoad:true,clearOnPageLoad:false,model:"SYNO.MobileDSM.models.LogViewerXfer",proxy:c},b))}});SYNO.MobileDSM.stores.KeyValue=Ext.extend(Ext.data.Store,{constructor:function(){SYNO.MobileDSM.stores.KeyValue.superclass.constructor.call(this,{model:"SYNO.MobileDSM.models.KeyValue",proxy:{type:"memory",reader:{type:"json"}}})}});SYNO.MobileDSM.stores.UserList=Ext.extend(SYNO.MobileDSM.stores.Store,{constructor:function(b){var c,a;b=b||{};c=b.proxy||{};a=c.reader||{};delete c.reader;delete b.proxy;c=Ext.apply({type:"synoapi",api:"SYNO.DSM.User",method:"list",version:1,reader:Ext.apply({type:"json",root:"users",totalProperty:"total"},a)},c);SYNO.MobileDSM.stores.UserList.superclass.constructor.call(this,Ext.apply({autoLoad:true,clearOnPageLoad:false,model:"SYNO.MobileDSM.models.UserList",proxy:c},b))}});SYNO.MobileDSM.stores.UserShareList=Ext.extend(SYNO.MobileDSM.stores.Store,{constructor:function(b){var c,a;b=b||{};c=b.proxy||{};a=c.reader||{};delete c.reader;delete b.proxy;c=Ext.apply({type:"synoapi",api:"SYNO.Core.Share.Permission",method:"list_by_user",filterParam:"substr",quoteFilter:true,version:1,reader:Ext.apply({type:"json",root:"shares",totalProperty:"total"},a)},c);SYNO.MobileDSM.stores.UserShareList.superclass.constructor.call(this,Ext.apply({autoLoad:true,clearOnPageLoad:false,model:"SYNO.MobileDSM.models.UserShareList",proxy:c},b))}});SYNO.MobileDSM.stores.MainMenu=Ext.extend(Ext.data.Store,{constructor:function(){SYNO.MobileDSM.stores.MainMenu.superclass.constructor.call(this,{model:"SYNO.MobileDSM.models.MainMenu",proxy:{type:"memory",reader:{type:"json"}}})},getGroupString:function(b){var a="";if(1===b.get("groupId")){a=_T("menu","application")}return a}});SYNO.MobileDSM.stores.ShareList=Ext.extend(SYNO.MobileDSM.stores.Store,{constructor:function(b){var c,a;b=b||{};c=b.proxy||{};a=c.reader||{};delete c.reader;delete b.proxy;c=Ext.apply({type:"synoapi",api:"SYNO.Core.Share",method:"list",version:1,filterParam:"substr",quoteFilter:true,reader:Ext.apply({type:"json",root:"shares",totalProperty:"total"},a)},c);SYNO.MobileDSM.stores.ShareList.superclass.constructor.call(this,Ext.apply({autoLoad:true,clearOnPageLoad:false,model:"SYNO.MobileDSM.models.ShareList",proxy:c},b))}});SYNO.MobileDSM.stores.ShareUserList=Ext.extend(SYNO.MobileDSM.stores.Store,{constructor:function(b){var c,a;b=b||{};c=b.proxy||{};a=c.reader||{};delete c.reader;delete b.proxy;c=Ext.apply({type:"synoapi",api:"SYNO.Core.Share.Permission",method:"list",filterParam:"substr",quoteFilter:true,version:1,reader:Ext.apply({type:"json",root:"items",totalProperty:"total"},a)},c);SYNO.MobileDSM.stores.ShareUserList.superclass.constructor.call(this,Ext.apply({autoLoad:true,clearOnPageLoad:false,model:"SYNO.MobileDSM.models.ShareUserList",proxy:c},b))}});SYNO.MobileDSM.stores.ShareGroupList=Ext.extend(SYNO.MobileDSM.stores.Store,{constructor:function(b){var c,a;b=b||{};c=b.proxy||{};a=c.reader||{};delete c.reader;delete b.proxy;c=Ext.apply({type:"synoapi",api:"SYNO.Core.Share.Permission",method:"list",filterParam:"substr",quoteFilter:true,version:1,reader:Ext.apply({type:"json",root:"items",totalProperty:"total"},a)},c);SYNO.MobileDSM.stores.ShareGroupList.superclass.constructor.call(this,Ext.apply({autoLoad:true,clearOnPageLoad:false,model:"SYNO.MobileDSM.models.ShareGroupList",proxy:c},b))}});SYNO.MobileDSM.stores.GroupList=Ext.extend(SYNO.MobileDSM.stores.Store,{constructor:function(b){var c,a;b=b||{};c=b.proxy||{};a=c.reader||{};delete c.reader;delete b.proxy;c=Ext.apply({type:"synoapi",api:"SYNO.DSM.Group",method:"list",version:1,reader:Ext.apply({type:"json",root:"groups",totalProperty:"total"},a)},c);SYNO.MobileDSM.stores.GroupList.superclass.constructor.call(this,Ext.apply({autoLoad:true,clearOnPageLoad:false,model:"SYNO.MobileDSM.models.GroupList",proxy:c},b))}});SYNO.MobileDSM.stores.GroupShareList=Ext.extend(SYNO.MobileDSM.stores.Store,{constructor:function(b){var c,a;b=b||{};c=b.proxy||{};a=c.reader||{};delete c.reader;delete b.proxy;c=Ext.apply({type:"synoapi",api:"SYNO.Core.Share.Permission",method:"list_by_group",filterParam:"substr",quoteFilter:true,version:1,reader:Ext.apply({type:"json",root:"shares",totalProperty:"total"},a)},c);SYNO.MobileDSM.stores.GroupShareList.superclass.constructor.call(this,Ext.apply({autoLoad:true,clearOnPageLoad:false,model:"SYNO.MobileDSM.models.GroupShareList",proxy:c},b))}});