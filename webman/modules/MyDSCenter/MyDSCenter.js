/* All rights reserved. */

Ext.namespace("SYNO.SDS.MyDSCenter.Utils");Ext.apply(SYNO.SDS.MyDSCenter.Utils,{isSupportPlaceholder:function(){return("placeholder" in document.createElement("input"))},getServiceName:function(a){switch(a){case"quickconnect":return"QuickConnect ID";case"ddns":return _T("myds","service_ddns_hostname");case"package":return _T("pkgmgr","pkgmgr_pkg_name");default:return"Unknown Service"}},clearForm:function(a){var b={},c;a.items.each(function(d){b[d.getName()]=null});c=new Ext.data.Record(b);if(a&&Ext.isFunction(a.loadRecord)){a.loadRecord(c);a.clearInvalid()}},purchaseColumnRenderer:function(g,e,a,d,f,b){var c=Ext.util.Format.htmlEncode(g);e.attr='ext:qtip="'+Ext.util.Format.htmlEncode(c)+'"';return c},getLanguageStore:function(){return new Ext.data.ArrayStore({fields:["value","display"],data:SYNO.SDS.Utils.getSupportedLanguage()})},getSearchTypeStore:function(){return new Ext.data.ArrayStore({fields:["display","value"],data:[[_T("myds","purchased_item"),"apps"],[_T("common","ds_serial"),"serials"],[_T("myds","buyer_id"),"paypals"],[_T("pkgmgr","myds_pay_price"),"prices"]]})},launchQuickConnect:function(){SYNO.SDS.AppLaunch("SYNO.SDS.AdminCenter.Application",Ext.apply({},{fn:"SYNO.SDS.AdminCenter.QuickConnect.Main"}))},disableUnifyNotification:function(){SYNO.API.currentManager.requestAPI("SYNO.Core.MyDSCenter.Unify","disable_notify","1",{},function(e,c,d,b){var a=new SYNO.SDS.MessageBoxV5({renderTo:Ext.getBody()});if(!e){a.getWrapper().alert("",SYNO.API.getErrorString(c))}else{a.getWrapper().alert("",_T("wizcommon","wizard_applydone"))}},this)},extractAliasFromFoundAccount:function(a){if(!_S("found_myds_account")||!_S("found_myds_account")[a]){return undefined}var c,b=_S("found_myds_account")[a].services;for(c=0;c<b.length;c++){if("quickconnect"===b[c].type){return b[c].value}}return undefined},getDDNSStatusClass:function(b){var c={"invalid login":"red-status",service_ddns_normal:"green-status",service_status_inprocess:"green-status",service_ddns_error_unknown:"red-status",check_network:"red-status",service_ddns_status_synology_email_not_verified:"red-status"};if(c.hasOwnProperty(b)){return c[b]}else{var a=_T("service",b);if(("string"===typeof(a))&&(a.length>0)){return"red-status"}else{return""}}},getDDNSStatusText:function(a){var b=String.format('<a style="cursor:pointer" class="link-font">{0}</a>',_T("common","here"));var d={"invalid login":_T("error","error_auth"),loading:_T("common",a),disabled:_T("common",a),service_ddns_normal:_T("service",a),service_status_inprocess:_T("service",a),service_ddns_error_unknown:_T("service","service_ddns_status_connect_host"),check_network:_T("relayservice","relayservice_err_resolv"),service_ddns_status_synology_email_not_verified:String.format(_T("service","service_ddns_status_synology_email_not_verified"),b)};if(d.hasOwnProperty(a)){return d[a]}else{var c=_T("service",a);if(("string"===typeof(c))&&(c.length>0)){return c}else{return a}}},getQuickConnectServiceNameByID:function(a){var b={mobile_apps:_T("relayservice","name_mobile_app"),photostation:_T("relayservice","name_photostation"),cloudstation:_T("relayservice","name_cloud"),file_sharing:_T("relayservice","name_file_sharing"),dsm_portal:_T("relayservice","name_dsm_portal"),photo_portal:_T("relayservice","name_photo_portal")};return b[a]},getCountryStore:function(){return new Ext.data.ArrayStore({fields:["display","value"],data:[["Afghanistan","Afghanistan"],["Albania","Albania"],["Algeria","Algeria"],["American Samoa","American Samoa"],["Andorra","Andorra"],["Angola","Angola"],["Anguilla","Anguilla"],["Antigua and Barbuda","Antigua and Barbuda"],["Argentina","Argentina"],["Armenia","Armenia"],["Aruba","Aruba"],["Australia","Australia"],["Austria","Austria"],["Azerbaijan","Azerbaijan"],["Bahamas","Bahamas"],["Bahrain","Bahrain"],["Bangladesh","Bangladesh"],["Barbados","Barbados"],["Belarus","Belarus"],["Belgium","Belgium"],["Belize","Belize"],["Benin","Benin"],["Bermuda","Bermuda"],["Bhutan","Bhutan"],["Bolivia","Bolivia"],["Bosnia","Bosnia"],["Botswana","Botswana"],["Brazil","Brazil"],["British Virgin Islands","British Virgin Islands"],["Brunei","Brunei"],["Bulgaria","Bulgaria"],["Burkina","Burkina"],["Burundi","Burundi"],["Cambodia","Cambodia"],["Cameroon","Cameroon"],["Canada","Canada"],["Cape Verde","Cape Verde"],["Cayman Islands","Cayman Islands"],["Central African Republic","Central African Republic"],["Chad","Chad"],["Chile","Chile"],["China","China"],["Colombia","Colombia"],["Comoros","Comoros"],["Costa Rica","Costa Rica"],["Cote d'Ivoire","Cote d'Ivoire"],["Croatia","Croatia"],["Cuba","Cuba"],["Cyprus","Cyprus"],["Czech Republic","Czech Republic"],["Democratic Republic of the Congo","Democratic Republic of the Congo"],["Denmark","Denmark"],["Djibouti","Djibouti"],["Dominica","Dominica"],["Dominican Republic","Dominican Republic"],["East Timor","East Timor"],["Ecuador","Ecuador"],["Egypt","Egypt"],["El Salvador","El Salvador"],["Equatorial Guinea","Equatorial Guinea"],["Eritrea","Eritrea"],["Estonia","Estonia"],["Ethiopia","Ethiopia"],["Falkland Islands","Falkland Islands"],["Faso","Faso"],["Fiji","Fiji"],["Finland","Finland"],["France","France"],["French Guiana","French Guiana"],["French Polynesia","French Polynesia"],["Gabon","Gabon"],["Gambia","Gambia"],["Georgia","Georgia"],["Germany","Germany"],["Ghana","Ghana"],["Gibraltar","Gibraltar"],["Greece","Greece"],["Greenland","Greenland"],["Grenada","Grenada"],["Guadeloupe","Guadeloupe"],["Guam","Guam"],["Guatemala","Guatemala"],["Guinea","Guinea"],["Guinea-Bissau","Guinea-Bissau"],["Guyana","Guyana"],["Haiti","Haiti"],["Honduras","Honduras"],["Hong Kong","Hong Kong"],["Hungary","Hungary"],["Iceland","Iceland"],["India","India"],["Indonesia","Indonesia"],["Iran","Iran"],["Iraq","Iraq"],["Ireland","Ireland"],["Israel","Israel"],["Italy","Italy"],["Jamaica","Jamaica"],["Japan","Japan"],["Jordan","Jordan"],["Kazakhstan","Kazakhstan"],["Kenya","Kenya"],["Kiribati","Kiribati"],["Kuwait","Kuwait"],["Kyrgyzstan","Kyrgyzstan"],["Laos","Laos"],["Latvia","Latvia"],["Lebanon","Lebanon"],["Lesotho","Lesotho"],["Liberia","Liberia"],["Libya","Libya"],["Liechtenstein","Liechtenstein"],["Lithuania","Lithuania"],["Luxembourg","Luxembourg"],["Macau","Macau"],["Macedonia","Macedonia"],["Madagascar","Madagascar"],["Malawi","Malawi"],["Malaysia","Malaysia"],["Maldives","Maldives"],["Mali","Mali"],["Malta","Malta"],["Marshall Islands","Marshall Islands"],["Martinique","Martinique"],["Mauritania","Mauritania"],["Mauritius","Mauritius"],["Mexico","Mexico"],["Micronesia","Micronesia"],["Moldova","Moldova"],["Monaco","Monaco"],["Mongolia","Mongolia"],["Montserrat","Montserrat"],["Morocco","Morocco"],["Mozambique","Mozambique"],["Myanmar","Myanmar"],["Namibia","Namibia"],["Nauru","Nauru"],["Nepal","Nepal"],["Netherlands","Netherlands"],["Netherlands Antilles","Netherlands Antilles"],["New Caledonia","New Caledonia"],["New Zealand","New Zealand"],["Nicaragua","Nicaragua"],["Niger","Niger"],["Nigeria","Nigeria"],["North Korea","North Korea"],["Northern Mariana Islands","Northern Mariana Islands"],["Norway","Norway"],["Oman","Oman"],["Others","Others"],["Pakistan","Pakistan"],["Palau","Palau"],["Palestine","Palestine"],["Panama","Panama"],["Papua New Guinea","Papua New Guinea"],["Paraguay","Paraguay"],["Peru","Peru"],["Philippines","Philippines"],["Pitcairn Islands","Pitcairn Islands"],["Poland","Poland"],["Portugal","Portugal"],["Puerto Rico","Puerto Rico"],["Qatar","Qatar"],["Republic of the Congo","Republic of the Congo"],["Romania","Romania"],["Russia","Russia"],["Rwanda","Rwanda"],["San Marino","San Marino"],["Sao Tome and Principe","Sao Tome and Principe"],["Saudi Arabia","Saudi Arabia"],["Senegal","Senegal"],["Serbia and Montenegro","Serbia and Montenegro"],["Seychelles","Seychelles"],["Sierra Leone","Sierra Leone"],["Singapore","Singapore"],["Slovakia","Slovakia"],["Slovenia","Slovenia"],["Solomon Islands","Solomon Islands"],["Somalia","Somalia"],["South Africa","South Africa"],["South Korea","South Korea"],["Spain","Spain"],["Sri Lanka","Sri Lanka"],["St. Kitts and Nevis","St. Kitts and Nevis"],["St. Lucia","St. Lucia"],["St. Vincent and the Grenadines","St. Vincent and the Grenadines"],["Sudan","Sudan"],["Suriname","Suriname"],["Swaziland","Swaziland"],["Sweden","Sweden"],["Switzerland","Switzerland"],["Syria","Syria"],["Taiwan","Taiwan"],["Tajikistan","Tajikistan"],["Tanzania","Tanzania"],["Thailand","Thailand"],["Tibet","Tibet"],["Togo","Togo"],["Tonga","Tonga"],["Trinidad and Tobago","Trinidad and Tobago"],["Tunisia","Tunisia"],["Turkey","Turkey"],["Turkmenistan","Turkmenistan"],["Turks and Caicos Islands","Turks and Caicos Islands"],["Tuvalu","Tuvalu"],["U.S. Virgin Islands","U.S. Virgin Islands"],["Uganda","Uganda"],["Ukraine","Ukraine"],["United Arab Emirates","United Arab Emirates"],["United Kingdom","United Kingdom"],["United States","United States"],["Uruguay","Uruguay"],["Uzbekistan","Uzbekistan"],["Vanuatu","Vanuatu"],["Venezuela","Venezuela"],["Vietnam","Vietnam"],["Western Sahara","Western Sahara"],["Western Samoa","Western Samoa"],["Yemen","Yemen"],["Zambia","Zambia"],["Zimbabwe","Zimbabwe"]]})}});Ext.namespace("SYNO.SDS.MyDSCenter");Ext.define("SYNO.SDS.MyDSCenter.ServiceModule",{extend:"SYNO.ux.Panel",constructor:function(a){var b=this.fillConfig(a);this.callParent([b])},fillConfig:function(a){var b={itemId:"SYNO.SDS.MyDSCenter.ServiceModule",cls:"myds-module-ct",items:[this.quickconnectPanel=new SYNO.SDS.MyDSCenter.QuickConnectPanel({owner:this}),this.ddnsPanel=new SYNO.SDS.MyDSCenter.DDNSPanel({owner:this})],listeners:{activate:{fn:this.onActivate,scope:this}}};Ext.apply(b,a);return b},onActivate:function(){if(true!==this.loadOnActivate){return}this.loadModule()},onLoggedOut:function(){this.hideAllServices()},setLoadOnActivate:function(a){this.loadOnActivate=!!a},loadModule:function(){var a=[{api:"SYNO.Core.QuickConnect",method:"get",version:2},{api:"SYNO.Core.QuickConnect",method:"status",version:1},{api:"SYNO.Core.QuickConnect.Permission",method:"get",version:1},{api:"SYNO.Core.DDNS.Record",version:1,method:"list"}];if(this.getEl()){this.getEl().mask(_WFT("common","loading"),"x-mask-loading")}this.sendWebAPI({params:{},compound:{stopwhenerror:true,params:a},scope:this,callback:function(c,e,f,b){if(this.getEl()){this.getEl().unmask()}if(!c||e.has_fail){var m=SYNO.API.Util.GetFirstError(e);if(this.getEl()){this.getEl().mask(SYNO.API.getErrorString(m))}return}var g;var n=SYNO.API.Util.GetValByAPI(e,"SYNO.Core.QuickConnect","get");var d=SYNO.API.Util.GetValByAPI(e,"SYNO.Core.QuickConnect.Permission","get");var k=SYNO.API.Util.GetValByAPI(e,"SYNO.Core.QuickConnect","status");this.quickconnectPanel.showService({server_info:n,permission:d,status:k});var j=SYNO.API.Util.GetValByAPI(e,"SYNO.Core.DDNS.Record","list","records");var l,h;for(g=0;g<j.length;g++){if("Synology"===j[g].id){l=true;h=j[g];break}}if(l){this.ddnsPanel.showService(h)}else{this.ddnsPanel.hideService()}}})},hideAllServices:function(){this.ddnsPanel.hideService();this.quickconnectPanel.hideService()}});Ext.define("SYNO.SDS.MyDSCenter.DDNSPanel",{extend:"SYNO.ux.Panel",constructor:function(a){var b=this.fillConfig(a);this.callParent([b])},fillConfig:function(a){var b={cls:"myds-service-panel",items:[{html:"DDNS",cls:"myds-service-title",border:false},this.mainPanel=new SYNO.ux.Panel({layout:"card",border:false,activeItem:"introduction",items:[{xtype:"box",itemId:"introduction",data:{},autoHeight:true,tpl:new Ext.XTemplate('<div class="syno-sds-myds-service-ct"><div>'+_T("myds","service_ddns_introduction")+'</div><a class="link-font" href="javascript: void(0)">'+_T("myds","service_ddns_setup")+"</a></div>"),listeners:{render:function(d){var c=d.el.child("a");if(c){this.mon(c,"click",function(){SYNO.SDS.AppLaunch("SYNO.SDS.AdminCenter.Application",{fn:"SYNO.SDS.AdminCenter.PublicAccess.Main"})},this)}},scope:this,single:true,buffer:80}},{xtype:"box",itemId:"info",data:{},autoHeight:true,tpl:('<div class="syno-sds-myds-service-ct"><table class="ddns-table"><tbody><tr><td>DDNS '+_T("service","service_ddns_hostname")+':</td><td colspan="3">{hostname}</td></tr><tr><td>'+_T("service","service_wanconfig_status")+':</td><td class="{status_class}">{status}</td><td>'+_T("service","service_wanconfig_gateway_addr_out")+"(IPv6):</td><td>{ipv6}</td></tr><tr><td>"+_T("service","service_ddns_heartbeat")+':</td><td class="{heartbeat_class}">{heartbeat}</td><td>'+_T("service","service_wanconfig_gateway_addr_out")+"(IPv4):</td><td>{ipv4}</td></tr><tr><td>"+_T("service","service_ddns_last_updated")+':</td><td colspan="3">{last_updated}</td></tr></tbody></table></div>')}]})]};Ext.apply(b,a);return b},showService:function(c){var b=this.mainPanel.getComponent("info");b.update({hostname:c.hostname,ipv4:c.ip,ipv6:("0:0:0:0:0:0:0:0"===c.ipv6)?"-":c.ipv6,status:SYNO.SDS.MyDSCenter.Utils.getDDNSStatusText(c.status),status_class:SYNO.SDS.MyDSCenter.Utils.getDDNSStatusClass(c.status),heartbeat:"service_ddns_normal"===c.status?(c.heartbeat?_T("common","enabled"):_T("common","disabled")):"-",heartbeat_class:c.heartbeat?"green-status":"red-status",last_updated:SYNO.SDS.MyDSCenter.Utils.getDDNSStatusText(c.lastupdated)});this.mainPanel.getLayout().setActiveItem("info");if("service_ddns_status_synology_email_not_verified"===c.status){var a=this.mainPanel.getComponent("info").el.child("a");if(a){this.mon(a,"click",function(){this.sendWebAPI({api:"SYNO.Core.DDNS.Synology",method:"send_verified_mail",version:1,scope:this,params:{account:this.owner.owner.account},callback:function(f,e,d){var g="";g='<font class="blue-status">'+this.owner.owner.account+"</font>";g=String.format(_T("service","service_ddns_msg_verification_mail_alert"),g);this.findWindow().getMsgBox().alert(_T("tree","leaf_wanconfig"),g)}})},this)}}},hideService:function(){this.mainPanel.getLayout().setActiveItem("introduction")}});Ext.define("SYNO.SDS.MyDSCenter.QuickConnectPanel",{extend:"SYNO.ux.Panel",constructor:function(a){var b=this.fillConfig(a);this.callParent([b])},fillConfig:function(a){var b={cls:"myds-service-panel",items:[{html:"QuickConnect",cls:"myds-service-title",border:false},this.mainPanel=new SYNO.ux.Panel({layout:"card",border:false,activeItem:"introduction",items:[{xtype:"box",itemId:"introduction",data:{},autoHeight:true,tpl:new Ext.XTemplate('<div class="syno-sds-myds-service-ct"><div>'+_T("myds","service_quickconnect_introduction")+'</div><a class="link-font" href=javascript:SYNO.SDS.MyDSCenter.Utils.launchQuickConnect()>'+_T("myds","service_quickconnect_create")+"</a></div>")},{xtype:"box",itemId:"info",data:{},autoHeight:true,tpl:('<div class="syno-sds-myds-service-ct"><div {url_hidden}><div class="title">'+_T("relayservice","browser_description")+'</div><div class="content" {dsm_hidden}><span class="title">DSM:</span><span><a class="link-font selectabletext" target="_blank" href="{dsm_url}">{dsm_url}</a></span></div><div class="content" {photo_hidden}><span class="title">Photo Station:</span><span><a class="link-font selectabletext" target="_blank" href="{photo_url}">{photo_url}</a></span></div></div><div {mobile_hidden}><div class="title" {cloud_hidden}>'+_T("relayservice","syno_mobile_apps")+'</div><div class="title" {cloud_not_hidden}>'+_T("relayservice","syno_mobile_apps_only")+'</div><div class="content"><span class="title">QuickConnect ID:</span><span class="link-font selectabletext">{alias}</span></div></div><div class="title">'+_T("myds","service_quickconnect_enabled_services")+'</div><div class="content"><table><tbody><tr><td><span class="title">'+_T("myds","service")+':</span></td><td><span class="link-font">{service_list}</span></td></tr></tbody></table></div><div class="title syno-ux-displayfield x-form-display-field" {alias_note_hidden}><span class="syno-ux-note">'+_T("common","note")+': </span><span class="normal-font">'+_T("relayservice","alias_new_restriction")+"</span></div></div>")},{xtype:"box",itemId:"no_service",data:{},autoHeight:true,tpl:('<div class="syno-sds-myds-service-ct"><div class="title">'+_T("myds","quickconnect_no_service")+'</div><div class="content"><span class="title">QuickConnect ID:</span><span class="link-font selectabletext">{alias}</span></div><div class="title"><a class="link-font" href=javascript:SYNO.SDS.MyDSCenter.Utils.launchQuickConnect()>'+_T("myds","quickconnect_setup_service")+"</a></div></div>")}]})]};Ext.apply(b,a);return b},showService:function(t){var d=this.mainPanel.getComponent("info");var s=("connected"===t.status.status);var k=t.server_info.enabled;var h=t.server_info.server_alias;var j=t.server_info.server_id;var m=""!==h?h:j;var g=SYNO.SDS.QuickConnect.Utils.aliasToPortalUrl(m,SYNO.SDS.QuickConnect.Utils.TYPES.NORMAL);var e=m.indexOf("_")!==-1||m.length>63;var q=""!==h;var a=t.permission.services;if(Ext.isDefined(t.permission.services)){this.dsm_permission=false;this.photo_permission=false;this.ds_photo_permission=false;this.mobile_apps_permission=false;this.cloud_permission=false;this.file_sharing_permission=false;for(var l in a){if(a.hasOwnProperty(l)){switch(a[l].id){case"dsm_portal":this.dsm_permission=a[l].enabled;break;case"photo_portal":this.photo_permission=a[l].enabled;break;case"mobile_apps":this.mobile_apps_permission=a[l].enabled;break;case"photostation":this.ds_photo_permission=a[l].enabled;break;case"cloudstation":this.cloud_permission=a[l].enabled;break;case"file_sharing":this.file_sharing_permission=a[l].enabled;break}}}}var p=!(this.dsm_permission||this.photo_permission||this.ds_photo_permission||this.cloud_permission||this.mobile_apps_permission);if(!k||!s){this.hideService();return}else{if(p){this.showNoService(m);return}}var f=SYNO.SDS.StatusNotifier.isAppEnabled("SYNO.SDS.PhotoStation");f=f&&this.photo_permission;var n=SYNO.SDS.StatusNotifier.isAppEnabled("SYNO.SDS.CSTN.Instance");n=n&&this.cloud_permission;var b=this.dsm_permission;var o,c=[];for(o=0;o<a.length;o++){if(a[o].enabled){c.push(SYNO.SDS.MyDSCenter.Utils.getQuickConnectServiceNameByID(a[o].id))}}var r='style="display:none"';d.update({alias:m,dsm_url:g,photo_url:g+"/photo",url_hidden:!q||e||(!f&&!b)?r:"",alias_note_hidden:e?"":r,mobile_hidden:!(this.mobile_apps_permission||this.cloud_permission||this.ds_photo_permission)?r:"",photo_hidden:!f?r:"",cloud_hidden:!n?r:"",cloud_not_hidden:n?r:"",dsm_hidden:!b?r:"",service_list:c.join(", ")});this.mainPanel.getLayout().setActiveItem("info")},hideService:function(){this.mainPanel.getLayout().setActiveItem("introduction")},showNoService:function(a){var b=this.mainPanel.getComponent("no_service");b.update({alias:a});this.mainPanel.getLayout().setActiveItem("no_service")}});Ext.namespace("SYNO.SDS.MyDSCenter");Ext.define("SYNO.SDS.MyDSCenter.PurchaseModule",{extend:"SYNO.ux.Panel",constructor:function(a){var b=this.fillConfig(a);this.callParent([b]);this.mon(this.gridPanel.getStore(),{beforeload:function(){this.searchBtn.disable()},load:function(){this.searchBtn.enable()},exception:function(){this.searchBtn.enable()},scope:this})},fillConfig:function(a){var c=_S("lang")==="hun",b={itemId:"SYNO.SDS.MyDSCenter.PurchaseModule",cls:"myds-module-ct",layout:{type:"vbox",pack:"start",align:"stretch"},items:[{xtype:"syno_fieldset",title:_T("myds","purchase_history"),collapsible:false,flex:1,items:[this.formPanel=new SYNO.ux.FormPanel({width:706,height:300,items:[{xtype:"syno_displayfield",value:String.format(_T("myds","purchase_history_introduction"),'<a class="link-font" href="javascript: void(0)">',"</a>"),listeners:{render:function(e){var d=e.el.child("a");if(d){this.mon(d,"click",function(){SYNO.SDS.AppLaunch("SYNO.SDS.PkgManApp.Instance")},this)}},scope:this,single:true,buffer:80}},{xtype:"syno_compositefield",hideLabel:true,items:[{xtype:"syno_radio",name:"search_type",checked:true,width:20,inputValue:"keyword",listeners:{scope:this,check:function(d,e){this.onChangeSearchType(e)}}},{xtype:"syno_displayfield",width:190,value:_T("myds","search_by_keyword")},{xtype:"syno_textfield",name:"search_keyword",width:(c)?170:195,style:{position:"absolute"}},{xtype:"syno_displayfield",width:(c)?110:60,style:{textAlign:"center"},value:_T("myds","in")},{xtype:"syno_combobox",name:"search_keyword_type",value:"apps",width:(c)?170:195,displayField:"display",valueField:"value",store:SYNO.SDS.MyDSCenter.Utils.getSearchTypeStore(),listeners:{scope:this,change:this.onChangeSearchKeyword}}]},{xtype:"syno_compositefield",hideLabel:true,items:[{xtype:"syno_radio",width:20,name:"search_type",inputValue:"date"},{xtype:"syno_displayfield",width:190,value:_T("myds","search_by_date")},{xtype:"syno_datefield",name:"date_from",width:(c)?170:195,disabled:true,format:"Y-m-d",listeners:{change:function(h,f,d){var g=this.formPanel.form.findField("date_to");var e=g.getValue();if(e&&f.getTime()>e.getTime()){g.setValue(f)}},scope:this}},{xtype:"syno_displayfield",width:(c)?110:60,style:{textAlign:"center"},value:_T("myds","to")},{xtype:"syno_datefield",name:"date_to",width:(c)?170:195,disabled:true,format:"Y-m-d",listeners:{change:function(h,f,d){var g=this.formPanel.form.findField("date_from");var e=g.getValue();if(e&&f.getTime()<e.getTime()){g.setValue(f)}},scope:this}}]},{layout:{type:"hbox",pack:"end"},padding:0,border:false,items:[this.searchBtn=new SYNO.ux.Button({xtype:"syno_button",text:_T("myds","search"),handler:this.onClickSearchBtn,scope:this})]}]})]},this.gridPanel=new SYNO.SDS.MyDSCenter.PurchaseGrid({owner:this,height:292})],listeners:{activate:{fn:this.onActivate,scope:this}}};Ext.apply(b,a);return b},loadModule:function(){this.gridPanel.getStore().load()},onActivate:function(){if(false===this.owner.activated){this.getEl().mask(_T("myds","please_activate"));this.formPanel.getForm().reset();this.gridPanel.getStore().removeAll();this.gridPanel.pagingToolbar.updateInfo();return}else{this.getEl().unmask()}this.loadModule()},onChangeSearchKeyword:function(c,d,a){var b=this.formPanel.getForm().findField("search_keyword");if("prices"===d){b.validator=function(e){return isNaN(parseInt(e,10))?String.format(_JSLIBSTR("extlang","invalidnumber"),e):true}}else{b.validator=null}},onChangeSearchType:function(b){var a=this.formPanel.getForm();a.findField("date_from").setDisabled(b);a.findField("date_to").setDisabled(b);a.findField("search_keyword").setDisabled(!b);a.findField("search_keyword_type").setDisabled(!b)},onClickSearchBtn:function(){this.gridPanel.getStore().load()}});Ext.define("SYNO.SDS.MyDSCenter.PurchaseGrid",{extend:"SYNO.ux.GridPanel",constructor:function(a){var b=this.fillConfig(a);this.callParent([b])},fillConfig:function(a){var b={autoScroll:true,store:this.getStore(),colModel:this.getColumnModel(),border:false,loadMask:true,viewConfig:{forceFit:true},bbar:this.pagingToolbar=new SYNO.ux.PagingToolbar({pageSize:10000,store:this.getStore(),displayInfo:true})};Ext.apply(b,a);return b},getStore:function(){if(!Ext.isDefined(this.histroyStore)){this.histroyStore=new Ext.data.Store({autoLoad:false,proxy:new SYNO.API.Proxy({api:"SYNO.Core.MyDSCenter.Purchase",method:"list",version:1}),reader:new Ext.data.JsonReader({root:"logs"},[{name:"date"},{name:"item"},{name:"buyer_id"},{name:"transaction_id"},{name:"model"},{name:"serial"},{name:"model_and_serial",convert:function(b,a){return a.model+" "+a.serial}},{name:"price"},{name:"pay_status"}]),remoteSort:false,sortInfo:{field:"date",direction:"ASC"},listeners:{scope:this,beforeload:function(a,b){if(false===Ext.isDefined(this.findWindow().auth_key)){return false}var d=this.owner.formPanel.getForm().getValues();if("keyword"===d.search_type){var c=d.search_keyword.trim().split(" ");b.params[d.search_keyword_type]=c}else{if("date"===d.search_type){b.params.date_from=d.date_from;b.params.date_to=d.date_to}}return true},exception:function(d,b,f,c,e,a){this.getStore().removeAll();this.pagingToolbar.updateInfo()}}})}return this.histroyStore},getColumnModel:function(){if(!Ext.isDefined(this.historyColumnModel)){this.historyColumnModel=new Ext.grid.ColumnModel({defaults:{sortable:true,renderer:SYNO.SDS.MyDSCenter.Utils.purchaseColumnRenderer},columns:[{header:_T("time","time_date"),dataIndex:"date",width:80},{header:_T("myds","item"),dataIndex:"item",width:130},{header:_T("myds","buyer_id"),dataIndex:"buyer_id",width:80},{header:_T("myds","transaction_id"),dataIndex:"transaction_id",width:100},{header:_T("myds","model_and_serial"),dataIndex:"model_and_serial",width:130},{header:_T("pkgmgr","myds_pay_price"),dataIndex:"price",width:80,renderer:function(g,e,a,d,f,b){var c=Ext.util.Format.htmlEncode("$"+g.toFixed(2));e.attr='ext:qtip="'+Ext.util.Format.htmlEncode(c)+'"';return c}},{header:_T("common","status"),dataIndex:"pay_status",width:100}]})}return this.historyColumnModel},deactivate:function(){return true}});Ext.namespace("SYNO.SDS.MyDSCenter");Ext.define("SYNO.SDS.MyDSCenter.AccountModule",{extend:"SYNO.ux.Panel",constructor:function(a){var b=this.fillConfig(a);this.callParent([b])},fillConfig:function(a){var b={itemId:"SYNO.SDS.MyDSCenter.AccountModule",cls:"myds-module-ct",layout:"fit",items:[{xtype:"syno_fieldset",title:_T("myds","account_information"),layout:"fit",collapsible:false,items:[this.formPanel=new SYNO.ux.FormPanel({trackResetOnLoad:true,defaults:{labelWidth:270},items:[{xtype:"syno_displayfield",value:_T("myds","account_info_desc")},{xtype:"syno_textfield",indent:1,fieldLabel:"*"+_T("service","service_ddns_fullname"),minLength:2,maxLength:256,width:300,allowBlank:false,name:"full_name"},{xtype:"syno_textfield",indent:1,fieldLabel:"*"+_T("user","user_email"),allowBlank:false,minLength:3,maxLength:256,vtype:"email",vtypeText:_JSLIBSTR("vtype","bad_email"),name:"email",width:300,enableKeyEvents:true,listeners:{keyup:this.setFieldsAvailability,scope:this}},{xtype:"syno_textfield",indent:1,fieldLabel:"*"+_T("myds","password_current"),allowBlank:false,textType:"password",width:300,minLength:6,maxLength:128,name:"current_password"},{xtype:"syno_textfield",indent:1,fieldLabel:_T("myds","password_new"),textType:"password",minLength:6,maxLength:128,name:"new_password",emptyText:SYNO.SDS.MyDSCenter.Utils.isSupportPlaceholder()?_T("myds","new_password_placeholder"):undefined,enableKeyEvents:true,width:300,listeners:{keyup:this.setFieldsAvailability,scope:this}},{xtype:"syno_textfield",indent:1,fieldLabel:_T("myds","password_new_confirm"),allowBlank:false,textType:"password_confirm",name:"new_password_confirm",width:300,disabled:true,confirmFor:"new_password"}],fbar:{items:[{width:"auto",xtype:"syno_button",btnStyle:"blue",text:_T("common","commit"),scope:this,handler:this.onClickCommitBtn},{width:"auto",xtype:"syno_button",btnStyle:"grey",text:_T("common","reset"),scope:this,handler:this.onClickResetBtn}]}})]}],listeners:{activate:{fn:this.onActivate,scope:this},afterlayout:{fn:this.onAfterLayout,single:true,scope:this}}};Ext.apply(b,a);return b},onAfterLayout:function(){var a=this.formPanel.getForm();SYNO.SDS.Utils.AddTip(a.findField("email").getEl(),_T("myds","change_email_desc"))},onClickCommitBtn:function(){var a=this.formPanel.getForm(),b=a.getFieldValues(true);if(!a.isDirty()||!a.isValid()){return}if(this.getEl()){this.getEl().mask(_WFT("common","loading"),"x-mask-loading")}this.sendWebAPI({api:"SYNO.Core.MyDSCenter.Account",version:1,method:"set",params:b,scope:this,callback:function(c,d,g){if(this.getEl()){this.getEl().unmask()}if(!c){var f;switch(d.code){case 3005:f=String.format(SYNO.API.getErrorString(d),g.email);break;default:f=SYNO.API.getErrorString(d);break}this.findWindow().getMsgBox().alert("",f);return}if(Ext.isDefined(g.email)){this.owner.account=g.email;this.owner.activated=false;this.getEl().mask(_T("myds","please_activate"))}var e=this.formPanel.getForm();e.findField("new_password").setValue("");e.findField("current_password").setValue("12345687");e.findField("new_password_confirm").setValue("").setDisabled(true);e.setValues(e.getValues())}})},onClickResetBtn:function(){var a=this.formPanel.getForm();a.findField("new_password_confirm").disable();a.reset()},setFieldsAvailability:function(){var d=this.formPanel.getForm();var a=d.findField("email");var c=d.findField("current_password");var b=d.findField("new_password");var e=d.findField("new_password_confirm");if(!c.isDirty()&&(!b.getValue().empty()||a.isDirty())){c.setValue("")}e.setDisabled(b.getValue().empty())},onActivate:function(){if(false===this.owner.activated){this.getEl().mask(_T("myds","please_activate"));SYNO.SDS.MyDSCenter.Utils.clearForm(this.formPanel.getForm());return}else{this.getEl().unmask()}this.loadModule()},loadModule:function(){if(false===Ext.isDefined(this.findWindow().auth_key)){return}if(this.getEl()){this.getEl().mask(_WFT("common","loading"),"x-mask-loading")}this.sendWebAPI({api:"SYNO.Core.MyDSCenter.Account",version:1,method:"get",params:{},scope:this,callback:function(a,b,c){if(!a){if(this.getEl()){this.getEl().unmask();this.getEl().mask(SYNO.API.getErrorString(b))}return}if(this.getEl()){this.getEl().unmask()}Ext.apply(b,{current_password:"12345687",new_password:"",new_password_confirm:""});this.formPanel.getForm().setValues(b);this.setFieldsAvailability()}})},onLoggedOut:function(){SYNO.SDS.MyDSCenter.Utils.clearForm(this.formPanel.getForm())},setLoadOnActivate:function(a){this.loadOnActivate=!!a},deactivate:function(){return !this.formPanel.getForm().isDirty()}});Ext.namespace("SYNO.SDS.MyDSCenter");Ext.define("SYNO.SDS.MyDSCenter.SubscribeModule",{extend:"SYNO.ux.Panel",constructor:function(a){var b=this.fillConfig(a);this.callParent([b])},fillConfig:function(a){var b={itemId:"SYNO.SDS.MyDSCenter.SubscribeModule",cls:"myds-module-ct",layout:"fit",items:[{xtype:"syno_fieldset",title:_T("myds","subscription_settings"),layout:"fit",collapsible:false,items:[this.formPanel=new SYNO.ux.FormPanel({trackResetOnLoad:true,items:[{xtype:"syno_displayfield",value:_T("myds","subscription_settings_intro")},{xtype:"syno_checkbox",indent:1,name:"enews",boxLabel:_T("myds","enews_desc"),listeners:{check:this.setFieldsAvailability,scope:this}},{xtype:"syno_combobox",indent:2,width:300,hideLabel:true,name:"notify_language",displayField:"display",valueField:"value",store:SYNO.SDS.MyDSCenter.Utils.getLanguageStore()},{xtype:"syno_checkbox",indent:1,name:"enews_local_promotion",boxLabel:_T("myds","enews_local_promotion_desc"),listeners:{check:this.setFieldsAvailability,scope:this}},{xtype:"syno_combobox",indent:2,width:300,hideLabel:true,name:"country",displayField:"display",valueField:"value",store:SYNO.SDS.MyDSCenter.Utils.getCountryStore()},{xtype:"syno_checkbox",indent:1,name:"critical_release",boxLabel:_T("myds","critical_release_desc"),listeners:{check:function(c){var d=this.formPanel.getForm().findField("critical_version_list");d.setDisabled(!c.getValue()).setValue(c.getValue()?"latest":"");this.cuStore.singleSort("value","DESC")},scope:this}},{xtype:"syno_superboxselect",indent:2,width:300,hideLabel:true,name:"critical_version_list",displayField:"name",valueField:"value",mode:"local",disabled:true,allowBlank:false,allowAddNewData:false,store:this.cuStore=new Ext.data.ArrayStore({fields:["name","value"],data:[],sortInfo:{field:"value",direction:"DESC"}})}],fbar:{items:[{width:"auto",xtype:"syno_button",btnStyle:"blue",text:_T("common","commit"),scope:this,handler:this.onClickCommitBtn},{width:"auto",xtype:"syno_button",btnStyle:"grey",text:_T("common","reset"),scope:this,handler:this.onClickResetBtn}]}})]}],listeners:{activate:{fn:this.onActivate,scope:this}}};Ext.apply(b,a);return b},onClickCommitBtn:function(){var a=this.formPanel.getForm(),b=a.getFieldValues(true);if(!a.isDirty()||!a.isValid()){return}if(false===b.critical_release){b.critical_version_list=""}if(this.getEl()){this.getEl().mask(_WFT("common","loading"),"x-mask-loading")}this.sendWebAPI({api:"SYNO.Core.MyDSCenter.Account",version:1,method:"set",params:b,scope:this,callback:function(c,d,g){if(this.getEl()){this.getEl().unmask()}if(!c){var f=SYNO.API.getErrorString(d);this.findWindow().getMsgBox().alert("",f);return}var e=this.formPanel.getForm();e.setValues(e.getValues());this.cuStore.singleSort("value","DESC")}})},onClickResetBtn:function(){var a=this.formPanel.getForm();a.reset()},setFieldsAvailability:function(){var c=this.formPanel.getForm();var d=c.findField("enews");var a=c.findField("enews_local_promotion");var e=c.findField("notify_language");var b=c.findField("country");e.setDisabled(!d.getValue());b.setDisabled(!a.getValue())},onActivate:function(){if(false===this.owner.activated){this.getEl().mask(_T("myds","please_activate"));SYNO.SDS.MyDSCenter.Utils.clearForm(this.formPanel.getForm());return}else{this.getEl().unmask()}this.loadModule()},loadModule:function(){if(false===Ext.isDefined(this.findWindow().auth_key)){return}if(this.getEl()){this.getEl().mask(_WFT("common","loading"),"x-mask-loading")}this.sendWebAPI({api:"SYNO.Core.MyDSCenter.Account",version:1,method:"get",params:{},scope:this,callback:function(a,c,f){if(!a){if(this.getEl()){this.getEl().unmask();this.getEl().mask(SYNO.API.getErrorString(c))}return}if(this.getEl()){this.getEl().unmask()}if(!Ext.isDefined(c.critical_version_domain)){return}var e,b=c.critical_version_domain.split(",").sort(function(h,g){return g-h}),d=[];for(e=0;e<b.length;e++){if("latest"===b[e]){d.push([_T("myds","latest_version"),"latest"])}else{d.push([b[e],b[e]])}}this.formPanel.getForm().setValues({critical_version_list:""});this.formPanel.getForm().findField("critical_version_list").getStore().loadData(d);this.formPanel.getForm().setValues(c);this.cuStore.singleSort("value","DESC");this.setFieldsAvailability()}})},deactivate:function(){return !this.formPanel.getForm().isDirty()}});Ext.namespace("SYNO.SDS.MyDSCenter.MigrationWizard");Ext.define("SYNO.SDS.MyDSCenter.MigrationWizard.ProgressBar",{extend:"Ext.Container",constructor:function(a){var b=this.fillConfig(a);this.callParent([b])},fillConfig:function(a){var c={progress_total:3,progress_value:0};Ext.apply(c,a);var d,b=[];for(d=0;d<c.progress_total;d++){b.push({xtype:"box",autoEl:{tag:"div",cls:"syno-sds-myds-migration-progress-bar-dot"+((c.progress_value===d)?" dot-active":"")}})}c.items=b;c.layout={type:"hbox",pack:"center",align:"middle"};c.defaults={margins:"0px 3px"};c.cls+=" syno-sds-myds-migration-progress-bar";return c},setProgress:function(a){if(0>a||this.progress_total<=a){return false}this.items.items[this.progress_value].removeClass("dot-active");this.items.items[a].addClass("dot-active");this.progress_value=a;return true}});Ext.define("SYNO.SDS.MyDSCenter.ToolTip",{extend:"Ext.Container",constructor:function(a){this.callParent([this.fillConfig(a)])},fillConfig:function(a){var b,c=a.data;this.table=this.createTable(c);this.arrow=this.createArrow();b={cls:"myds-tooltip",renderTo:Ext.getBody(),items:[this.arrow,this.table],listeners:{beforedestroy:function(){this.el.removeAllListeners();this.table.el.removeAllListeners();this.arrow.el.removeAllListeners();this.bgEl.removeAllListeners()},scope:this}};Ext.apply(b,a);return b},createTable:function(b){if(!b||!Ext.isArray(b)){return null}var c=[],a;b.each(function(e){var f=Ext.util.Format.htmlEncode(e.name),d=Ext.util.Format.htmlEncode(e.desc);c.push({html:'<p ext:qtip="'+Ext.util.Format.htmlEncode(f)+'">'+f+"</p>",cellCls:"myds-tooltip-title"});c.push({html:'<p ext:qtip="'+Ext.util.Format.htmlEncode(d)+'">'+d+"</p>",cellCls:"myds-tooltip-desc"})});a=new Ext.Container({cls:"myds-tooltip-table",layout:"table",layoutConfig:{columns:2},defaults:{border:false,xtype:"box"},items:c});return a},anchorToContainer:function(){var b=this.table.getEl(),a={};this.container.setWidth(this.owner.width);this.arrow.el.anchorTo(this.container,"tl-tr",[5,9]);this.table.el.anchorTo(this.arrow.el,"tl-tr",[0,-6]);this.el.anchorTo(this.container,"tl-tr",[0,-2]);a.width=b.getWidth()+"px";a.height=b.getHeight()+"px";if(!this.bgEl){this.bgEl=Ext.get(document.createElement("div"));this.bgEl.addClass("myds-tooltip-table-bg");this.bgEl.insertBefore(b)}this.bgEl.anchorTo(b,"tl-tl");this.bgEl.applyStyles(a)},afterRender:function(){this.callParent(arguments);this.anchorToContainer()},createArrow:function(){var a=new Ext.BoxComponent({cls:"myds-tooltip-arrow",html:'<div class="myds-tooltip-arrow-transform"></div>'});return a},updateTableContent:function(a){if(!a||!Ext.isArray(a)){return null}this.remove(this.table,true);this.table=null;this.table=this.createTable(a);this.add(this.table);this.doLayout();this.anchorToContainer()}});Ext.define("SYNO.SDS.MyDSCenter.ConfirmSkipDialog",{extend:"SYNO.SDS.ModalWindow",constructor:function(a){this.callParent([this.fillConfig(a)])},fillConfig:function(a){var b={header:false,useStatusBar:false,width:680,height:170+a.data.length*28,resizable:false,cls:"myds-confirm-dialog",items:{xtype:"panel",border:false,items:[{xtype:"box",html:String.format('<div class="confirm-icon"></div><div class="confirm-message">{0}</div>',Ext.util.Format.htmlEncode(a.text))},{xtype:"container",cls:"myds-confirm-dialog-table",layout:"table",layoutConfig:{columns:3},defaults:{height:28,border:false,xtype:"box"},items:(a&&a.data)?this.createTableItems(a.data):null}],fbar:["->",{xtype:"syno_button",btnStyle:"blue",text:_T("common","yes"),handler:this.confirmHandler,scope:this},{xtype:"syno_button",btnStyle:"grey",text:_T("common","cancel"),handler:this.close,scope:this}]}};return Ext.apply(b,a)},confirmHandler:function(){if(false===Ext.isFunction(this.callback)){return false}this.callback.apply(this.scope||window);this.close()},createTableItems:function(b){var a=[];b.each(function(c){a=a.concat([{width:28,html:String.format('<div class="status-{0}"></div>',c.status)},{cls:"service-name",html:'<p style="font-weight: bold;">'+Ext.util.Format.htmlEncode(c.name)+"</p>"},{width:200,html:'<p class="green-status">'+Ext.util.Format.htmlEncode(c.desc)+"</p>"}])});return a}});Ext.namespace("SYNO.SDS.MyDSCenter");Ext.define("SYNO.SDS.MyDSCenter.RegisterDialog",{extend:"SYNO.SDS.ModalWindow",constructor:function(a){this.owner=a.owner;var b=this.fillConfig(a);this.callParent([b]);this.addEvents("login_success","cancel_login");this.addListener("beforeshow",this.onBeforeShow,this,{single:true});this.checkTOS=this.getFormPanel().getForm().findField("register_tos");this.checkTOS.mon(this.checkTOS,"check",function(d,c){this.registerBtn.setDisabled(!c)},this)},fillConfig:function(a){var b={title:_T("relayservice","window_title_register_myds"),width:505,height:(true===a.mydsCenterMode)?370:396,layout:"fit",mydsCenterMode:false,items:[this.getFormPanel(a)],buttons:[this.registerBtn=new SYNO.ux.Button({text:_T("common","ok"),btnStyle:"blue",disabled:true,scope:this,handler:this.onOkClick}),{text:_T("common","cancel"),scope:this,handler:this.close}]};Ext.apply(b,a);return b},getFormPanel:function(a){if(!Ext.isDefined(this.formPanel)){var b={keys:[{key:Ext.EventObject.ENTER,fn:this.onOkClick,scope:this}],items:[{xtype:"syno_displayfield",value:_T("relayservice","myds_register_description")},{xtype:"syno_textfield",fieldLabel:_T("user","user_email"),allowBlank:false,minLength:3,maxLength:256,vtype:"email",vtypeText:_JSLIBSTR("vtype","bad_email"),name:"account"},{xtype:"syno_textfield",fieldLabel:_T("common","password"),textType:"password",minLength:6,maxLength:128,allowBlank:false,name:"password"},{xtype:"syno_textfield",fieldLabel:_T("login","forget_pass_comfirm_password"),textType:"password_confirm",name:"password_confirm",allowBlank:false,confirmFor:"password"},{xtype:"syno_textfield",fieldLabel:_T("service","service_ddns_fullname"),minLength:2,maxLength:256,allowBlank:false,name:"fullname"},{xtype:"syno_checkbox",name:"critical_release",checked:true,boxLabel:_T("myds","register_critical_release")},{xtype:"syno_checkbox",name:"register_tos",boxLabel:String.format(_T("myds","register_tos"),'<a href="javascript: void(0)" class="link-font">',"</a>"),listeners:{render:function(d){var c=d.wrap.child("a");if(c){this.mon(c,"click",function(f){window.open("https://www.synology.com/company/privacy","_blank");f.stopEvent()},this)}},scope:this,single:true,buffer:80}}]};if(true!==a.mydsCenterMode){b.items.push({border:false,layout:{type:"hbox",pack:"end"},items:[{xtype:"syno_button",cls:"myds-link-btn",text:_T("myds","already_have_account"),scope:this,handler:this.onLoginClick}]})}this.formPanel=new SYNO.ux.FormPanel(b)}return this.formPanel},onLoginClick:function(){var a=new SYNO.SDS.MyDSCenter.LoginDialog({owner:this.owner,listeners:this.initialConfig.listeners});a.open();this.close()},onClose:function(){if(this.mydsCenterMode&&!Ext.isDefined(this.owner.auth_key)){var a=new SYNO.SDS.MyDSCenter.Package.LoginDialog({owner:this.owner,listeners:this.initialConfig.listeners});a.open()}},onBeforeShow:function(){this.findWindow().setStatusBusy({text:_T("common","loading")});this.sendWebAPI({api:"SYNO.Core.MyDSCenter",version:2,method:"query",params:{},scope:this,callback:function(a,b,c){this.findWindow().clearStatusBusy();if(!a){this.findWindow().getMsgBox().alert("",_T("myds","error_query_info"),function(){this.close()},this);return}if(b.is_logged_in){this.findWindow().getMsgBox().alert("",String.format(_T("myds","already_logged_in"),b.account),function(){this.findWindow().fireEvent("login_success",b.account,b.auth_key,b.activated);this.close()},this);return}this.getFormPanel().getForm().findField("account").focus()}})},onOkClick:function(){var a=this.getFormPanel().getForm();if(!a.isValid()){return}var c=a.getValues();var b=[{api:"SYNO.Core.MyDSCenter",version:2,method:"register",params:{account:c.account,password:c.password,fullname:c.fullname,critical_release:(("true"===c.critical_release||true===c.critical_release)?true:false)}},{api:"SYNO.Core.MyDSCenter",version:2,method:"login",params:{account:c.account,password:c.password}}];this.findWindow().setStatusBusy({text:_T("common","loading")});this.sendWebAPI({params:{},compound:{stopwhenerror:true,params:b},encryption:["password"],scope:this,callback:function(d,e,h,g){this.findWindow().clearStatusBusy();if(!d||e.has_fail){var i,j=null,f=SYNO.API.Util.GetFirstError(e);switch(f.code){case 3005:i=String.format(SYNO.API.getErrorString(f),h.compound[0].account);break;case 3010:i=String.format(SYNO.API.getErrorString(f),f.errors.username);j=function(){this.findWindow().fireEvent("login_success",f.errors.username,f.errors.auth_key,f.errors.activated);this.close()};break;case 3012:i=_T("myds","register_success");break;default:i=SYNO.API.getErrorString(f);break}this.findWindow().getMsgBox().alert("",i,j,this);return}this.findWindow().getMsgBox().alert("",String.format(_T("myds","activate_mail_desc"),h.compound[0].account),function(){this.findWindow().fireEvent("login_success",e.result[1].data.account,e.result[1].data.auth_key,e.result[1].data.activated);this.close()},this)}})}});Ext.define("SYNO.SDS.MyDSCenter.LoginDialog",{extend:"SYNO.SDS.ModalWindow",constructor:function(a){this.owner=a.owner;var b=this.fillConfig(a);this.callParent([b]);this.addEvents("login_success");this.addListener("beforeshow",this.onBeforeShow,this,{single:true})},fillConfig:function(a){var b={title:_T("common","login"),width:500,height:220,layout:"fit",items:[this.getFormPanel(a)],buttons:[{text:_T("common","ok"),btnStyle:"blue",scope:this,handler:this.onOkClick},{text:_T("common","cancel"),scope:this,handler:this.close}]};Ext.apply(b,a);return b},getFormPanel:function(a){if(!Ext.isDefined(this.formPanel)){this.formPanel=new SYNO.ux.FormPanel({keys:[{key:Ext.EventObject.ENTER,fn:this.onOkClick,scope:this}],items:[{xtype:"syno_displayfield",value:_T("myds","login_please")},{xtype:"syno_textfield",fieldLabel:_T("user","user_email"),allowBlank:false,minLength:3,maxLength:256,vtype:"email",vtypeText:_JSLIBSTR("vtype","bad_email"),name:"account"},{xtype:"syno_textfield",fieldLabel:_T("common","password"),textType:"password",minLength:6,maxLength:128,allowBlank:false,name:"password"},{border:false,layout:{type:"hbox",pack:"end"},items:[{xtype:"syno_button",cls:"myds-link-btn",text:_T("myds","password_forget"),scope:this,handler:function(){window.open("https://myds.synology.com/support/register_password_remind.php","_blank")}}]}]})}return this.formPanel},onBeforeShow:function(){this.findWindow().setStatusBusy({text:_T("common","loading")});this.sendWebAPI({api:"SYNO.Core.MyDSCenter",version:2,method:"query",params:{},scope:this,callback:function(a,b,c){this.findWindow().clearStatusBusy();if(!a){this.findWindow().getMsgBox().alert("",_T("myds","error_query_info"),function(){this.close()},this);return}if(b.is_logged_in){this.findWindow().getMsgBox().alert("",String.format(_T("myds","already_logged_in"),b.account),function(){this.findWindow().fireEvent("login_success",b.account,b.auth_key,b.activated);this.close()},this);return}this.getFormPanel().getForm().findField("account").focus()}})},onOkClick:function(a){var b=this.getFormPanel().getForm();if(!b.isValid()){return}var c=b.getValues();this.findWindow().setStatusBusy({text:_T("common","loading")});this.sendWebAPI({api:"SYNO.Core.MyDSCenter",version:2,method:"login",params:{account:c.account,password:c.password,login_with_abandon:Ext.isBoolean(a)?a:false},encryption:["password"],scope:this,callback:function(e,k,j){this.findWindow().clearStatusBusy();if(!e){var f;switch(k.code){case 3010:f=String.format(SYNO.API.getErrorString(k),k.errors.username);this.findWindow().getMsgBox().alert("",f,function(){this.findWindow().fireEvent("login_success",k.errors.username,k.errors.auth_key,k.errors.activated);this.destroy()},this);break;case 3012:var m,p=[],h=k.errors.found_myds_account,g=0;for(var o in h){if(true===h.hasOwnProperty(o)){var d=h[o];for(m=0;m<d.services.length;m++){var l={account:o,status:(o===j.account)?"success":"fail",name:SYNO.SDS.MyDSCenter.Utils.getServiceName(d.services[m].type),desc:d.services[m].value};p.push(l)}g++}}if(0<g){var n=new SYNO.SDS.MyDSCenter.ConfirmSkipDialog({owner:this,text:(1<g)?_T("myds","force_login_many_account"):String.format(_T("myds","force_login_one_account"),p[0].account),data:p,scope:this,callback:function(){this.onOkClick(true)}});n.show()}break;default:this.findWindow().getMsgBox().alert("",SYNO.API.getErrorString(k));break}return}this.findWindow().fireEvent("login_success",k.account,k.auth_key,k.activated);this.close()}})}});Ext.define("SYNO.SDS.MyDSCenter.Package.LoginDialog",{extend:"SYNO.SDS.ModalWindow",constructor:function(a){this.owner=a.owner;var b=this.fillConfig(a);this.callParent([b]);this.addEvents("login_success","cancel_login");this.addListener("beforeshow",this.onBeforeShow,this,{single:true});this.addListener("afterlayout",this.onAfterLayout,this,{single:true})},fillConfig:function(a){var b={width:500,height:272,resizable:false,closable:true,padding:"0px 20px",cls:"myds-login-dialog",items:[{xtype:"box",cls:"login-panel-title",html:Ext.util.Format.htmlEncode(_T("myds","login_desc"))},this.getFormPanel(a),{border:false,layout:{type:"hbox",pack:"center",align:"middle"},items:[{xtype:"syno_button",text:_T("common","login"),btnStyle:"blue",scope:this,handler:this.onOkClick}]}],useStatusBar:false};Ext.apply(b,a);return b},getFormPanel:function(a){if(!Ext.isDefined(this.formPanel)){this.formPanel=new SYNO.ux.FormPanel({height:145,labelWidth:150,cls:"login-panel-form",keys:[{key:Ext.EventObject.ENTER,fn:this.onOkClick,scope:this}],items:[{xtype:"syno_textfield",fieldLabel:_T("user","user_email"),allowBlank:false,minLength:3,maxLength:256,vtype:"email",width:305,vtypeText:_JSLIBSTR("vtype","bad_email"),name:"account"},{xtype:"syno_displayfield",value:'<a class="link-font" href="javascript: void(0)" tabindex="-1">'+_T("myds","need_account_question")+"</a>",name:"register_label",style:{marginLeft:"155px"},listeners:{render:function(c){var b=c.el.first("a");if(b){this.mon(b,"click",this.onClickRegisterLabel,this)}},scope:this,single:true,buffer:80}},{xtype:"syno_textfield",fieldLabel:_T("common","password"),textType:"password",minLength:6,maxLength:128,allowBlank:false,width:305,name:"password"},{xtype:"syno_displayfield",value:'<a class="link-font" target="_blank" href="https://myds.synology.com/support/register_password_remind.php" tabindex="-1">'+_T("myds","password_forget")+"</a>",name:"forget_password_label",style:{marginLeft:"155px"}}]})}return this.formPanel},onClose:function(){this.fireEvent("cancel_login")},onClickRegisterLabel:function(){var a=new SYNO.SDS.MyDSCenter.RegisterDialog({owner:this.owner,mydsCenterMode:true,listeners:this.initialConfig.listeners});a.open();this.destroy()},onBeforeShow:function(){this.findWindow().setStatusBusy({text:_T("common","loading")});this.sendWebAPI({api:"SYNO.Core.MyDSCenter",version:2,method:"query",params:{},scope:this,callback:function(a,b,c){this.findWindow().clearStatusBusy();if(!a){this.findWindow().getMsgBox().alert("",_T("myds","error_query_info"),function(){this.destroy()},this);return}if(b.is_logged_in){this.findWindow().fireEvent("login_success",b.account,b.auth_key,b.activated);this.destroy();return}this.getFormPanel().getForm().findField("account").focus()}})},onAfterLayout:function(){SYNO.SDS.Utils.AddTip(this.getFormPanel().getForm().findField("register_label").getEl(),_T("myds","register_desc"))},onOkClick:function(a){var b=this.getFormPanel().getForm();if(!b.isValid()){return}var c=b.getValues();this.findWindow().setStatusBusy({text:_T("common","loading")});this.sendWebAPI({api:"SYNO.Core.MyDSCenter",version:2,method:"login",params:{account:c.account,password:c.password,login_with_abandon:Ext.isBoolean(a)?a:false},encryption:["password"],scope:this,callback:function(e,k,j){this.findWindow().clearStatusBusy();if(!e){var f;switch(k.code){case 3010:f=String.format(SYNO.API.getErrorString(k),k.errors.username);this.findWindow().getMsgBox().alert("",f,function(){this.findWindow().fireEvent("login_success",k.errors.username,k.errors.auth_key,k.errors.activated);this.destroy()},this);break;case 3012:var m,p=[],h=k.errors.found_myds_account,g=0;for(var o in h){if(true===h.hasOwnProperty(o)){var d=h[o];for(m=0;m<d.services.length;m++){var l={account:o,status:(o===j.account)?"success":"fail",name:SYNO.SDS.MyDSCenter.Utils.getServiceName(d.services[m].type),desc:d.services[m].value};p.push(l)}g++}}if(0<g){var n=new SYNO.SDS.MyDSCenter.ConfirmSkipDialog({owner:this,text:(1<g)?_T("myds","force_login_many_account"):String.format(_T("myds","force_login_one_account"),p[0].account),data:p,scope:this,callback:function(){this.onOkClick(true)}});n.show()}break;default:this.findWindow().getMsgBox().alert("",SYNO.API.getErrorString(k));break}return}this.findWindow().fireEvent("login_success",k.account,k.auth_key,k.activated);this.destroy()}})}});Ext.namespace("SYNO.SDS.MyDSCenter");Ext.define("SYNO.SDS.MyDSCenter.Application",{extend:"SYNO.SDS.AppInstance",appWindowName:"SYNO.SDS.MyDSCenter.MainWindow"});Ext.define("SYNO.SDS.MyDSCenter.MainWindow",{extend:"SYNO.SDS.AppWindow",constructor:function(a){var b=this.fillConfig(a);this.callParent([b]);this.mon(this.moduleList.getSelectionModel(),{beforeselect:this.onBeforeSelect,selectionchange:this.onModuleListSelect,scope:this})},fillConfig:function(a){var b={layout:"border",minWidth:990,minHeight:560,width:990,height:560,cls:"myds-app-window",items:[this.moduleList=new SYNO.ux.ModuleList({listItems:[{text:"myds:account",iconCls:"icon-users",fn:"SYNO.SDS.MyDSCenter.AccountModule"},{text:"myds:purchase_history",iconCls:"icon-purchases",fn:"SYNO.SDS.MyDSCenter.PurchaseModule"},{text:"myds:subscription",iconCls:"icon-syslog",fn:"SYNO.SDS.MyDSCenter.SubscribeModule"}],cls:"myds-module-list",region:"west",width:250,appWin:this,flex:1,fbar:{items:[this.logoutBtn=new SYNO.ux.Button({xtype:"syno_button",width:220,hidden:true,text:_T("common","logout"),scope:this,handler:this.onClickLogoutBtn})]},listeners:{afterrender:function(){this.moduleList.selectModule("SYNO.SDS.MyDSCenter.AccountModule");this.onBeforeShow()},scope:this,single:this}}),this.moduleCt=new SYNO.ux.Panel({region:"center",layout:"card",activeItem:"SYNO.SDS.MyDSCenter.AccountModule",appWin:this,items:[this.accountModule=new SYNO.SDS.MyDSCenter.AccountModule({owner:this}),this.purchaseModule=new SYNO.SDS.MyDSCenter.PurchaseModule({owner:this}),this.subscribeModule=new SYNO.SDS.MyDSCenter.SubscribeModule({owner:this})]})]};Ext.apply(b,a);return b},onOpen:function(a){this.callParent(arguments);if(Ext.isDefined(a)){this.selectTabId=a.fn}},onRequest:function(a){this.callParent(arguments);if(Ext.isDefined(a)){this.moduleList.selectModule(a.fn)}},onClose:function(){if(this.isSkipDeactivateCheck()){this.clearSkipDeactivateCheck();return true}var b,a=true;b=this.moduleList.getSelectionModel().getSelectedNode().attributes.fn;if(b){a=this.deactivateModule(b);if(false===a){this.getMsgBox().confirm(this.title,_T("common","confirm_lostchange"),function(c){if("yes"===c){this.setSkipDeactivateCheck();this.close()}},this)}}return a},onBeforeShow:function(){this.findWindow().setStatusBusy({text:_T("common","loading")});this.sendWebAPI({api:"SYNO.Core.MyDSCenter",version:2,method:"query",params:{},scope:this,callback:function(a,b,c){this.findWindow().clearStatusBusy();if(!a){this.findWindow().getMsgBox().alert("",SYNO.API.getErrorString(b),function(){this.close()},this);return}if(b.is_logged_in){this.onLoggedIn(b.account,b.auth_key,b.activated)}else{this.showLoginPanel()}}});return true},onLoggedIn:function(f,e,a){this.account=f;this.auth_key=e;if(false===a){this.activated=false;this.findWindow().getMsgBox().alert("",_T("myds","error_unactivated"))}var d=this;var c=Ext.isDefined(this.selectTabId)?this.selectTabId:this.moduleList.getSelectionModel().getSelectedNode().attributes.fn;var b=this.moduleCt.getComponent(c);delete this.selectTabId;this.moduleList.root.childNodes.each(function(h){var g=d.moduleCt.getComponent(h.attributes.fn);if(g.setLoadOnActivate&&Ext.isFunction(g.setLoadOnActivate)){g.setLoadOnActivate(true)}});b.onActivate();this.logoutBtn.show();this.moduleList.selectModule(c);this.moduleList.doLayout()},onLoggedOut:function(){delete this.account;delete this.auth_key;delete this.activated;var a=this.moduleCt.getComponent("SYNO.SDS.MyDSCenter.AccountModule");a.setLoadOnActivate(false);a.onLoggedOut();this.setSkipDeactivateCheck();this.moduleList.selectModule("SYNO.SDS.MyDSCenter.AccountModule");this.clearSkipDeactivateCheck();this.logoutBtn.hide();this.moduleList.doLayout();this.showLoginPanel()},onCancelLogin:function(){if(Ext.isDefined(this.auth_key)){return}this.destroy()},onModuleListSelect:function(a,b){this.moduleCt.getLayout().setActiveItem(b.attributes.fn)},onBeforeSelect:function(a,b,e){if(!e){return true}if(this.isSkipDeactivateCheck()){this.clearSkipDeactivateCheck();return true}var d,c=true;d=e.attributes.fn;if(d){c=this.deactivateModule(d);if(false===c){this.getMsgBox().confirm(this.title,_T("common","confirm_lostchange"),function(f){if("yes"===f){this.setSkipDeactivateCheck();this.moduleList.selectModule(b.attributes.fn)}},this)}}return c},onClickLogoutBtn:function(){this.findWindow().getMsgBox().confirm("",_T("myds","logout_confirm"),function(a){if("yes"===a){this.doLogout()}},this)},deactivateModule:function(b,c){var a=this.moduleCt.getComponent(b);if(a&&a.deactivate){return a.deactivate(c)}},doLogout:function(){this.findWindow().setStatusBusy({text:_T("common","loading")});this.sendWebAPI({api:"SYNO.Core.MyDSCenter",version:2,method:"logout",params:{},scope:this,callback:function(a,b,c){this.findWindow().clearStatusBusy();if(!a){this.findWindow().getMsgBox().alert("",SYNO.API.getErrorString(b));return}this.onLoggedOut()}})},showLoginPanel:function(){var a=new SYNO.SDS.MyDSCenter.Package.LoginDialog({owner:this,listeners:{scope:this,login_success:this.onLoggedIn,cancel_login:this.onCancelLogin}});a.show()},isSkipDeactivateCheck:function(){return !!this.skipDeactivateCheckFlag},setSkipDeactivateCheck:function(){this.skipDeactivateCheckFlag=true},clearSkipDeactivateCheck:function(){this.skipDeactivateCheckFlag=false}});Ext.namespace("SYNO.SDS.MyDSCenter.MigrationWizard");Ext.define("SYNO.SDS.MyDSCenter.MigrationWizard.ChooseTargetPanel",{extend:"Ext.Container",constructor:function(a){var b=this.fillConfig(a);this.callParent([b])},fillConfig:function(a){var d=0;for(var c in _S("found_myds_account")){if(true===_S("found_myds_account").hasOwnProperty(c)){d++}}a.appWin.accountNumber=d;var b={header:false,border:false,cls:"welcome-step-ct",listeners:{afterlayout:function(){this.serviceTip.anchorToContainer()},scope:this},items:[{xtype:"box",cls:"welcome-step-title",html:Ext.util.Format.htmlEncode(_T("myds","migrate_choose_target_title"))},{xtype:"box",cls:"welcome-step-desc fixed-myds-height-desc",html:Ext.util.Format.htmlEncode(_T("myds","migrate_choose_target_desc"))},this.getFormPanel(),new SYNO.SDS.MyDSCenter.MigrationWizard.ProgressBar({progress_total:d+1}),{xtype:"container",cls:"welcome-paging",border:false,layout:{type:"hbox",pack:"center",align:"middle"},defaults:{margins:"0px 5px"},items:[{xtype:"syno_button",cls:"myds-step-btn",btnStyle:"blue",text:_T("common","skip"),scope:this,handler:this.onClickSkipBtn},{xtype:"syno_button",cls:"myds-step-btn",btnStyle:"blue",text:_T("common","next"),scope:this,handler:this.onClickNextBtn}]}]};Ext.apply(b,a);return b},getFormPanel:function(){if(!Ext.isDefined(this.formPanel)){var a={cls:"migration-common-form migration-choose-target",height:300,labelWidth:190,autoScroll:false,useGradient:false,padding:"14px 0 10px 0",items:[{xtype:"syno_displayfield",cls:"desc",value:_T("myds","migrate_choose_target_introduction")},this.getTargetAccountCombobox(),{xtype:"syno_compositefield",indent:1,fieldLabel:_T("common","password"),items:[{xtype:"syno_textfield",emptyText:SYNO.SDS.MyDSCenter.Utils.isSupportPlaceholder()?_T("myds","password_myds"):undefined,textType:"password",minLength:6,maxLength:128,width:200,allowBlank:false,name:"password"},{xtype:"syno_button",cls:"myds-link-btn-yellow",text:_T("myds","password_forget"),scope:this,handler:function(){window.open("https://myds.synology.com/support/register_password_remind.php","_blank")}}]}]};this.formPanel=new SYNO.ux.FormPanel(a)}return this.formPanel},getTargetAccountCombobox:function(){if(!Ext.isDefined(this.targetAccountCombobox)){var c=[],a;for(var b in _S("found_myds_account")){if(true===_S("found_myds_account").hasOwnProperty(b)){c.push([b,b])}}a=new Ext.data.ArrayStore({fields:["name","value"],data:c});this.targetAccountCombobox=new SYNO.ux.ComboBox({fieldLabel:_T("user","user_email"),indent:1,store:a,displayField:"name",valueField:"value",value:c[0][0],name:"targetAccount",width:200,listeners:{afterrender:function(){this.serviceTip=new SYNO.SDS.MyDSCenter.ToolTip({data:this.getServiceList(c[0][0]),renderTo:this.targetAccountCombobox.wrap,owner:this.targetAccountCombobox})},beforeselect:function(f,d,e){if(f.getValue()===d.data.value){return true}this.getFormPanel().getForm().findField("password").setValue("");this.serviceTip.updateTableContent(this.getServiceList(d.data.value));return true},scope:this}})}return this.targetAccountCombobox},getServiceList:function(c){if(true!==_S("found_myds_account").hasOwnProperty(c)){return[]}var b,d=[],a=_S("found_myds_account")[c].services;for(b=0;b<a.length;b++){d.push({name:SYNO.SDS.MyDSCenter.Utils.getServiceName(a[b].type),desc:a[b].value})}return d},onClickSkipBtn:function(){var a,f=[];for(var d in _S("found_myds_account")){if(true===_S("found_myds_account").hasOwnProperty(d)){var c=_S("found_myds_account")[d];for(a=0;a<c.services.length;a++){if("package"===c.services[a].type){continue}var b={status:"fail",name:SYNO.SDS.MyDSCenter.Utils.getServiceName(c.services[a].type),desc:c.services[a].value};f.push(b)}}}var e=new SYNO.SDS.MyDSCenter.ConfirmSkipDialog({text:_T("myds","migrate_skip_confirm"),data:f,renderTo:Ext.getBody(),callback:function(){this.findWindow().setStatusBusy({text:_T("common","loading")});this.sendWebAPI({api:"SYNO.Core.MyDSCenter.Unify",method:"migrate",version:1,params:{is_abandon_all:true},scope:this,callback:function(g,i,j){this.findWindow().clearStatusBusy();if(!g){var h=new SYNO.SDS.MessageBoxV5({owner:this.appWin,renderTo:Ext.getBody()});h.getWrapper().alert("",SYNO.API.getErrorString(i),this.skipMigrationWizard,this);return}this.skipMigrationWizard()}})},scope:this});e.show()},skipMigrationWizard:function(){this.serviceTip.destroy();this.removeMigrateSteps();this.appWin.gotoNextStep()},generateMigrateStepID:function(a){return"migrate_account: "+a},removeMigrateSteps:function(){for(var a in _S("found_myds_account")){if(true===_S("found_myds_account").hasOwnProperty(a)){this.appWin.removeSteps(this.appWin.getStep(this.generateMigrateStepID(a)))}}this.appWin.removeSteps(this.appWin.getStep("migrate_summary"))},onClickNextBtn:function(){var a=this.getFormPanel().getForm();if(true!==a.isValid()){return}var b=a.getValues();this.findWindow().setStatusBusy({text:_T("common","loading")});this.sendWebAPI({api:"SYNO.Core.MyDSCenter.Unify",method:"authen",version:1,params:{account:b.targetAccount,password:b.password,alias:SYNO.SDS.MyDSCenter.Utils.extractAliasFromFoundAccount(b.targetAccount)},encryption:["password"],scope:this,callback:function(e,h,g){this.findWindow().clearStatusBusy();if(!e){var n=null,f=SYNO.API.getErrorString(h);switch(h.code){case 3004:break;case 3008:f=_T("myds","error_migrate_target_unactivated");break;case 3013:f=String.format(f,'<a target="_blank" href="https://myds.synology.com/support/support_form.php">',"</a>");n=this.skipMigrationWizard;break;default:n=this.skipMigrationWizard;break}var d=new SYNO.SDS.MessageBoxV5({owner:this.appWin,cls:"syno-sds-myds-migration-error-dialog",renderTo:Ext.getBody()});if(3013!==h.code){d.getWrapper().alert("",f,n,this)}else{d.getWrapper().confirm("",f,n,this,Ext.MessageBox.OK)}return}var j,l=[],c=[],m=g.account;for(var k in _S("found_myds_account")){if(true===_S("found_myds_account").hasOwnProperty(k)&&k!==m){c.push(k)}}this.removeMigrateSteps();for(j=0;j<c.length;j++){l.push(new SYNO.SDS.MyDSCenter.MigrationWizard.MigrateAccountPanel({appWin:this.appWin,owner:this.appWin,account:c[j],accountSequence:j,itemId:this.generateMigrateStepID(c[j])}))}l.push(new SYNO.SDS.MyDSCenter.MigrationWizard.SummaryPanel({appWin:this.appWin,owner:this.appWin,itemId:"migrate_summary"}));_S("found_myds_account")[m].password=g.password;this.appWin.insertStepAfter(l,this.getItemId());this.appWin.migrateData.targetAccount=m;this.appWin.migrateData.migrateList=c;this.appWin.gotoNextStep()}})}});Ext.namespace("SYNO.SDS.MyDSCenter.MigrationWizard");Ext.define("SYNO.SDS.MyDSCenter.MigrationWizard.MigrateAccountPanel",{extend:"Ext.Container",constructor:function(a){var b=this.fillConfig(a);this.callParent([b])},fillConfig:function(a){var b={header:false,border:false,cls:"welcome-step-ct",items:[{xtype:"box",cls:"welcome-step-title",html:Ext.util.Format.htmlEncode(_T("myds","migrate_migrate_account_title"))},{xtype:"box",cls:"welcome-step-desc fixed-myds-height-desc",itemId:"migrate_desc",html:Ext.util.Format.htmlEncode(_T("myds","migrate_migrate_account_desc"))},this.getFormPanel(a),new SYNO.SDS.MyDSCenter.MigrationWizard.ProgressBar({progress_value:a.accountSequence+1,progress_total:a.appWin.accountNumber+1}),{xtype:"container",cls:"welcome-paging",border:false,layout:{type:"hbox",pack:"center",align:"middle"},defaults:{margins:"0px 5px"},items:[{xtype:"syno_button",minWidth:120,cls:"myds-step-btn",btnStyle:"blue",text:_T("common","back"),scope:this,handler:this.onClickBackBtn},{xtype:"syno_button",minWidth:120,cls:"myds-step-btn",btnStyle:"blue",text:_T("common","next"),scope:this,handler:this.onClickNextBtn}]}]};Ext.apply(b,a);return b},getFormPanel:function(a){if(!Ext.isDefined(this.formPanel)){var e,b=[];var d=_S("found_myds_account")[a.account].services;b.push({xtype:"syno_radio",name:"isAbandoned",checked:true,inputValue:false,boxLabel:_T("myds","migrate_migrate_service"),listeners:{afterrender:function(){var g=this.getFormPanel().getForm();var f=g.findField("isAbandoned").boxlabelEl;if(f){f.update(Ext.util.Format.htmlEncode(String.format(_T("myds","migrate_migrate_service"),this.appWin.migrateData.targetAccount)))}},check:function(h,g){var f=this.getFormPanel().getForm();var i=f.findField("password");if(g){i.setDisabled(false)}else{i.setDisabled(true).setValue("")}},scope:this}});for(e=0;e<d.length;e++){b.push({xtype:"syno_displayfield",indent:1,style:((0===e)?{marginTop:"18px"}:undefined),fieldLabel:SYNO.SDS.MyDSCenter.Utils.getServiceName(d[e].type),value:d[e].value})}b.push({xtype:"syno_displayfield",indent:1,fieldLabel:_T("myds","myds_account"),value:a.account},{xtype:"syno_compositefield",indent:1,fieldLabel:_T("common","password"),items:[{xtype:"syno_textfield",emptyText:SYNO.SDS.MyDSCenter.Utils.isSupportPlaceholder()?_T("myds","password_myds"):undefined,textType:"password",minLength:6,maxLength:128,width:200,allowBlank:false,name:"password"},{xtype:"syno_button",cls:"myds-link-btn-yellow",text:_T("myds","password_forget"),scope:this,handler:function(){window.open("https://myds.synology.com/support/register_password_remind.php","_blank")}}]},{xtype:"syno_radio",margins:"22px 0 0 0",name:"isAbandoned",ctCls:"second-radio",itemId:"abandon_service",inputValue:true,boxLabel:_T("myds","migrate_abandon_service")+String.format('<div class="migrate-abandon-desc-tip-icon" ext:qtip="{0}"></div>',Ext.util.Format.htmlEncode(Ext.util.Format.htmlEncode(_T("myds","abandon_service_desc"))))});var c={cls:"migration-common-form migration-migrate-account",labelWidth:240,useGradient:false,padding:"14px 0 10px 0",height:300,items:b};this.formPanel=new SYNO.ux.FormPanel(c)}return this.formPanel},onClickBackBtn:function(){this.appWin.gotoPreviousStep()},onClickNextBtn:function(){var a=this.getFormPanel().getForm();var b=a.getValues();if("true"===b.isAbandoned){_S("found_myds_account")[this.account].isAbandoned=true;this.gotoNextStep()}else{if(false===a.findField("password").isValid()){return}_S("found_myds_account")[this.account].isAbandoned=false;_S("found_myds_account")[this.account].password=b.password;this.findWindow().setStatusBusy({text:_T("common","loading")});this.sendWebAPI({api:"SYNO.Core.MyDSCenter.Unify",method:"authen",version:1,params:{account:this.account,password:b.password,alias:SYNO.SDS.MyDSCenter.Utils.extractAliasFromFoundAccount(this.account)},encryption:["password"],scope:this,callback:function(c,e,h){this.findWindow().clearStatusBusy();if(!c&&3008!==e.code){var g=SYNO.API.getErrorString(e),i=null;var f=function(){this.appWin.setActiveItem("migrate_choose_target");this.appWin.getComponent("migrate_choose_target").removeMigrateSteps();this.appWin.gotoNextStep()};switch(e.code){case 3004:break;case 3013:g=String.format(g,'<a target="_blank" href="https://myds.synology.com/support/support_form.php">',"</a>");i=f;break;default:i=f;break}var d=new SYNO.SDS.MessageBoxV5({owner:this.appWin,cls:"syno-sds-myds-migration-error-dialog",renderTo:Ext.getBody()});if(3013!==e.code){d.getWrapper().alert("",g,i,this)}else{d.getWrapper().confirm("",g,i,this,Ext.MessageBox.OK)}return}this.gotoNextStep()}})}},gotoNextStep:function(a){if("migrate_summary"===this.appWin.getNextStep().itemId){this.sendMigrateRequest()}else{this.appWin.gotoNextStep()}},sendMigrateRequest:function(){var b,d=[];for(b=0;b<this.appWin.migrateData.migrateList.length;b++){var a=this.appWin.migrateData.migrateList[b];if(false===_S("found_myds_account")[a].isAbandoned){d.push({email:a,passwd:_S("found_myds_account")[a].password})}}this.migrateList=d;var c=[];for(var g in _S("found_myds_account")){if(true===_S("found_myds_account").hasOwnProperty(g)){var f=_S("found_myds_account")[g];for(b=0;b<f.services.length;b++){if(g!==this.appWin.migrateData.targetAccount&&true===f.isAbandoned&&"package"===f.services[b].type){continue}var e={name:SYNO.SDS.MyDSCenter.Utils.getServiceName(f.services[b].type),desc:f.services[b].value};if(g!==this.appWin.migrateData.targetAccount&&true===f.isAbandoned){e.status="fail"}else{e.status="success"}c.push(e)}}}this.appWin.migrateResultData=c;var h=new SYNO.SDS.MyDSCenter.ConfirmSkipDialog({text:String.format(_T("myds","migrate_confirm"),this.appWin.migrateData.targetAccount),renderTo:Ext.getBody(),data:c,callback:function(){this.findWindow().setStatusBusy({text:_T("common","loading")});this.sendWebAPI({api:"SYNO.Core.MyDSCenter.Unify",method:"migrate",version:1,params:{is_abandon_all:false,migrate_target:{email:this.appWin.migrateData.targetAccount,passwd:_S("found_myds_account")[this.appWin.migrateData.targetAccount].password},migrate_list:this.migrateList},encryption:["migrate_target","migrate_list"],scope:this,callback:function(i,k,l){this.findWindow().clearStatusBusy();if(!i){var j=new SYNO.SDS.MessageBoxV5({owner:this.appWin,renderTo:Ext.getBody()});j.getWrapper().alert("",SYNO.API.getErrorString(k),function(){this.appWin.removeSteps(this.appWin.getStep("migrate_summary"));this.appWin.gotoNextStep()},this);return}this.appWin.gotoNextStep()}})},scope:this});h.show()}});Ext.namespace("SYNO.SDS.MyDSCenter.MigrationWizard");Ext.define("SYNO.SDS.MyDSCenter.MigrationWizard.SummaryPanel",{extend:"Ext.Container",constructor:function(a){var b=this.fillConfig(a);this.callParent([b])},fillConfig:function(a){var b={header:false,border:false,cls:"welcome-step-ct",items:[{xtype:"box",cls:"welcome-step-title",html:Ext.util.Format.htmlEncode(_T("myds","migrate_summary_title"))},{xtype:"box",cls:"welcome-step-desc fixed-myds-height-desc",html:Ext.util.Format.htmlEncode(_T("myds","migrate_summary_desc"))},this.getFormPanel(a),new SYNO.SDS.MyDSCenter.MigrationWizard.ProgressBar({progress_value:a.appWin.accountNumber,progress_total:a.appWin.accountNumber+1}),{xtype:"container",cls:"welcome-paging",border:false,layout:{type:"hbox",pack:"center",align:"middle"},defaults:{margins:"0px 5px"},items:[{xtype:"syno_button",minWidth:120,cls:"myds-step-btn",btnStyle:"blue",text:_T("common","finish"),scope:this,handler:this.onClickFinishBtn}]}],listeners:{beforeshow:this.setSummary,scope:this}};Ext.apply(b,a);return b},getFormPanel:function(a){if(!Ext.isDefined(this.formPanel)){var b={cls:"migration-common-form migration-summary",labelWidth:240,height:300,autoScroll:false,useGradient:false,padding:"32px 0 10px 130px",defaults:{labelSeparator:""},items:[{xtype:"syno_displayfield",itemId:"email",cls:"email-field",fieldLabel:_T("common","email")},{xtype:"syno_displayfield",itemId:SYNO.SDS.MyDSCenter.Utils.getServiceName("ddns"),fieldLabel:"Synology DDNS",hidden:true},{xtype:"syno_displayfield",itemId:SYNO.SDS.MyDSCenter.Utils.getServiceName("quickconnect"),fieldLabel:"QuickConnect ID",hidden:true},{xtype:"syno_displayfield",itemId:SYNO.SDS.MyDSCenter.Utils.getServiceName("package"),fieldLabel:_T("pkgmgr","pkgmgr_pkg_name"),hidden:true}]};this.formPanel=new SYNO.ux.FormPanel(b)}return this.formPanel},setSummary:function(){if(!Ext.isDefined(this.appWin.migrateResultData)){return}var d,c=0,a=this.getFormPanel();a.getComponent("email").setValue(this.appWin.migrateData.targetAccount);for(d=0;d<this.appWin.migrateResultData.length;d++){if("fail"===this.appWin.migrateResultData[d].status){continue}var b=a.getComponent(this.appWin.migrateResultData[d].name);b.setValue(this.appWin.migrateResultData[d].desc);b.show();c++}},onGetQuickConnectInfo:function(g,e,d,c){var f=this.appWin;if(g&&e.has_fail!==true){var a=e.enabled,b=(a===true)?e.server_alias:null;if(b===null&&!SYNO.SDS.isNVR){f.registerQCTPanel=new SYNO.SDS.App.WelcomeApp.RegisterQuickConnectStep({appWin:f,owner:f,itemId:"register-quickconnect",type:"is_login_ok"});f.insertStepAfter(f.registerQCTPanel,this.itemId)}}f.clearStatusBusy();f.gotoNextStep()},onClickFinishBtn:function(){this.appWin.setStatusBusy();this.sendWebAPI({api:"SYNO.Core.QuickConnect",method:"get",version:2,callback:this.onGetQuickConnectInfo,scope:this})}});